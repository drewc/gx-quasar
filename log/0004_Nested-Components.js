export default{$$data_type:"org-document",properties:{title:["Render an OrgMode document: Nested Components"],filetags:[],author:["Drew C"],creator:"Emacs 28.0.50 (Org mode 9.3)",date:[{$$data_type:"org-node",type:"timestamp",ref:"org2e786b7",properties:{type:"active-range","raw-value":"<2020-12-02 Wed>--<2020-12-18 Fri>","post-blank":0,start:"2020-12-02",end:"2020-12-18"},contents:[]}],description:[],email:"drewc@nyx",language:"en"},contents:[{$$data_type:"org-node",type:"section",ref:"org771d897",properties:{"post-blank":1,"post-affiliated":1},contents:[{$$data_type:"org-node",type:"keyword",ref:"org54f461a",properties:{key:"TITLE",value:"Render an OrgMode document: Nested Components","post-blank":0,"post-affiliated":1},contents:[]},{$$data_type:"org-node",type:"keyword",ref:"org17032b9",properties:{key:"DATE",value:"<2020-12-02 Wed>--<2020-12-18 Fri>","post-blank":0,"post-affiliated":56},contents:[]},{$$data_type:"org-node",type:"keyword",ref:"orgb21cf1a",properties:{key:"STARTUP",value:"inlineimages","post-blank":0,"post-affiliated":99},contents:[]},{$$data_type:"org-node",type:"keyword",ref:"org30c3bbe",properties:{key:"AUTHOR",value:"Drew C","post-blank":1,"post-affiliated":123},contents:[]},{$$data_type:"org-node",type:"paragraph",ref:"orgced6a00",properties:{"post-blank":1,"post-affiliated":186},contents:["To export an ",{$$data_type:"org-node",type:"bold",ref:"org96bf116",properties:{"post-blank":0},contents:["OrgMode"]},{$$data_type:"org-node",type:"footnote-reference",ref:"orge3b5d5e",properties:{label:"o",type:"standard","post-blank":1},contents:[]},"document and use ",{$$data_type:"org-node",type:"bold",ref:"org48a5bd2",properties:{"post-blank":0},contents:["Gerbil"]},{$$data_type:"org-node",type:"footnote-reference",ref:"org2ce7d3c",properties:{label:"g",type:"standard","post-blank":1},contents:[]},"to render it in\n",{$$data_type:"org-node",type:"bold",ref:"orga4e8056",properties:{"post-blank":1},contents:["Javascript"]},"ended up being the results of this log. If you are reading it\nonline as a web page it likely contains start of the engine that ran in order to\ncreate the document you are viewing.\n"]},{$$data_type:"org-node",type:"paragraph",ref:"orgaf8f242",properties:{"post-blank":0,"post-affiliated":457},contents:["Click on this header to see more.\n"]}]},{$$data_type:"org-node",type:"headline",ref:"org0dac7a0",drawer:{},properties:{"tags-all":[],"raw-value":"Introduction","pre-blank":1,level:1,priority:null,tags:[],"todo-keyword":null,"todo-type":null,"post-blank":4,"footnote-section-p":!1,archivedp:!1,commentedp:!1,"post-affiliated":492,title:["Introduction"]},contents:[{$$data_type:"org-node",type:"section",ref:"orgddaf545",properties:{"post-blank":4,"post-affiliated":508},contents:[{$$data_type:"org-node",type:"paragraph",ref:"org477c424",properties:{"post-blank":1,"post-affiliated":508},contents:["It all started because I needed a task to learn more about ",{$$data_type:"org-node",type:"bold",ref:"orged12a5d",properties:{"post-blank":0},contents:["Vue.js"]},{$$data_type:"org-node",type:"footnote-reference",ref:"org1b06ce5",properties:{label:"vue",type:"standard","post-blank":1},contents:[]},"in\norder to go further with my runtime.\n"]},{$$data_type:"org-node",type:"paragraph",ref:"orgf92d85e",properties:{"post-blank":1,"post-affiliated":625},contents:["In ",{$$data_type:"org-node",type:"bold",ref:"orgf6af5c6",properties:{"post-blank":1},contents:["Vue.js"]},"the main players are components. In the previous logs we were able\nto create them and to make them create themselves. Now it's time to nest them,\nand have them use others.\n"]},{$$data_type:"org-node",type:"paragraph",ref:"orgff1e463",properties:{"post-blank":1,"post-affiliated":810},contents:["Because I generally use ",{$$data_type:"org-node",type:"bold",ref:"org655b240",properties:{"post-blank":1},contents:["OrgMode"]},'to store my "source" and "documentation",\n',{$$data_type:"org-node",type:"link",ref:"orgf3e8738",properties:{type:"custom-id",path:"OrgModeAndJson",format:"bracket","raw-link":"#OrgModeAndJson",application:null,"search-option":null,"post-blank":1,"is-internal":!0,"target-ref":"org3c4751a","is-inline-image":!1},contents:["exporting it to ",{$$data_type:"org-node",type:"code",ref:"org0e1c15a",properties:{value:"json","post-blank":0},contents:[]}]},"seemed like a good start.\n"]},{$$data_type:"org-node",type:"paragraph",ref:"org051331e",properties:{"post-blank":1,"post-affiliated":957},contents:["Well, I could not finish the log until it was exported and viewable.\n"]},{$$data_type:"org-node",type:"paragraph",ref:"org3b3e8aa",properties:{"post-blank":1,"post-affiliated":1027},contents:["Here is the ",{$$data_type:"org-node",type:"bold",ref:"orgc9da95c",properties:{"post-blank":1},contents:["Gerbil"]},"code that renders it.\n"]},{$$data_type:"org-node",type:"src-block",ref:"org72fc0d5",properties:{language:"scheme",switches:null,parameters:null,"number-lines":null,"preserve-indent":!1,"retain-labels":!0,"use-labels":!0,"label-fmt":null,value:'(def (renderOrgDoc this h)\n  (def doc (js#ref this document:))\n  (def comps (js#ref this components:))\n  (def contents (vector-copy (js#ref doc contents:)))\n  (def summary-child (vector (vector-ref contents 0)))\n  (def summary\n    (h "summary"\n     (vector\n      (h (find-org-node-component\n\t  doc key: \'documentProperties comps)\n\t { props: { document: doc } })\n      (h "hr")\n      (h "div"\n\t (vector\n\t  (h "big" (org#org-value->child h summary-child comps))))\n      (h "hr"))))\n  (def TOC (h OrgDocTOC { props: { document: doc } } ""))\n  (def details\n    (begin\n      ;; Get the summary out of the contents\n      (set! (vector contents 0) "")\n      ;; Display the document.\n      (vector summary TOC (h "div" (org#org-value->child h contents comps)))))\n\n  (h "div" { style: { border: "1px dotted black" padding: "2em" } }\n     (vector (h "details" details))))\n',"post-blank":0,"post-affiliated":1071},contents:[]}]}]},{$$data_type:"org-node",type:"headline",ref:"org37621eb",drawer:{},properties:{"tags-all":[],"raw-value":"Adding them to ~src/components~","pre-blank":1,level:1,priority:null,tags:[],"todo-keyword":null,"todo-type":null,"post-blank":1,"footnote-section-p":!1,archivedp:!1,commentedp:!1,"post-affiliated":1966,title:["Adding them to ",{$$data_type:"org-node",type:"code",ref:"org590a7cc",properties:{value:"src/components","post-blank":0},contents:[]}]},contents:[{$$data_type:"org-node",type:"section",ref:"org7e3da6c",properties:{"post-blank":1,"post-affiliated":2001},contents:[{$$data_type:"org-node",type:"paragraph",ref:"orgec158dd",properties:{"post-blank":1,"post-affiliated":2001},contents:["Since we want to place the components in ",{$$data_type:"org-node",type:"code",ref:"org52c62d0",properties:{value:"src/components","post-blank":1},contents:[]},"we need to take care\nof linting. From this point on, any file that ends with ",{$$data_type:"org-node",type:"code",ref:"org0f5b382",properties:{value:".gx.js","post-blank":1},contents:[]},"will not be\nlinted.\n"]},{$$data_type:"org-node",type:"src-block",ref:"org30e2cae",properties:{language:"javascript",switches:null,parameters:null,"number-lines":null,"preserve-indent":!1,"retain-labels":!0,"use-labels":!0,"label-fmt":null,value:"extendWebpack (cfg) {\n  cfg.module.rules.push({\n    enforce: 'pre',\n    test: /\\.(js|vue)$/,\n    loader: 'eslint-loader',\n    exclude: [ /(node_modules|public)/, /\\.gx\\.js$/ ]\n  })\n}\n","post-blank":1,"post-affiliated":2166},contents:[]},{$$data_type:"org-node",type:"paragraph",ref:"orge6f9bab",properties:{"post-blank":1,"post-affiliated":2383},contents:["Now a component to try it out.\n"]},{$$data_type:"org-node",type:"src-block",ref:"orgb84417f",properties:{language:"scheme",switches:null,parameters:null,"number-lines":null,"preserve-indent":!1,"retain-labels":!0,"use-labels":!0,"label-fmt":null,value:'(import :js/syntax)\n(def ButtonCounter\n  (js#jso\n   name: "ButtonCounter"\n   data: (lambda _ (js#jso count: 0))\n   render:\n   (js#function (createElement)\n     (createElement\n      "button"\n      (js#jso\n       on: (js#jso\n\t    click: (lambda _ (js#++ (js#ref js#this count:)))))\n      (##string-append "Component .gx.js! You clicked me "\n\t\t       (##number->string (js#ref js#this count:)) " times")))))\n\n(##inline-host-statement "// alert(\'here!\');\n  exports.ButtonCounter = g_scm2host((@1@));" ButtonCounter)\n',"post-blank":0,"post-affiliated":2415},contents:[]}]}]},{$$data_type:"org-node",type:"headline",ref:"orgb35ad82",drawer:{},properties:{"tags-all":[],"raw-value":"Make ~js#ref~ and ~js#ref-set!~ a little more robust","pre-blank":1,level:1,priority:null,tags:[],"todo-keyword":null,"todo-type":null,"post-blank":1,"footnote-section-p":!1,archivedp:!1,commentedp:!1,"post-affiliated":2957,title:["Make ",{$$data_type:"org-node",type:"code",ref:"org5fc7617",properties:{value:"js#ref","post-blank":1},contents:[]},"and ",{$$data_type:"org-node",type:"code",ref:"org900c7d7",properties:{value:"js#ref-set!","post-blank":1},contents:[]},"a little more robust"]},contents:[{$$data_type:"org-node",type:"section",ref:"orgd8844c1",properties:{"post-blank":1,"post-affiliated":3013},contents:[{$$data_type:"org-node",type:"paragraph",ref:"org9305540",properties:{"post-blank":1,"post-affiliated":3013},contents:["In ",{$$data_type:"org-node",type:"code",ref:"orgcf38d28",properties:{value:"js","post-blank":1},contents:[]},"there's a ",{$$data_type:"org-node",type:"code",ref:"org4d1217e",properties:{value:"lot.of.connecting.items()","post-blank":0},contents:[]},". Right now we ",{$$data_type:"org-node",type:"code",ref:"org94e8ee4",properties:{value:"(only have one)","post-blank":1},contents:[]},"to\nreference. That needs taken care of.\n"]},{$$data_type:"org-node",type:"paragraph",ref:"orgfbb74f0",properties:{"post-blank":1,"post-affiliated":3132},contents:["This uses ",{$$data_type:"org-node",type:"code",ref:"orgba8038c",properties:{value:"##apply","post-blank":1},contents:[]},"which I cribbed from ",{$$data_type:"org-node",type:"bold",ref:"org743ba46",properties:{"post-blank":1},contents:["Gambit's"]},{$$data_type:"org-node",type:"code",ref:"org9544014",properties:{value:"_univlib.scm","post-blank":0},contents:[]},". It works.\n"]},{$$data_type:"org-node",type:"src-block",ref:"org44ee50a",properties:{language:"scheme",switches:null,parameters:null,"number-lines":null,"preserve-indent":!1,"retain-labels":!0,"use-labels":!0,"label-fmt":null,value:"(def (ref obj key . keys)\n  (let ((v\n\t (##inline-host-expression \"((obj, ref) => {\n   if (obj instanceof G_Foreign) {\n      obj = g_foreign2host(obj);\n   } else if (typeof obj != 'object') {\n     return;\n   };\n return g_host2scm(obj[ref]);\n\n})(@1@, @2@);\" obj key)))\n    (if (null? keys) v\n\t(##apply ref v keys))))\n","post-blank":1,"post-affiliated":3211},contents:[]},{$$data_type:"org-node",type:"src-block",ref:"org2d43edb",properties:{language:"scheme",switches:null,parameters:null,"number-lines":null,"preserve-indent":!1,"retain-labels":!0,"use-labels":!0,"label-fmt":null,value:"(def (ref-set! obj ref . refs-and-val)\n  ;; (js#console.log 1765 obj ref (null? (cdr refs-and-val))(car refs-and-val) (cdr refs-and-val))\n  (if (null? (cdr refs-and-val))\n      (##inline-host-expression \"((obj, ref, val) => {\n   if (obj instanceof G_Foreign) {\n      obj = g_foreign2host(obj);\n   }\n\n   if (val instanceof G_Foreign) {\n      val = g_foreign2host(val);\n   }\n // if (typeof ref !== 'number') { console.log('setting', obj, 'key', ref, 'to', val) };\n obj[ref] = val;\n return g_host2scm(val);\n\n})(@1@, @2@, @3@);\" obj ref (car refs-and-val))\n      ;; We want an object to set something in\n      (let* ((nobj (js#ref obj ref))\n\t     (nobj (if (js#undefined? nobj)\n\t\t    (js#ref-set! obj ref (js#jso (car refs-and-val) nobj))\n\t\t    nobj)))\n\t;; (js#console.log 765 obj ref nobj)\n\t(apply js#ref-set! nobj refs-and-val))))\n\n\n","post-blank":0,"post-affiliated":3556},contents:[]}]}]},{$$data_type:"org-node",type:"headline",ref:"orgbd98ed8",drawer:{CUSTOM_ID:"OrgNodeTest"},properties:{"tags-all":[],"raw-value":"~OrgNodeTest~? Nested, functional, here we go.","pre-blank":0,level:1,priority:null,tags:[],"todo-keyword":null,"todo-type":null,"post-blank":1,"footnote-section-p":!1,archivedp:!1,commentedp:!1,"post-affiliated":4417,title:[{$$data_type:"org-node",type:"code",ref:"org4f66ee3",properties:{value:"OrgNodeTest","post-blank":0},contents:[]},"? Nested, functional, here we go."]},contents:[{$$data_type:"org-node",type:"section",ref:"org3524e15",properties:{"post-blank":1,"post-affiliated":4466},contents:[{$$data_type:"org-node",type:"paragraph",ref:"org4d6788f",properties:{"post-blank":1,"post-affiliated":4510},contents:['Let us say we have an object, say a paragraph. Within that paragraph there could\nbe other "nested" object, like say a ',{$$data_type:"org-node",type:"bold",ref:"org6d89bc3",properties:{"post-blank":1},contents:["bold"]},"section.\n"]},{$$data_type:"org-node",type:"paragraph",ref:"org3f72943",properties:{"post-blank":1,"post-affiliated":4645},contents:["Having those two work together as seperate components is one thing. Having those\nthree or four work togther, that is to say different ",{$$data_type:"org-node",type:"bold",ref:"org5f0c94b",properties:{"post-blank":1},contents:["bold"]},"components for a\ndifferent paragraph rendering, yes, that'll do, then we can see how different\ncomponents can come together to create a rendered document.\n"]},{$$data_type:"org-node",type:"paragraph",ref:"org41e2119",properties:{"post-blank":1,"post-affiliated":4942},contents:["Organizing that together is an intented pun. Here is a ",{$$data_type:"org-node",type:"bold",ref:"orgf4085b8",properties:{"post-blank":1},contents:["JSON"]},"export of an Org\nMode paragraph",{$$data_type:"org-node",type:"footnote-reference",ref:"orgf578c43",properties:{label:"oxjson",type:"standard","post-blank":1},contents:[]},"that we'll make into a component document.\n"]},{$$data_type:"org-node",type:"src-block",ref:"orge3e4a51",properties:{language:"json",switches:null,parameters:null,"number-lines":null,"preserve-indent":!1,"retain-labels":!0,"use-labels":!0,"label-fmt":null,value:'export default  {\n  "$$data_type": "org-node",\n  "type": "paragraph",\n  "ref": "org8647194",\n  "properties": {\n    "post-blank": 0,\n    "post-affiliated": 54\n  },\n  "contents": [\n    "In ",\n    {\n      "$$data_type": "org-node",\n      "type": "bold",\n      "ref": "orgfa5b96b",\n      "properties": {\n\t"post-blank": 1\n      },\n      "contents": [\n\t"Vue.js"\n      ]\n    },\n    "the main players are components. In the previous logs we were able\\nto create them and to make them create themselves. Now it\'s time to nest them,\\nand have them use others.\\n"\n  ]\n}\n',"post-blank":0,"post-affiliated":5091},contents:[]}]},{$$data_type:"org-node",type:"headline",ref:"orge00f5ab",drawer:{},properties:{"tags-all":[],"raw-value":"~OrgNodeTest~","pre-blank":1,level:2,priority:null,tags:[],"todo-keyword":null,"todo-type":null,"post-blank":1,"footnote-section-p":!1,archivedp:!1,commentedp:!1,"post-affiliated":5678,title:[{$$data_type:"org-node",type:"code",ref:"orgb595044",properties:{value:"OrgNodeTest","post-blank":0},contents:[]}]},contents:[{$$data_type:"org-node",type:"section",ref:"org2ac45d1",properties:{"post-blank":1,"post-affiliated":5696},contents:[{$$data_type:"org-node",type:"paragraph",ref:"org0d26915",properties:{"post-blank":1,"post-affiliated":5696},contents:["The first component I see is an ",{$$data_type:"org-node",type:"code",ref:"org53b11e2",properties:{value:"OrgNode","post-blank":0},contents:[]},". We'll start with a simple first test.\n"]},{$$data_type:"org-node",type:"paragraph",ref:"org56b8f13",properties:{"post-blank":1,"post-affiliated":5778},contents:["So learning a bit more about components, ",{$$data_type:"org-node",type:"code",ref:"orgba860ae",properties:{value:'"type":',"post-blank":0},contents:[]},", ",{$$data_type:"org-node",type:"code",ref:"org97ca7d5",properties:{value:'"ref":',"post-blank":1},contents:[]},{$$data_type:"org-node",type:"italic",ref:"org57e21bb",properties:{"post-blank":1},contents:["et al"]},"could be\ncomponent properties but ",{$$data_type:"org-node",type:"code",ref:"org7c05352",properties:{value:'[Vue warn]: "ref" is a reserved attribute and cannot\nbe used as component prop.',"post-blank":0},contents:[]},".\n"]},{$$data_type:"org-node",type:"paragraph",ref:"org463ae00",properties:{"post-blank":1,"post-affiliated":5965},contents:["So, we'll made a node (component) have a node (object).\n"]},{$$data_type:"org-node",type:"paragraph",ref:"org581f4e6",properties:{"post-blank":1,"post-affiliated":6022},contents:["Beyond that, for the first test, simply make a string out of the contents.\n"]},{$$data_type:"org-node",type:"src-block",ref:"org3e8f723",properties:{language:"scheme",switches:null,parameters:null,"number-lines":null,"preserve-indent":!1,"retain-labels":!0,"use-labels":!0,"label-fmt":null,value:'namespace: OrgNodeFirstTest\n(import :js/syntax)\n\n(def (node-contents->string node)\n  (let* ((contents (js#ref node contents:))\n\t (str (##apply ##string-append\n\t\t(map (lambda (c) (if (string? c) c (node-contents->string c)))\n\t\t     (##vector->list contents))))\n\t (post (js#ref node properties: post-blank:)))\n    (if (and (##number? post) (> post 0))\n      (##string-append str (##make-string post #\\space))\n      str)))\n\n(def OrgNodeFirstTest\n  (js#jso\n   props: #( "node" )\n   render: (js#function (h)\n\t    (let ((node (js#ref js#this node:)))\n\t      (h "strong" (node-contents->string node))))))\n\n(##inline-host-statement "exports[g_scm2host(@1@)] = g_scm2host(@2@);"\n\t\t\t "OrgNodeFirstTest" OrgNodeFirstTest)\n',"post-blank":1,"post-affiliated":6098},contents:[]},{$$data_type:"org-node",type:"paragraph",ref:"orga3132b8",properties:{"post-blank":1,"post-affiliated":6913,caption:[[["This is also the first caption!"]]],name:"screenshot:first-test"},contents:[{$$data_type:"org-node",type:"link",ref:"org6c68d17",properties:{type:"file",path:"./0004_first-test.png",format:"bracket","raw-link":"./0004_first-test.png",application:null,"search-option":null,"post-blank":0,"is-internal":!1,"target-ref":null,"is-inline-image":!0},contents:[]},"\n"]},{$$data_type:"org-node",type:"paragraph",ref:"orgc41fcbe",properties:{"post-blank":0,"post-affiliated":6940},contents:["Awesome!\n"]}]}]},{$$data_type:"org-node",type:"headline",ref:"org35f6d80",drawer:{},properties:{"tags-all":[],"raw-value":"Functional Components: ~OrgNodeSecondTest~","pre-blank":1,level:2,priority:null,tags:[],"todo-keyword":null,"todo-type":null,"post-blank":2,"footnote-section-p":!1,archivedp:!1,commentedp:!1,"post-affiliated":6950,title:["Functional Components: ",{$$data_type:"org-node",type:"code",ref:"orgf9ead18",properties:{value:"OrgNodeSecondTest","post-blank":0},contents:[]}]},contents:[{$$data_type:"org-node",type:"section",ref:"orged867fa",properties:{"post-blank":2,"post-affiliated":6997},contents:[{$$data_type:"org-node",type:"paragraph",ref:"orgd346317",properties:{"post-blank":1,"post-affiliated":6997},contents:["Really, our ",{$$data_type:"org-node",type:"code",ref:"org0523d44",properties:{value:"OrgNodeFirstTest","post-blank":1},contents:[]},'does very little, and "we can mark components as\nfunctional, which means that they’re stateless (no reactive data) and\ninstanceless (no this context)."',{$$data_type:"org-node",type:"footnote-reference",ref:"org53b0463",properties:{label:"vuerf",type:"standard","post-blank":0},contents:[]},".\n"]},{$$data_type:"org-node",type:"paragraph",ref:"org7410d17",properties:{"post-blank":1,"post-affiliated":7192},contents:["With functional components a second argument, ",{$$data_type:"org-node",type:"code",ref:"org6424e3f",properties:{value:"context","post-blank":1},contents:[]},"is added to the render\nfunction.\n"]},{$$data_type:"org-node",type:"quote-block",ref:"orgb98e71a",properties:{"post-blank":1,"post-affiliated":7282},contents:[{$$data_type:"org-node",type:"paragraph",ref:"org0fd725e",properties:{"post-blank":1,"post-affiliated":7296},contents:["Everything the component needs is passed through context, which is an object containing:\n"]},{$$data_type:"org-node",type:"plain-list",ref:"org8475e29",properties:{type:"descriptive",structure:[[7386,1,"- ",null,null,"props",7430],[7430,1,"- ",null,null,"children",7476],[7476,1,"- ",null,null,"slots",7524],[7524,1,"- ",null,null,"scopedSlots",7638],[7638,1,"- ",null,null,"data",7734],[7734,1,"- ",null,null,"parent",7783],[7783,1,"- ",null,null,"listeners",7892],[7892,1,"- ",null,null,"injections",7985]],"post-blank":1,"post-affiliated":7386},contents:[{$$data_type:"org-node",type:"item",ref:"org8cc6e61",properties:{bullet:"- ",checkbox:null,counter:null,"pre-blank":0,"post-blank":0,"post-affiliated":7386,tag:["props"]},contents:[{$$data_type:"org-node",type:"paragraph",ref:"org9965da8",properties:{"post-blank":0,"post-affiliated":7398},contents:["An object of the provided props\n"]}]},{$$data_type:"org-node",type:"item",ref:"org4dc9d70",properties:{bullet:"- ",checkbox:null,counter:null,"pre-blank":0,"post-blank":0,"post-affiliated":7430,tag:["children"]},contents:[{$$data_type:"org-node",type:"paragraph",ref:"orgdc0d501",properties:{"post-blank":0,"post-affiliated":7445},contents:["An array of the VNode children\n"]}]},{$$data_type:"org-node",type:"item",ref:"orgbfbf36c",properties:{bullet:"- ",checkbox:null,counter:null,"pre-blank":0,"post-blank":0,"post-affiliated":7476,tag:["slots"]},contents:[{$$data_type:"org-node",type:"paragraph",ref:"org574c23d",properties:{"post-blank":0,"post-affiliated":7488},contents:["A function returning a slots object\n"]}]},{$$data_type:"org-node",type:"item",ref:"org6397489",properties:{bullet:"- ",checkbox:null,counter:null,"pre-blank":0,"post-blank":0,"post-affiliated":7524,tag:["scopedSlots"]},contents:[{$$data_type:"org-node",type:"paragraph",ref:"org4a0d948",properties:{"post-blank":0,"post-affiliated":7542},contents:["(2.6.0+) An object that exposes passed-in scoped slots. Also exposes normal slots as functions.\n"]}]},{$$data_type:"org-node",type:"item",ref:"org64b1ab3",properties:{bullet:"- ",checkbox:null,counter:null,"pre-blank":0,"post-blank":0,"post-affiliated":7638,tag:["data"]},contents:[{$$data_type:"org-node",type:"paragraph",ref:"orga0506f2",properties:{"post-blank":0,"post-affiliated":7649},contents:["The entire data object, passed to the component as the 2nd argument of createElement\n"]}]},{$$data_type:"org-node",type:"item",ref:"orgd11e5cf",properties:{bullet:"- ",checkbox:null,counter:null,"pre-blank":0,"post-blank":0,"post-affiliated":7734,tag:["parent"]},contents:[{$$data_type:"org-node",type:"paragraph",ref:"org1da2c49",properties:{"post-blank":0,"post-affiliated":7747},contents:["A reference to the parent component\n"]}]},{$$data_type:"org-node",type:"item",ref:"orgdb808a4",properties:{bullet:"- ",checkbox:null,counter:null,"pre-blank":0,"post-blank":0,"post-affiliated":7783,tag:["listeners"]},contents:[{$$data_type:"org-node",type:"paragraph",ref:"orgc3b93e1",properties:{"post-blank":0,"post-affiliated":7799},contents:["(2.3.0+) An object containing parent-registered event listeners. This is an alias to data.on\n"]}]},{$$data_type:"org-node",type:"item",ref:"org654043b",properties:{bullet:"- ",checkbox:null,counter:null,"pre-blank":0,"post-blank":0,"post-affiliated":7892,tag:["injections"]},contents:[{$$data_type:"org-node",type:"paragraph",ref:"org656effe",properties:{"post-blank":0,"post-affiliated":7909},contents:["(2.3.0+) if using the inject option, this will contain resolved injections.\n"]}]}]},{$$data_type:"org-node",type:"paragraph",ref:"org57c1232",properties:{"post-blank":0,"post-affiliated":7986},contents:["— ",{$$data_type:"org-node",type:"link",ref:"orgc5707a7",properties:{type:"https",path:"//vuejs.org/v2/guide/render-function.html#Functional-Components",format:"plain","raw-link":"https://vuejs.org/v2/guide/render-function.html#Functional-Components",application:null,"search-option":null,"post-blank":0,"is-internal":!1,"target-ref":null,"is-inline-image":!1},contents:[]},"\n"]}]},{$$data_type:"org-node",type:"paragraph",ref:"orgf572575",properties:{"post-blank":1,"post-affiliated":8071},contents:["Those version numbers mean something. We're there though!\n"]},{$$data_type:"org-node",type:"src-block",ref:"org84fa277",properties:{language:"shell",switches:null,parameters:null,"number-lines":null,"preserve-indent":!1,"retain-labels":!0,"use-labels":!0,"label-fmt":null,value:"quasar info |grep vue\n  vue - 2.6.12 -- Reactive, component-oriented view layer for modern web interfaces.\n  vue-router - 3.2.0 -- Official router for Vue.js 2\n  vuex - 3.5.1 -- state management for Vue.js\n","post-blank":1,"post-affiliated":8130},contents:[]},{$$data_type:"org-node",type:"src-block",ref:"orge76d702",properties:{language:"scheme",switches:null,parameters:null,"number-lines":null,"preserve-indent":!1,"retain-labels":!0,"use-labels":!0,"label-fmt":null,value:'(import :js/syntax)\n\n(def OrgNodeSecondTest\n  (js#jso\n   functional: #t\n   render: (js#function (h c)\n\t     ;(js#console.log c)\n\t    (let ((node (js#ref c props: node:)))\n\t      (h "strong" (OrgNodeFirstTest#node-contents->string node))))))\n\n(##inline-host-statement "exports[g_scm2host(@1@)] = g_scm2host(@2@);"\n\t\t\t "OrgNodeSecondTest" OrgNodeSecondTest)\n',"post-blank":1,"post-affiliated":8365},contents:[]},{$$data_type:"org-node",type:"paragraph",ref:"org14847c1",properties:{"post-blank":0,"post-affiliated":8751},contents:["That works great. On to the next step.\n"]}]}]},{$$data_type:"org-node",type:"headline",ref:"org74b9e25",drawer:{},properties:{"tags-all":[],"raw-value":"~OrgNodeThirdTest~: paragraph = p, bold = strong?","pre-blank":0,level:2,priority:null,tags:[],"todo-keyword":null,"todo-type":null,"post-blank":1,"footnote-section-p":!1,archivedp:!1,commentedp:!1,"post-affiliated":8792,title:[{$$data_type:"org-node",type:"code",ref:"org552c847",properties:{value:"OrgNodeThirdTest","post-blank":0},contents:[]},": paragraph = p, bold = strong?"]},contents:[{$$data_type:"org-node",type:"section",ref:"orgc1023b7",properties:{"post-blank":1,"post-affiliated":8845},contents:[{$$data_type:"org-node",type:"paragraph",ref:"org21cef9e",properties:{"post-blank":1,"post-affiliated":8845},contents:["In our simple test org node there's a ",{$$data_type:"org-node",type:"code",ref:"orgf88082e",properties:{value:"type:","post-blank":1},contents:[]},"property. Right now it has ",{$$data_type:"org-node",type:"code",ref:"org2672e48",properties:{value:"bold","post-blank":0},contents:[]},"\nand ",{$$data_type:"org-node",type:"code",ref:"org1c5c77e",properties:{value:"paragraph","post-blank":1},contents:[]},"which, strangely enough, have similar ",{$$data_type:"org-node",type:"bold",ref:"org5dfaba5",properties:{"post-blank":1},contents:["HTML"]},"elements.\n"]},{$$data_type:"org-node",type:"paragraph",ref:"org1ab72c0",properties:{"post-blank":1,"post-affiliated":8997},contents:["But I'm willing to bet there are more ",{$$data_type:"org-node",type:"code",ref:"orgd93691d",properties:{value:"type:","post-blank":0},contents:[]},"'s in a ",{$$data_type:"org-node",type:"code",ref:"org02fbf9e",properties:{value:".org","post-blank":1},contents:[]},"file.\n"]},{$$data_type:"org-node",type:"paragraph",ref:"orge9647b4",properties:{"post-blank":1,"post-affiliated":9064},contents:["So we'll make an unknown type element which simply displays the node JSON.\n"]},{$$data_type:"org-node",type:"src-block",ref:"org14208f9",properties:{language:"scheme",switches:null,parameters:null,"number-lines":null,"preserve-indent":!1,"retain-labels":!0,"use-labels":!0,"label-fmt":null,value:'namespace: org\n(import :js/syntax)\n\n(def (optarg a (b 1)) (+ a b))\n\n(def OrgNodeUnknown\n  (js#jso\n   functional: #t\n   render:\n   (js#function\n    (h c)\n    (def node (js#ref c props: node:))\n    ;(js#console.log (optarg 1))\n    ;(js#alert (optarg 1))\n    (h "code"\n       (##inline-host-expression\n\t"((jso) => { return g_host2scm( JSON.stringify(jso) )})(g_scm2host(@1@))" node)))\n   ))\n\n(def OrgNodeThirdTest\n  (js#jso\n   functional: #t\n   render: (js#function (h c)\n\t    (def node (js#ref c props: node:))\n\t    (h OrgNodeUnknown (js#jso props: (js#jso node: node))))))\n\n(##inline-host-statement "exports[g_scm2host(@1@)] = g_scm2host(@2@);"\n\t\t\t "OrgNodeThirdTest" OrgNodeThirdTest)\n',"post-blank":2,"post-affiliated":9140},contents:[]},{$$data_type:"org-node",type:"paragraph",ref:"orgba8d6ae",properties:{"post-blank":1,"post-affiliated":9856},contents:["It works well!\n"]},{$$data_type:"org-node",type:"paragraph",ref:"org160a8a5",properties:{"post-blank":0,"post-affiliated":9916,caption:[[["This third test just shows json."]]]},contents:[{$$data_type:"org-node",type:"link",ref:"org02c194c",properties:{type:"file",path:"./0004_third-test.png",format:"bracket","raw-link":"./0004_third-test.png",application:null,"search-option":null,"post-blank":0,"is-internal":!1,"target-ref":null,"is-inline-image":!0},contents:[]},"\n"]}]}]},{$$data_type:"org-node",type:"headline",ref:"org9056c88",drawer:{},properties:{"tags-all":[],"raw-value":"~OrgNodeFourthTest~: paragraph = p, bold = strong!","pre-blank":1,level:2,priority:null,tags:[],"todo-keyword":null,"todo-type":null,"post-blank":1,"footnote-section-p":!1,archivedp:!1,commentedp:!1,"post-affiliated":9960,title:[{$$data_type:"org-node",type:"code",ref:"org41bb33a",properties:{value:"OrgNodeFourthTest","post-blank":0},contents:[]},": paragraph = p, bold = strong!"]},contents:[{$$data_type:"org-node",type:"section",ref:"orga6b1869",properties:{"post-blank":1,"post-affiliated":10015},contents:[{$$data_type:"org-node",type:"paragraph",ref:"org3930b4d",properties:{"post-blank":1,"post-affiliated":10015},contents:["We do actually the elements for these two. For that reason we'll have an object\nthat has all the known element.\n"]},{$$data_type:"org-node",type:"src-block",ref:"org9ca70bf",properties:{language:"scheme",switches:null,parameters:null,"number-lines":null,"preserve-indent":!1,"retain-labels":!0,"use-labels":!0,"label-fmt":null,value:'(def org-node-default-components\n  (js#jso paragraph: "p" bold: "strong" unknown: org#OrgNodeUnknown))\n',"post-blank":1,"post-affiliated":10128},contents:[]},{$$data_type:"org-node",type:"paragraph",ref:"org0d96bc3",properties:{"post-blank":1,"post-affiliated":10261},contents:["A function that returns the correct element or component is a good idea. Having\ndifferent ones passed as a property is possible.\n"]},{$$data_type:"org-node",type:"src-block",ref:"org7ca806c",properties:{language:"scheme",switches:null,parameters:null,"number-lines":null,"preserve-indent":!1,"retain-labels":!0,"use-labels":!0,"label-fmt":null,value:"(def (org-node-component node comps defaults: (defaults org-node-default-components)\n\t\t\t (fail-key unknown:))\n  (def type (js#ref node type:))\n  (def (comp? t) (and t (not (js#undefined? t))))\n  (let* ((comp (and (comp? comps)\n\t\t    (js#ref comps type)))\n\t (comp (or (and (comp? comp) comp)\n\t\t   (js#ref defaults type)))\n\t (comp (or (and (comp? comp) comp)\n\t\t   (js#ref comps fail-key)))\n\t (comp (or (and (comp? comp) comp)\n\t\t   (js#ref defaults fail-key)))\n\t (comp (or (and (comp? comp) comp)\n\t\t   org#OrgNodeUnknown)))\n  ;(js#console.log 9876 defaults (js#scm->js comp))\n    comp))\n","post-blank":1,"post-affiliated":10391},contents:[]},{$$data_type:"org-node",type:"paragraph",ref:"org8d26c84",properties:{"post-blank":1,"post-affiliated":11005},contents:["Now a render function that renders a node item and its contents.\n"]},{$$data_type:"org-node",type:"src-block",ref:"org8b7b353",properties:{language:"scheme",switches:null,parameters:null,"number-lines":null,"preserve-indent":!1,"retain-labels":!0,"use-labels":!0,"label-fmt":null,value:"(def (render-org-node h node components)\n  (def nodeComponent (org-node-component node components))\n  (def contents (js#ref node contents:))\n  (def post-blank (js#ref node properties: post-blank:))\n  (def pb (##vector (##make-string post-blank #\\space)))\n  (def children (vector-map\n\t\t (lambda (n) (if (##string? n) n\n\t\t\t\t (render-org-node h n components)))\n\t\t (##vector-append contents pb)))\n   ;(js#console.log post-blank node (js#scm->js pb) (##vector-append children pb))\n  (h nodeComponent (js#jso props: (js#jso node: node components: components))\n     children))\n","post-blank":1,"post-affiliated":11071},contents:[]},{$$data_type:"org-node",type:"paragraph",ref:"orga09c474",properties:{"post-blank":1,"post-affiliated":11671},contents:["And another render function that renders an OrgNode component using its node.\n"]},{$$data_type:"org-node",type:"src-block",ref:"org2a5f37e",properties:{language:"scheme",switches:null,parameters:null,"number-lines":null,"preserve-indent":!1,"retain-labels":!0,"use-labels":!0,"label-fmt":null,value:"(def (renderOrgNode createElement context)\n  (def props (js#ref context props:))\n  (def node (js#ref props node:))\n  (def components (js#ref props components:))\n  (render-org-node createElement node components))\n","post-blank":1,"post-affiliated":11750},contents:[]},{$$data_type:"org-node",type:"paragraph",ref:"orge5235de",properties:{"post-blank":1,"post-affiliated":11992},contents:["What's found as really nice about functional components is there is no ",{$$data_type:"org-node",type:"code",ref:"org9e97560",properties:{value:"this","post-blank":1},contents:[]},"so\n",{$$data_type:"org-node",type:"code",ref:"org52a2569",properties:{value:"js#function","post-blank":1},contents:[]},"is not required.\n"]},{$$data_type:"org-node",type:"src-block",ref:"org67594eb",properties:{language:"scheme",switches:null,parameters:null,"number-lines":null,"preserve-indent":!1,"retain-labels":!0,"use-labels":!0,"label-fmt":null,value:"(def OrgNodeFourthTest (js#jso functional: #t render: renderOrgNode))\n","post-blank":1,"post-affiliated":12105},contents:[]},{$$data_type:"org-node",type:"paragraph",ref:"org95ff00b",properties:{"post-blank":2,"post-affiliated":12205},contents:["The result is very nice and starts to look like a document.\n"]},{$$data_type:"org-node",type:"paragraph",ref:"orgfa07050",properties:{"post-blank":0,"post-affiliated":12313,caption:[[["The fourth result is document-like"]]]},contents:[{$$data_type:"org-node",type:"link",ref:"org9ac8f78",properties:{type:"file",path:"./0004_fourth-test.png",format:"bracket","raw-link":"./0004_fourth-test.png",application:null,"search-option":null,"post-blank":0,"is-internal":!1,"target-ref":null,"is-inline-image":!0},contents:[]},"\n"]}]}]},{$$data_type:"org-node",type:"headline",ref:"org7197bc6",drawer:{},properties:{"tags-all":[],"raw-value":"Conclusion","pre-blank":1,level:2,priority:null,tags:[],"todo-keyword":null,"todo-type":null,"post-blank":0,"footnote-section-p":!1,archivedp:!1,commentedp:!1,"post-affiliated":12358,title:["Conclusion"]},contents:[{$$data_type:"org-node",type:"section",ref:"orgffd9a72",properties:{"post-blank":1,"post-affiliated":12373},contents:[{$$data_type:"org-node",type:"paragraph",ref:"org5dd3509",properties:{"post-blank":0,"post-affiliated":12373},contents:['Those functional components, is it turns out, are a wonderful way to go about it\nusing a language that itself is very "functional", as it were. It really helped to see how to move forward. Which we will!\n']}]}]}]},{$$data_type:"org-node",type:"headline",ref:"org3c4751a",drawer:{CUSTOM_ID:"OrgModeAndJson"},properties:{"tags-all":[],"raw-value":"*Org Mode* and ~json~","pre-blank":0,level:1,priority:null,tags:[],"todo-keyword":null,"todo-type":null,"post-blank":1,"footnote-section-p":!1,archivedp:!1,commentedp:!1,"post-affiliated":12578,title:[{$$data_type:"org-node",type:"bold",ref:"orgbaef887",properties:{"post-blank":1},contents:["Org Mode"]},"and ",{$$data_type:"org-node",type:"code",ref:"orgc34f48c",properties:{value:"json","post-blank":0},contents:[]}]},contents:[{$$data_type:"org-node",type:"section",ref:"org5309a50",properties:{"post-blank":1,"post-affiliated":12602},contents:[{$$data_type:"org-node",type:"paragraph",ref:"org31402eb",properties:{"post-blank":1,"post-affiliated":12649},contents:["As we ",{$$data_type:"org-node",type:"footnote-reference",ref:"orga9f846d",properties:{label:"rwe",type:"standard","post-blank":1},contents:[]},"develop a ",{$$data_type:"org-node",type:"code",ref:"org2d570fe",properties:{value:"gxjs","post-blank":1},contents:[]},"system almost everything is logged as a literate\nprogram. I'd love to publish those logs as a part of this application as they\nare both relevant and quite useful to expand our programming skills.\n"]},{$$data_type:"org-node",type:"paragraph",ref:"orge9b58b4",properties:{"post-blank":1,"post-affiliated":12878},contents:["Those files are ",{$$data_type:"org-node",type:"code",ref:"org1bcea6a",properties:{value:".org","post-blank":0},contents:[]},", AKA ",{$$data_type:"org-node",type:"link",ref:"org69b437a",properties:{type:"https",path:"//orgmode.org/",format:"bracket","raw-link":"https://orgmode.org/",application:null,"search-option":null,"post-blank":0,"is-internal":!1,"target-ref":null,"is-inline-image":!1},contents:["Org Mode"]},". ",{$$data_type:"org-node",type:"bold",ref:"org0b9ca0d",properties:{"post-blank":1},contents:["Org Mode"]},"is in ",{$$data_type:"org-node",type:"bold",ref:"orge513236",properties:{"post-blank":0},contents:["Emacs Lisp"]},", we are in\n",{$$data_type:"org-node",type:"bold",ref:"orgbf572a9",properties:{"post-blank":0},contents:["Gerbil Scheme"]},", which compiles to ",{$$data_type:"org-node",type:"bold",ref:"orgbc41f50",properties:{"post-blank":1},contents:["Gambit Scheme"]},"which then compiles to\n",{$$data_type:"org-node",type:"bold",ref:"org64d725b",properties:{"post-blank":0},contents:["JavaScript"]},".\n"]},{$$data_type:"org-node",type:"paragraph",ref:"orgf825bef",properties:{"post-blank":1,"post-affiliated":13072},contents:["That's wee bit of a headache waiting to happen, but there is ",{$$data_type:"org-node",type:"link",ref:"org88c6ac5",properties:{type:"https",path:"//github.com/jlumpe/ox-json",format:"bracket","raw-link":"https://github.com/jlumpe/ox-json",application:null,"search-option":null,"post-blank":0,"is-internal":!1,"target-ref":null,"is-inline-image":!1},contents:["ox-json"]},', a "JSON\nexport back end for Emacs Org mode". The use of which was hinted at in\n',{$$data_type:"org-node",type:"link",ref:"org9d8dacc",properties:{type:"custom-id",path:"OrgNodeTest",format:"bracket","raw-link":"#OrgNodeTest",application:null,"search-option":null,"post-blank":0,"is-internal":!0,"target-ref":"orgbd98ed8","is-inline-image":!1},contents:[{$$data_type:"org-node",type:"code",ref:"org03143c4",properties:{value:"OrgNodeTest","post-blank":0},contents:[]}]},".\n"]},{$$data_type:"org-node",type:"paragraph",ref:"org1a17625",properties:{"post-blank":1,"post-affiliated":13294},contents:["Phew! That takes care of that problem. We'll simply add a ",{$$data_type:"org-node",type:"bold",ref:"org9b17971",properties:{"post-blank":1},contents:["Shell Script"]},"that\nuses ",{$$data_type:"org-node",type:"bold",ref:"org7b782f4",properties:{"post-blank":1},contents:["Emacs"]},"to export an ",{$$data_type:"org-node",type:"bold",ref:"orgf971134",properties:{"post-blank":1},contents:["Org Mode"]},"file to ",{$$data_type:"org-node",type:"code",ref:"org5c8be90",properties:{value:"JSON","post-blank":1},contents:[]},"and avoid ",{$$data_type:"org-node",type:"bold",ref:"org59171f1",properties:{"post-blank":0},contents:["Scheme"]},"! Because\nafter al lthe entire point of this operation is to avoid scheme, especially\n",{$$data_type:"org-node",type:"bold",ref:"org1c92c6b",properties:{"post-blank":0},contents:["Gerbil"]},", and use other languages, am I right?\n"]},{$$data_type:"org-node",type:"src-block",ref:"orga02973a",properties:{language:"emacs-lisp",switches:null,parameters:null,"number-lines":null,"preserve-indent":!1,"retain-labels":!0,"use-labels":!0,"label-fmt":null,value:"(require 'package)\n(add-to-list 'package-archives '(\"melpa\" . \"https://melpa.org/packages/\") t)\n(package-initialize)\n(package-refresh-contents)\n(package-install 'ox-json)\n","post-blank":1,"post-affiliated":13576},contents:[]},{$$data_type:"org-node",type:"src-block",ref:"org5d22067",properties:{language:"emacs-lisp",switches:null,parameters:null,"number-lines":null,"preserve-indent":!1,"retain-labels":!0,"use-labels":!0,"label-fmt":null,value:"(package-initialize)\n(require 'ox-json)\n","post-blank":1,"post-affiliated":13781},contents:[]},{$$data_type:"org-node",type:"src-block",ref:"org624c4b6",properties:{language:"shell",switches:null,parameters:null,"number-lines":null,"preserve-indent":!1,"retain-labels":!0,"use-labels":!0,"label-fmt":null,value:'if [[ -z $1 ]] ; then echo "Logfile required" ; exit 1; fi\n_export_file=$(readlink -f $1)\n_dir=$(cd -P -- "$(dirname -- "$0")" && pwd -P)\n_to_dir=${2:-"$_dir/../../public/log"}\n\n\nls -d $_to_dir || mkdir -p $_to_dir\n\necho Exporting $_export_file to a js in $_to_dir\n\ncd $_dir;\n\n_add_ox () {\n ls ox-json* || emacs --batch --eval "(setq package-user-dir \\"`pwd`\\")"\\\n     -l ./install-ox-json.el --kill\n}\n_js_export () {\n  emacs $1 --eval "(setq package-user-dir \\"`pwd`\\")" -l ./init-export.el \\\n      --batch -f ox-json-export-to-file --kill\n}\n\n_export_log () {\n    _log=$1\n    _logdir=$(dirname $_log)\n    _fn=$(basename $_log .org)\n    _json=$_logdir/${_fn}.json\n    _js=$_to_dir/${_fn}.js\n\n    _add_ox\n    _js_export $_log\n\n    echo creating $_js;\n    echo export default $_json "->" $_js;\n\n    echo -n "export default " > $_js\n    cat $_json >> $_js;\n\n    echo "Removing" $_json;\n    # rm $_json\n\n }\n\n_export_log $_export_file\n',"post-blank":1,"post-affiliated":13855},contents:[]},{$$data_type:"org-node",type:"paragraph",ref:"orgbfd03c7",properties:{"post-blank":1,"post-affiliated":14814},contents:["Now we can simply export all of our logs as our exported ",{$$data_type:"org-node",type:"bold",ref:"org28fc661",properties:{"post-blank":1},contents:["JSON"]},{$$data_type:"org-node",type:"bold",ref:"orgb053278",properties:{"post-blank":0},contents:["OrgMode"]},"\ndocuments, weaved to perfection.\n"]},{$$data_type:"org-node",type:"src-block",ref:"orgc8dc4e0",properties:{language:"shell",switches:null,parameters:null,"number-lines":null,"preserve-indent":!1,"retain-labels":!0,"use-labels":!0,"label-fmt":null,value:'_dir=$(cd -P -- "$(dirname -- "$0")" && pwd -P)\ncd "$_dir"\nfind . -name \'*.org\' -exec ./export-log {} \\;\n_cp="cp *.png ../../public/log" ; echo $_cp; $_cp;\n',"post-blank":0,"post-affiliated":14922},contents:[]}]}]},{$$data_type:"org-node",type:"headline",ref:"org063cae1",drawer:{},properties:{"tags-all":[],"raw-value":"~OrgDoc~, ~OrgNode~ and friends","pre-blank":1,level:1,priority:null,tags:[],"todo-keyword":null,"todo-type":null,"post-blank":1,"footnote-section-p":!1,archivedp:!1,commentedp:!1,"post-affiliated":15107,title:[{$$data_type:"org-node",type:"code",ref:"org7791997",properties:{value:"OrgDoc","post-blank":0},contents:[]},", ",{$$data_type:"org-node",type:"code",ref:"orgbeeb229",properties:{value:"OrgNode","post-blank":1},contents:[]},"and friends"]},contents:[{$$data_type:"org-node",type:"section",ref:"orga152cc0",properties:{"post-blank":1,"post-affiliated":15142},contents:[{$$data_type:"org-node",type:"paragraph",ref:"orgeebe7f1",properties:{"post-blank":1,"post-affiliated":15142},contents:["We are so very close to having a document transformed, AKA ",{$$data_type:"org-node",type:"bold",ref:"org427190d",properties:{"post-blank":0},contents:["weaved"]},{$$data_type:"org-node",type:"footnote-reference",ref:"org053539c",properties:{label:"lwf",type:"standard","post-blank":0},contents:[]},",\nfrom our source code to ",{$$data_type:"org-node",type:"bold",ref:"org7a33968",properties:{"post-blank":1},contents:["HTML"]},"through a lot of steps.\n"]},{$$data_type:"org-node",type:"paragraph",ref:"org1e2c663",properties:{"post-blank":1,"post-affiliated":15275},contents:["Our ",{$$data_type:"org-node",type:"code",ref:"orgb6a5ae1",properties:{value:"OrgNode","post-blank":1},contents:[]},"becomes very simple.\n"]},{$$data_type:"org-node",type:"src-block",ref:"orgf0c5700",properties:{language:"scheme",switches:null,parameters:null,"number-lines":null,"preserve-indent":!1,"retain-labels":!0,"use-labels":!0,"label-fmt":null,value:"(def OrgNode (js#jso functional: #t render: org#renderOrgNode))\n","post-blank":1,"post-affiliated":15311},contents:[]},{$$data_type:"org-node",type:"paragraph",ref:"org4a9eae4",properties:{"post-blank":0,"post-affiliated":15405},contents:["Yet, a document contains many nodes of different types, so, it's time to see\nwhat they are.\n"]}]},{$$data_type:"org-node",type:"headline",ref:"org066a674",drawer:{},properties:{"tags-all":[],"raw-value":"~OrgDocFirstTest~: What are the node types?","pre-blank":1,level:2,priority:null,tags:[],"todo-keyword":null,"todo-type":null,"post-blank":1,"footnote-section-p":!1,archivedp:!1,commentedp:!1,"post-affiliated":15498,title:[{$$data_type:"org-node",type:"code",ref:"org60c90f6",properties:{value:"OrgDocFirstTest","post-blank":0},contents:[]},": What are the node types?"]},contents:[{$$data_type:"org-node",type:"section",ref:"org7e31e3d",properties:{"post-blank":1,"post-affiliated":15546},contents:[{$$data_type:"org-node",type:"paragraph",ref:"org71784ff",properties:{"post-blank":1,"post-affiliated":15546},contents:["To start with, a list of all the ",{$$data_type:"org-node",type:"code",ref:"orgaf42e29",properties:{value:"type:","post-blank":0},contents:[]},"'s.\n"]},{$$data_type:"org-node",type:"src-block",ref:"org8024b2e",properties:{language:"scheme",switches:null,parameters:null,"number-lines":null,"preserve-indent":!1,"retain-labels":!0,"use-labels":!0,"label-fmt":null,value:'(def (all-types doc)\n  (def types [])\n  (def (cs n) (##vector->list (js#ref n contents:)))\n  (let lp ((ns (cs doc)))\n   ;; (js#console.log (js#scm->js "types contets") ns)\n    (if (not (null? ns))\n      (let ((n (car ns))\n\t    (rst (cdr ns)))\n      ;;  (js#console.log (js#scm->js "node") n)\n\t(if (not (##string? n))\n\t  (begin (set! types (cons (js#ref n type:) types))\n\t\t (lp (cs n))))\n\t(lp rst))))\n  (reverse (##delete-duplicates types)))\n',"post-blank":1,"post-affiliated":15591},contents:[]},{$$data_type:"org-node",type:"paragraph",ref:"org4d58ea3",properties:{"post-blank":1,"post-affiliated":16062},contents:["Make the list into an, ummmm... list. Unordered list.\n"]},{$$data_type:"org-node",type:"src-block",ref:"orgfb822cd",properties:{language:"scheme",switches:null,parameters:null,"number-lines":null,"preserve-indent":!1,"retain-labels":!0,"use-labels":!0,"label-fmt":null,value:'(def (list->ul h lst)\n  (def <lis> (##map (cut h "li" <>) lst))\n  (h "ul" (##list->vector <lis>)))\n',"post-blank":1,"post-affiliated":16117},contents:[]},{$$data_type:"org-node",type:"paragraph",ref:"org9508359",properties:{"post-blank":1,"post-affiliated":16246},contents:["A render function tops it off.\n"]},{$$data_type:"org-node",type:"src-block",ref:"org5fee5f8",properties:{language:"scheme",switches:null,parameters:null,"number-lines":null,"preserve-indent":!1,"retain-labels":!0,"use-labels":!0,"label-fmt":null,value:"(def (renderOrgDocFirstTest h c)\n  (def doc (js#ref c props: document:))\n  ;; (js#console.log (js#scm->js (all-types doc)))\n  (list->ul h (all-types doc)))\n","post-blank":1,"post-affiliated":16278},contents:[]},{$$data_type:"org-node",type:"paragraph",ref:"orgd3a6fbd",properties:{"post-blank":1,"post-affiliated":16464},contents:["The component becomes as simple as last time.\n"]},{$$data_type:"org-node",type:"src-block",ref:"org3667143",properties:{language:"scheme",switches:null,parameters:null,"number-lines":null,"preserve-indent":!1,"retain-labels":!0,"use-labels":!0,"label-fmt":null,value:"(def OrgDocFirstTest (js#jso functional: #t render: renderOrgDocFirstTest))\n","post-blank":1,"post-affiliated":16511},contents:[]},{$$data_type:"org-node",type:"paragraph",ref:"org368cfb0",properties:{"post-blank":2,"post-affiliated":16617},contents:["And our test now says what we need to develop to make a nice weaving.\n"]},{$$data_type:"org-node",type:"paragraph",ref:"org0dac9c5",properties:{"post-blank":0,"post-affiliated":16732,caption:[[['A list of "types for org nodes"']]]},contents:[{$$data_type:"org-node",type:"link",ref:"orgfe53c83",properties:{type:"file",path:"./0004_first_doc_test.png",format:"bracket","raw-link":"./0004_first_doc_test.png",application:null,"search-option":null,"post-blank":0,"is-internal":!1,"target-ref":null,"is-inline-image":!0},contents:[]},"\n"]}]}]},{$$data_type:"org-node",type:"headline",ref:"orgf6d1ea8",drawer:{},properties:{"tags-all":[],"raw-value":"*Org* ~properties:~ goes beyond contents","pre-blank":1,level:2,priority:null,tags:[],"todo-keyword":null,"todo-type":null,"post-blank":0,"footnote-section-p":!1,archivedp:!1,commentedp:!1,"post-affiliated":16780,title:[{$$data_type:"org-node",type:"bold",ref:"orgff6d68f",properties:{"post-blank":1},contents:["Org"]},{$$data_type:"org-node",type:"code",ref:"org6ed732a",properties:{value:"properties:","post-blank":1},contents:[]},"goes beyond contents"]},contents:[{$$data_type:"org-node",type:"section",ref:"org6e2bcb0",properties:{"post-blank":1,"post-affiliated":16825},contents:[{$$data_type:"org-node",type:"paragraph",ref:"orgbbc2382",properties:{"post-blank":1,"post-affiliated":16825},contents:["Before we get into contents more completely it's time to shake hands with the\ndocument that contains them.\n"]},{$$data_type:"org-node",type:"paragraph",ref:"org444f5b0",properties:{"post-blank":1,"post-affiliated":16933},contents:["Just like an ",{$$data_type:"org-node",type:"code",ref:"org15894fc",properties:{value:'"org-node"',"post-blank":1},contents:[]},"an ",{$$data_type:"org-node",type:"code",ref:"orgb6b279b",properties:{value:'"org-document"',"post-blank":1},contents:[]},"has ",{$$data_type:"org-node",type:"code",ref:"org73d5ef0",properties:{value:"properties:","post-blank":0},contents:[]},".\n"]},{$$data_type:"org-node",type:"src-block",ref:"org320034c",properties:{language:"json",switches:null,parameters:null,"number-lines":null,"preserve-indent":!1,"retain-labels":!0,"use-labels":!0,"label-fmt":null,value:'{\n    "$$data_type": "org-document",\n    "properties": {\n\t"title": [\n\t    "Nested Components"\n\t],\n\t"filetags": [],\n\t"author": [\n\t    "Drew Crampsie"\n\t],\n\t"creator": "Emacs 28.0.50 (Org mode 9.4)",\n\t"date": [\n\t    {\n\t\t"$$data_type": "org-node",\n\t\t"type": "timestamp",\n\t\t"ref": "orgf20fdcd",\n\t\t"properties": {\n\t\t    "type": "inactive",\n\t\t    "raw-value": "[2020-12-02 Wed]",\n\t\t    "post-blank": 0,\n\t\t    "start": "2020-12-02",\n\t\t    "end": "2020-12-02"\n\t\t},\n\t\t"contents": []\n\t    }\n\t],\n\t"description": [],\n\t"email": "me@drewc.ca",\n\t"language": "en"\n    },\n    // [...]\n}\n',"post-blank":0,"post-affiliated":16999},contents:[]}]},{$$data_type:"org-node",type:"headline",ref:"org72bf3bb",drawer:{},properties:{"tags-all":[],"raw-value":"~org-value->child~","pre-blank":1,level:3,priority:null,tags:[],"todo-keyword":null,"todo-type":null,"post-blank":1,"footnote-section-p":!1,archivedp:!1,commentedp:!1,"post-affiliated":17596,title:[{$$data_type:"org-node",type:"code",ref:"org3214583",properties:{value:"org-value->child","post-blank":0},contents:[]}]},contents:[{$$data_type:"org-node",type:"section",ref:"org36bf7ec",properties:{"post-blank":1,"post-affiliated":17620},contents:[{$$data_type:"org-node",type:"paragraph",ref:"org8480ac0",properties:{"post-blank":1,"post-affiliated":17620},contents:["We did something similar inside the ",{$$data_type:"org-node",type:"code",ref:"orga02ed25",properties:{value:"render-org-node","post-blank":1},contents:[]},"but a property is not a node and the node contents cannot be a single string. We'll change that.\n"]},{$$data_type:"org-node",type:"src-block",ref:"org5f35a50",properties:{language:"scheme",switches:null,parameters:null,"number-lines":null,"preserve-indent":!1,"retain-labels":!0,"use-labels":!0,"label-fmt":null,value:'(def (org-node? t)\n  (and (##foreign? t)\n       (equal? (js#ref t $$data_type:) "org-node")))\n\n(def (org-value->child h value\n\t\t\t  (comps (js#jso))\n\t\t\t  (pb #f))\n  (def mapproc (lambda (nv) (org-value->child\n\t\t\t     h nv comps\n\t\t\t     pb)))\n  (def (ov->c v)\n    (cond ((##string? value) v)\n\t  ((##vector? v) ;(js#console.log v (##vector-length v))\n\t   (if (= 0 (##vector-length v)) "" (vector-map mapproc v)))\n\n\t  ((org-node? v) (org#render-org-node h v comps))\n\t  (else (js#console.error (js#scm->js "Cannot find a createElement child for: ") v)\n\t\t"")))\n\n  (let ((child (ov->c value)))\n    (if (not pb) child\n\t(let* ((child (if (##vector? child) child (##vector child)))\n\t       (pbstr (##make-string pb #\\space))\n\t       (len (##vector-length child)))\n\t  (set! (js#ref child len) pbstr)\n\t  child))))\n',"post-blank":0,"post-affiliated":17772},contents:[]}]}]},{$$data_type:"org-node",type:"headline",ref:"org4674604",drawer:{},properties:{"tags-all":[],"raw-value":"~OrgProp~ component","pre-blank":1,level:3,priority:null,tags:[],"todo-keyword":null,"todo-type":null,"post-blank":1,"footnote-section-p":!1,archivedp:!1,commentedp:!1,"post-affiliated":18604,title:[{$$data_type:"org-node",type:"code",ref:"org5f05c90",properties:{value:"OrgProp","post-blank":1},contents:[]},"component"]},contents:[{$$data_type:"org-node",type:"section",ref:"org117eaf4",properties:{"post-blank":1,"post-affiliated":18629},contents:[{$$data_type:"org-node",type:"paragraph",ref:"org5fbfb72",properties:{"post-blank":1,"post-affiliated":18629},contents:["A property is different from a node in that it's actually two objects, the key and the value. By default, a span will do.\n"]},{$$data_type:"org-node",type:"src-block",ref:"orgafc12aa",properties:{language:"scheme",switches:null,parameters:null,"number-lines":null,"preserve-indent":!1,"retain-labels":!0,"use-labels":!0,"label-fmt":null,value:'(def OrgProp\n  (js#jso\n   props: #( "key" )\n   functional: #t\n   render: (lambda (h c)\n\t     (def key (js#ref c props: key:))\n\t     (def val (js#ref c children:))\n\t     (def jval (vector-map (lambda (v) (if (##foreign? v) (js#foreign->js v) v))\n\t\t\t\t  val))\n\t    (js#console.log (js#scm->js key))\n\t     (if (and (vector? val) (= 0 (vector-length val))) ""\n\t\t (h "span" (js#jso class: "org-document-property")\n\t\t    (vector\n\t\t     (h "strong" (js#jso class: "key")\n\t\t\t(vector key (h "span" (js#jso domProps: (js#jso innerHTML: ":&nbsp;")))))\n\t\t     (h "big" (js#jso class: "value") (vector val " "))))))))\n\n\n',"post-blank":0,"post-affiliated":18752},contents:[]}]}]},{$$data_type:"org-node",type:"headline",ref:"org8007be8",drawer:{},properties:{"tags-all":[],"raw-value":"~find-org-component~","pre-blank":1,level:3,priority:null,tags:[],"todo-keyword":null,"todo-type":null,"post-blank":2,"footnote-section-p":!1,archivedp:!1,commentedp:!1,"post-affiliated":19388,title:[{$$data_type:"org-node",type:"code",ref:"org7ca3b40",properties:{value:"find-org-component","post-blank":0},contents:[]}]},contents:[{$$data_type:"org-node",type:"section",ref:"orgca3cc5e",properties:{"post-blank":2,"post-affiliated":19414},contents:[{$$data_type:"org-node",type:"paragraph",ref:"orgb35baf5",properties:{"post-blank":1,"post-affiliated":19414},contents:["Like ",{$$data_type:"org-node",type:"code",ref:"orgb62891a",properties:{value:"org-value->child","post-blank":0},contents:[]},", we need to make our ",{$$data_type:"org-node",type:"code",ref:"org435610e",properties:{value:"org-node-component","post-blank":1},contents:[]},"more general. And specific.\n"]},{$$data_type:"org-node",type:"src-block",ref:"org9b827f1",properties:{language:"scheme",switches:null,parameters:null,"number-lines":null,"preserve-indent":!1,"retain-labels":!0,"use-labels":!0,"label-fmt":null,value:"(def (find-org-component\n      key comps\n      defaults: (defaults org-props-default-components)\n      fail-key: (fail-key unknown:)\n      fail: (fail OrgProp))\n  (def (obj? t) (and t (not (js#undefined? t))))\n\n  (def (comp . maybes)\n    (if (null? maybes) fail\n\t(let ((comp? (car maybes)))\n\t  (if (obj? comp?) comp?\n\t      (##apply comp (cdr maybes))))))\n\n  (comp (and (obj? comps) (js#ref comps key))\n\t(js#ref defaults key)\n\t(and (obj? comps) (js#ref comps fail-key))\n\t(js#ref defaults fail-key)))\n\n(def (find-org-property-component key (comps (js#jso)))\n  (find-org-component key comps\n\t\t      defaults: org-props-default-components\n\t\t      fail-key: unknown:\n\t\t      fail: OrgProp))\n","post-blank":0,"post-affiliated":19509},contents:[]}]}]},{$$data_type:"org-node",type:"headline",ref:"org3730cb7",drawer:{},properties:{"tags-all":[],"raw-value":"~OrgPropTitle~","pre-blank":1,level:3,priority:null,tags:[],"todo-keyword":null,"todo-type":null,"post-blank":0,"footnote-section-p":!1,archivedp:!1,commentedp:!1,"post-affiliated":20227,title:[{$$data_type:"org-node",type:"code",ref:"orgd52a3cd",properties:{value:"OrgPropTitle","post-blank":0},contents:[]}]},contents:[{$$data_type:"org-node",type:"section",ref:"orgb375c7d",properties:{"post-blank":0,"post-affiliated":20247},contents:[{$$data_type:"org-node",type:"paragraph",ref:"org33db36e",properties:{"post-blank":1,"post-affiliated":20247},contents:["One property we'll give a component to is the ",{$$data_type:"org-node",type:"code",ref:"orgc5af347",properties:{value:"title:","post-blank":1},contents:[]},"property.\n"]},{$$data_type:"org-node",type:"src-block",ref:"org6025dc3",properties:{language:"scheme",switches:null,parameters:null,"number-lines":null,"preserve-indent":!1,"retain-labels":!0,"use-labels":!0,"label-fmt":null,value:'(def OrgPropTitle\n  (js#jso functional: #t\n\t  render: (lambda (h c)\n\t     (def val (js#ref c children:))\n\t\t(h "h1" (js#jso\n\t\t       style:\n\t\t      (js#jso\n\t\t       display: "block"\n\t\t       font-size: "2em"\n\t\t       font-weight: "bold"\n\t\t       line-height: "2em"\n\t\t       padding: 0\n\t\t       margin: 0)  class: "org-mode-title-property"\n\t\t      )\n\t\tval))))\n',"post-blank":0,"post-affiliated":20313},contents:[]}]}]},{$$data_type:"org-node",type:"headline",ref:"orgc6447d9",drawer:{},properties:{"tags-all":[],"raw-value":"~OrgNodeTimestamp~","pre-blank":1,level:3,priority:null,tags:[],"todo-keyword":null,"todo-type":null,"post-blank":0,"footnote-section-p":!1,archivedp:!1,commentedp:!1,"post-affiliated":20700,title:[{$$data_type:"org-node",type:"code",ref:"orgcf8c529",properties:{value:"OrgNodeTimestamp","post-blank":0},contents:[]}]},contents:[{$$data_type:"org-node",type:"section",ref:"orge15cad9",properties:{"post-blank":0,"post-affiliated":20724},contents:[{$$data_type:"org-node",type:"src-block",ref:"org2f9aaf1",properties:{language:"scheme",switches:null,parameters:null,"number-lines":null,"preserve-indent":!1,"retain-labels":!0,"use-labels":!0,"label-fmt":null,value:'(def OrgNodeTimestamp\n  (js#jso functional: #t\n\t  render: (lambda (h c)\n\t\t    (def cprops (js#ref c props:))\n\t\t    (def node (js#ref cprops node:))\n\t\t    (def org-props (js#ref node properties:))\n\t\t    (def start (js#ref org-props start:))\n\t\t    (def end (js#ref org-props end:))\n\t\t    (vector start (if (equal? start end) ""\n\t\t\t\t      (vector " to " end))))))\n',"post-blank":0,"post-affiliated":20724},contents:[]}]}]},{$$data_type:"org-node",type:"headline",ref:"org908847e",drawer:{},properties:{"tags-all":[],"raw-value":"~org-props-default-components~","pre-blank":1,level:3,priority:null,tags:[],"todo-keyword":null,"todo-type":null,"post-blank":1,"footnote-section-p":!1,archivedp:!1,commentedp:!1,"post-affiliated":21114,title:[{$$data_type:"org-node",type:"code",ref:"org06e9991",properties:{value:"org-props-default-components","post-blank":0},contents:[]}]},contents:[{$$data_type:"org-node",type:"section",ref:"org8228550",properties:{"post-blank":1,"post-affiliated":21150},contents:[{$$data_type:"org-node",type:"paragraph",ref:"org909dcdd",properties:{"post-blank":1,"post-affiliated":21150},contents:["We've got two.\n"]},{$$data_type:"org-node",type:"src-block",ref:"orge31027b",properties:{language:"scheme",switches:null,parameters:null,"number-lines":null,"preserve-indent":!1,"retain-labels":!0,"use-labels":!0,"label-fmt":null,value:"(def org-props-default-components\n  (js#jso title: OrgPropTitle  unknown: OrgProp))\n","post-blank":0,"post-affiliated":21166},contents:[]}]}]},{$$data_type:"org-node",type:"headline",ref:"org9f461c0",drawer:{},properties:{"tags-all":[],"raw-value":"New ~org-node-default-components~","pre-blank":1,level:3,priority:null,tags:[],"todo-keyword":null,"todo-type":null,"post-blank":1,"footnote-section-p":!1,archivedp:!1,commentedp:!1,"post-affiliated":21280,title:["New ",{$$data_type:"org-node",type:"code",ref:"org73ddd2c",properties:{value:"org-node-default-components","post-blank":0},contents:[]}]},contents:[{$$data_type:"org-node",type:"section",ref:"orge6dab70",properties:{"post-blank":1,"post-affiliated":21319},contents:[{$$data_type:"org-node",type:"paragraph",ref:"org66c1f80",properties:{"post-blank":1,"post-affiliated":21319},contents:["Add the timestamp in.\n"]},{$$data_type:"org-node",type:"src-block",ref:"org3f1b53b",properties:{language:"scheme",switches:null,parameters:null,"number-lines":null,"preserve-indent":!1,"retain-labels":!0,"use-labels":!0,"label-fmt":null,value:'(def org-node-default-components\n  (js#jso paragraph: "p" bold: "strong"\n\t  timestamp: OrgNodeTimestamp\n\t  unknown: org#OrgNodeUnknown))\n',"post-blank":0,"post-affiliated":21342},contents:[]}]}]},{$$data_type:"org-node",type:"headline",ref:"orgb2de88b",drawer:{},properties:{"tags-all":[],"raw-value":"~render-org-property~","pre-blank":1,level:3,priority:null,tags:[],"todo-keyword":null,"todo-type":null,"post-blank":1,"footnote-section-p":!1,archivedp:!1,commentedp:!1,"post-affiliated":21509,title:[{$$data_type:"org-node",type:"code",ref:"org662ee24",properties:{value:"render-org-property","post-blank":0},contents:[]}]},contents:[{$$data_type:"org-node",type:"section",ref:"org8c22435",properties:{"post-blank":1,"post-affiliated":21536},contents:[{$$data_type:"org-node",type:"paragraph",ref:"org2fcfd81",properties:{"post-blank":1,"post-affiliated":21536},contents:["It all comes together here.\n"]},{$$data_type:"org-node",type:"src-block",ref:"org3e44503",properties:{language:"scheme",switches:null,parameters:null,"number-lines":null,"preserve-indent":!1,"retain-labels":!0,"use-labels":!0,"label-fmt":null,value:"(def (render-org-property h key value comps)\n   (h (find-org-property-component key comps)\n      (js#jso props: (js#jso key: key))\n      (org-value->child h value comps)))\n","post-blank":0,"post-affiliated":21565},contents:[]}]}]},{$$data_type:"org-node",type:"headline",ref:"orgc3c08e4",drawer:{},properties:{"tags-all":[],"raw-value":"~OrgDocPropTest~","pre-blank":1,level:3,priority:null,tags:[],"todo-keyword":null,"todo-type":null,"post-blank":0,"footnote-section-p":!1,archivedp:!1,commentedp:!1,"post-affiliated":21767,title:[{$$data_type:"org-node",type:"code",ref:"orgd3cc6a1",properties:{value:"OrgDocPropTest","post-blank":0},contents:[]}]},contents:[{$$data_type:"org-node",type:"section",ref:"org996a46a",properties:{"post-blank":1,"post-affiliated":21789},contents:[{$$data_type:"org-node",type:"paragraph",ref:"org32e0961",properties:{"post-blank":1,"post-affiliated":21789},contents:["So, test it all out!\n"]},{$$data_type:"org-node",type:"src-block",ref:"orgd9bb362",properties:{language:"scheme",switches:null,parameters:null,"number-lines":null,"preserve-indent":!1,"retain-labels":!0,"use-labels":!0,"label-fmt":null,value:'(def OrgDocPropTest\n  (js#jso functional: #t\n\t  render: (lambda (h c)\n\t\t   (def doc (js#ref c props: document:))\n\t\t   (def comps (js#ref c props: components:))\n\t\t   (def props (js#ref doc properties:))\n\t\t   (h "div" (js#jso class: "org-mode-document-properties")\n\t\t      (js#map-object\n\t\t       (lambda (k v) (render-org-property h k v comps))\n\t\t       props)))))\n',"post-blank":1,"post-affiliated":21811},contents:[]},{$$data_type:"org-node",type:"paragraph",ref:"org0fb49a1",properties:{"post-blank":2,"post-affiliated":22205},contents:["Brilliant. I love seeing success on screen.\n"]},{$$data_type:"org-node",type:"paragraph",ref:"orgf28f402",properties:{"post-blank":0,"post-affiliated":22302,caption:[[["The properties displayed as a document."]]]},contents:[{$$data_type:"org-node",type:"link",ref:"orgd63f104",properties:{type:"file",path:"./0004_doc-proc-test.png",format:"bracket","raw-link":"./0004_doc-proc-test.png",application:null,"search-option":null,"post-blank":0,"is-internal":!1,"target-ref":null,"is-inline-image":!0},contents:[]},"\n"]}]}]}]}]},{$$data_type:"org-node",type:"headline",ref:"org92d793c",drawer:{},properties:{"tags-all":[],"raw-value":"~OrgDocTest~, the reason behind this log","pre-blank":1,level:1,priority:null,tags:[],"todo-keyword":null,"todo-type":null,"post-blank":1,"footnote-section-p":!1,archivedp:!1,commentedp:!1,"post-affiliated":22349,title:[{$$data_type:"org-node",type:"code",ref:"org3bc1699",properties:{value:"OrgDocTest","post-blank":0},contents:[]},", the reason behind this log"]},contents:[{$$data_type:"org-node",type:"section",ref:"orgd3a7b8d",properties:{"post-blank":1,"post-affiliated":22394},contents:[{$$data_type:"org-node",type:"paragraph",ref:"org14cf7b9",properties:{"post-blank":1,"post-affiliated":22394},contents:["First we'll add our ",{$$data_type:"org-node",type:"code",ref:"orgf54a72f",properties:{value:"OrgDocPropTest","post-blank":1},contents:[]},"to the components so we use that element by\ndefault but can change.\n"]},{$$data_type:"org-node",type:"src-block",ref:"org8d23084",properties:{language:"scheme",switches:null,parameters:null,"number-lines":null,"preserve-indent":!1,"retain-labels":!0,"use-labels":!0,"label-fmt":null,value:'(def org-node-default-components\n  (js#jso paragraph: "p" bold: "strong"\n\t  timestamp: org#OrgNodeTimestamp\n\t  unknown: org#OrgNodeUnknown\n\t  documentProperties: org#OrgDocPropTest))\n',"post-blank":1,"post-affiliated":22500},contents:[]},{$$data_type:"org-node",type:"paragraph",ref:"org9456af6",properties:{"post-blank":1,"post-affiliated":22713},contents:["Make a ",{$$data_type:"org-node",type:"code",ref:"org681d48d",properties:{value:"find-org-node-component","post-blank":1},contents:[]},"from the existing ",{$$data_type:"org-node",type:"code",ref:"org20b93e4",properties:{value:"find-org-component","post-blank":0},contents:[]},"\n"]},{$$data_type:"org-node",type:"src-block",ref:"org0d93e20",properties:{language:"scheme",switches:null,parameters:null,"number-lines":null,"preserve-indent":!1,"retain-labels":!0,"use-labels":!0,"label-fmt":null,value:"(def (find-org-node-component node key: (key (js#ref node type:)) (comps (js#jso)))\n  (org#find-org-component key comps\n\t\t      defaults: org-node-default-components\n\t\t      fail-key: unknown:\n\t\t      fail: org#OrgNodeUnknown))\n","post-blank":1,"post-affiliated":22786},contents:[]},{$$data_type:"org-node",type:"paragraph",ref:"org96983e8",properties:{"post-blank":1,"post-affiliated":23044},contents:["Redo the ",{$$data_type:"org-node",type:"code",ref:"org2737120",properties:{value:"OrgNodeUnknown","post-blank":1},contents:[]},"so that it displays a readable text.\n"]},{$$data_type:"org-node",type:"src-block",ref:"orgb260015",properties:{language:"scheme",switches:null,parameters:null,"number-lines":null,"preserve-indent":!1,"retain-labels":!0,"use-labels":!0,"label-fmt":null,value:'(def OrgNodeUnknown\n  (js#jso\n   functional: #t\n   render:\n   (lambda (h c)\n    (def node (js#ref c props: node:))\n    ;;(##apply js#console.log (##map js#scm->js (list "Unknown:" (js#ref node type:))))\n    (def children (js#ref c children:))\n    ;;(##apply js#console.log (##map js#scm->js (list "Chlidren:" children)))\n  (def post-blank (let ((post-blank (js#ref node properties: post-blank:)))\n\t\t    (and (##number? post-blank) (< 0 post-blank) post-blank)))\n    (if (or (js#undefined? children)\n\t    (= (if post-blank 1 0)\n\t       (##vector-length children)))\n      (let ((c (js#ref node properties: value:)))\n      ;;  (js#console.log (js#scm->js "Value") c)\n\t(if (not (js#undefined? c))\n\t  (set! children (org#org-value->child h c)))))\n    (h "div"\n       (js#jso style: (js#jso border: "1px solid black" display: "inline-block" padding: "0.5em"))\n       (vector (h "span"\n\t\t  (vector (h "strong" (vector "unknown: " (js#ref node type:) " ")) " "))\n\t       children)))))\n',"post-blank":0,"post-affiliated":23108},contents:[]}]},{$$data_type:"org-node",type:"headline",ref:"orgef5fd1c",drawer:{},properties:{"tags-all":[],"raw-value":"Revisit ~render[org-node|OrgNode]~","pre-blank":1,level:2,priority:null,tags:[],"todo-keyword":null,"todo-type":null,"post-blank":1,"footnote-section-p":!1,archivedp:!1,commentedp:!1,"post-affiliated":24115,title:["Revisit ",{$$data_type:"org-node",type:"code",ref:"orgcf0797f",properties:{value:"render[org-node|OrgNode]","post-blank":0},contents:[]}]},contents:[{$$data_type:"org-node",type:"section",ref:"org9acddb1",properties:{"post-blank":1,"post-affiliated":24154},contents:[{$$data_type:"org-node",type:"paragraph",ref:"orgb9014a3",properties:{"post-blank":1,"post-affiliated":24154},contents:["Just to use our new functions.\n"]},{$$data_type:"org-node",type:"src-block",ref:"orgcaff5c7",properties:{language:"scheme",switches:null,parameters:null,"number-lines":null,"preserve-indent":!1,"retain-labels":!0,"use-labels":!0,"label-fmt":null,value:"(def (render-org-node h node comps (element (find-org-node-component node comps)))\n  (def pre-blank (let ((pre-blank (js#ref node properties: pre-blank:)))\n\t\t    (and (##number? pre-blank) pre-blank)))\n  (def post-blank (let ((post-blank (js#ref node properties: post-blank:)))\n\t\t    (and (##number? post-blank) post-blank)))\n  (def data (js#jso props: (js#jso node: node components: comps)))\n  (def children (let ((c (org#org-value->child h (js#ref node contents:) comps post-blank)))\n\t\t  (if pre-blank\n\t\t    (vector (##make-string pre-blank #\\space) c)\n\t\t    (vector c))))\n  (h element data children))\n","post-blank":1,"post-affiliated":24186},contents:[]},{$$data_type:"org-node",type:"src-block",ref:"org78418cd",properties:{language:"scheme",switches:null,parameters:null,"number-lines":null,"preserve-indent":!1,"retain-labels":!0,"use-labels":!0,"label-fmt":null,value:"(def (renderOrgNode createElement context)\n  (def props (js#ref context props:))\n  (def node (js#ref props node:))\n  (def components (js#ref props components:))\n  (render-org-node createElement node components))\n","post-blank":0,"post-affiliated":24820},contents:[]}]}]},{$$data_type:"org-node",type:"headline",ref:"org5a2fcc5",drawer:{},properties:{"tags-all":[],"raw-value":"~renderOrgDocTest~","pre-blank":1,level:2,priority:null,tags:[],"todo-keyword":null,"todo-type":null,"post-blank":2,"footnote-section-p":!1,archivedp:!1,commentedp:!1,"post-affiliated":25062,title:[{$$data_type:"org-node",type:"code",ref:"org9544e36",properties:{value:"renderOrgDocTest","post-blank":0},contents:[]}]},contents:[{$$data_type:"org-node",type:"section",ref:"orgdc1e69e",properties:{"post-blank":2,"post-affiliated":25085},contents:[{$$data_type:"org-node",type:"paragraph",ref:"orgb2e90ec",properties:{"post-blank":1,"post-affiliated":25085},contents:["Given all that we have it's time to see a document. A render function does jyust\nthat.\n"]},{$$data_type:"org-node",type:"src-block",ref:"org843ce82",properties:{language:"scheme",switches:null,parameters:null,"number-lines":null,"preserve-indent":!1,"retain-labels":!0,"use-labels":!0,"label-fmt":null,value:'(def (renderOrgDocTest h c)\n  (def nprops (js#ref c props:))\n  (def doc (js#ref nprops document:))\n  (def comps (js#ref nprops components:))\n  (h "div" (vector "Org Doc Test"\n\t\t    (h (find-org-node-component doc key: \'documentProperties comps)\n\t\t     (js#jso props: (js#jso document: doc)))\n\t\t    (org#org-value->child h (js#ref doc contents:) comps))))\n',"post-blank":0,"post-affiliated":25173},contents:[]}]}]},{$$data_type:"org-node",type:"headline",ref:"org348c360",drawer:{},properties:{"tags-all":[],"raw-value":"Conclusion: ~OrgDocTest~ works wonders!!","pre-blank":1,level:2,priority:null,tags:[],"todo-keyword":null,"todo-type":null,"post-blank":0,"footnote-section-p":!1,archivedp:!1,commentedp:!1,"post-affiliated":25559,title:["Conclusion: ",{$$data_type:"org-node",type:"code",ref:"org4fc4243",properties:{value:"OrgDocTest","post-blank":1},contents:[]},"works wonders!!"]},contents:[{$$data_type:"org-node",type:"section",ref:"org1701fe2",properties:{"post-blank":1,"post-affiliated":25604},contents:[{$$data_type:"org-node",type:"paragraph",ref:"orgd5196c5",properties:{"post-blank":1,"post-affiliated":25604},contents:["We again have a simple functional component to string it all together.\n"]},{$$data_type:"org-node",type:"src-block",ref:"orgd814413",properties:{language:"scheme",switches:null,parameters:null,"number-lines":null,"preserve-indent":!1,"retain-labels":!0,"use-labels":!0,"label-fmt":null,value:"(def OrgDocTest\n  (js#jso functional: #t render: renderOrgDocTest))\n","post-blank":2,"post-affiliated":25676},contents:[]},{$$data_type:"org-node",type:"paragraph",ref:"org9d2c611",properties:{"post-blank":0,"post-affiliated":25826,caption:[[["The properties displayed as a document."]]]},contents:[{$$data_type:"org-node",type:"link",ref:"orgee5dd63",properties:{type:"file",path:"./0004_u_doc_test.png",format:"bracket","raw-link":"./0004_u_doc_test.png",application:null,"search-option":null,"post-blank":0,"is-internal":!1,"target-ref":null,"is-inline-image":!0},contents:[]},"\n"]}]}]}]},{$$data_type:"org-node",type:"headline",ref:"org987c504",drawer:{},properties:{"tags-all":[],"raw-value":"~OrgNode[*]~ and ~OrgDoc~","pre-blank":1,level:1,priority:null,tags:[],"todo-keyword":null,"todo-type":null,"post-blank":2,"footnote-section-p":!1,archivedp:!1,commentedp:!1,"post-affiliated":25870,title:[{$$data_type:"org-node",type:"code",ref:"org723d4a1",properties:{value:"OrgNode[*]","post-blank":1},contents:[]},"and ",{$$data_type:"org-node",type:"code",ref:"org297eb03",properties:{value:"OrgDoc","post-blank":0},contents:[]}]},contents:[{$$data_type:"org-node",type:"section",ref:"org4b813a5",properties:{"post-blank":1,"post-affiliated":25899},contents:[{$$data_type:"org-node",type:"paragraph",ref:"orgf4f2f22",properties:{"post-blank":0,"post-affiliated":25899},contents:["To complete this portion of this mission all the unknowns need to be met, taken\nin, and become members of the pack.\n"]}]},{$$data_type:"org-node",type:"headline",ref:"orgca5d42b",drawer:{},properties:{"tags-all":[],"raw-value":"~keyword:~ and ~OrgNodeNull~","pre-blank":0,level:2,priority:null,tags:[],"todo-keyword":null,"todo-type":null,"post-blank":1,"footnote-section-p":!1,archivedp:!1,commentedp:!1,"post-affiliated":26016,title:[{$$data_type:"org-node",type:"code",ref:"orgf02acef",properties:{value:"keyword:","post-blank":1},contents:[]},"and ",{$$data_type:"org-node",type:"code",ref:"orgf74741f",properties:{value:"OrgNodeNull","post-blank":0},contents:[]}]},contents:[{$$data_type:"org-node",type:"section",ref:"org6895cf6",properties:{"post-blank":1,"post-affiliated":26048},contents:[{$$data_type:"org-node",type:"paragraph",ref:"orgc242ea1",properties:{"post-blank":1,"post-affiliated":26048},contents:["To start with let us take the outsiders. Those that are a part of the group but\ndo not belong.\n"]},{$$data_type:"org-node",type:"src-block",ref:"org9aac277",properties:{language:"scheme",switches:null,parameters:null,"number-lines":null,"preserve-indent":!1,"retain-labels":!0,"use-labels":!0,"label-fmt":null,value:'(def OrgNodeNull (js#jso functional: #t render: (lambda _ "")))\n',"post-blank":1,"post-affiliated":26144},contents:[]},{$$data_type:"org-node",type:"paragraph",ref:"orgee91d45",properties:{"post-blank":1,"post-affiliated":26238},contents:["Make the keyword null.\n"]},{$$data_type:"org-node",type:"src-block",ref:"org4ad4ea7",properties:{language:"scheme",switches:null,parameters:null,"number-lines":null,"preserve-indent":!1,"retain-labels":!0,"use-labels":!0,"label-fmt":null,value:'(def org-node-default-components\n  (js#jso paragraph: "p" bold: "strong" keyword: OrgNodeNull\n\t  timestamp: org#OrgNodeTimestamp\n\t  unknown: org#OrgNodeUnknown\n\t  documentProperties: org#OrgDocPropTest))\n',"post-blank":0,"post-affiliated":26262},contents:[]}]}]},{$$data_type:"org-node",type:"headline",ref:"org511716b",drawer:{},properties:{"tags-all":[],"raw-value":"~section:~","pre-blank":1,level:2,priority:null,tags:[],"todo-keyword":null,"todo-type":null,"post-blank":1,"footnote-section-p":!1,archivedp:!1,commentedp:!1,"post-affiliated":26496,title:[{$$data_type:"org-node",type:"code",ref:"org78ec062",properties:{value:"section:","post-blank":0},contents:[]}]},contents:[{$$data_type:"org-node",type:"section",ref:"org07c410f",properties:{"post-blank":1,"post-affiliated":26511},contents:[{$$data_type:"org-node",type:"paragraph",ref:"org4286b24",properties:{"post-blank":1,"post-affiliated":26511},contents:["At this point, just a ",{$$data_type:"org-node",type:"code",ref:"org9aa6da3",properties:{value:"div","post-blank":0},contents:[]},". Easy! ",{$$data_type:"org-node",type:"bold",ref:"org0cb25b7",properties:{"post-blank":1},contents:["OrgMode"]},"is based on ",{$$data_type:"org-node",type:"bold",ref:"orgda1df7d",properties:{"post-blank":0},contents:["OutlineMode"]},",\ntheretofore a ",{$$data_type:"org-node",type:"code",ref:"org38a9be9",properties:{value:"headline:","post-blank":1},contents:[]},"wraps a section and not ",{$$data_type:"org-node",type:"italic",ref:"orgd6d6fa7",properties:{"post-blank":0},contents:["vice versa"]},".\n"]},{$$data_type:"org-node",type:"src-block",ref:"org91bd06c",properties:{language:"scheme",switches:null,parameters:null,"number-lines":null,"preserve-indent":!1,"retain-labels":!0,"use-labels":!0,"label-fmt":null,value:'(def org-node-default-components\n  (js#jso\n   section: "div" paragraph: "p" bold: "strong"\n   keyword: OrgNodeNull\n   timestamp: org#OrgNodeTimestamp\n   unknown: org#OrgNodeUnknown\n   documentProperties: org#OrgDocPropTest))\n',"post-blank":0,"post-affiliated":26648},contents:[]}]}]},{$$data_type:"org-node",type:"headline",ref:"orgb898627",drawer:{},properties:{"tags-all":[],"raw-value":"~renderOrgNodeChildren~","pre-blank":1,level:2,priority:null,tags:[],"todo-keyword":null,"todo-type":null,"post-blank":1,"footnote-section-p":!1,archivedp:!1,commentedp:!1,"post-affiliated":26903,title:[{$$data_type:"org-node",type:"code",ref:"orgc8ce347",properties:{value:"renderOrgNodeChildren","post-blank":0},contents:[]}]},contents:[{$$data_type:"org-node",type:"section",ref:"orgd8e1779",properties:{"post-blank":1,"post-affiliated":26931},contents:[{$$data_type:"org-node",type:"paragraph",ref:"orge268d11",properties:{"post-blank":1,"post-affiliated":26931},contents:["We want to pass components along. We need this for insider things.\n"]},{$$data_type:"org-node",type:"src-block",ref:"orgf591d76",properties:{language:"scheme",switches:null,parameters:null,"number-lines":null,"preserve-indent":!1,"retain-labels":!0,"use-labels":!0,"label-fmt":null,value:"(def (renderOrgNodeChildren h c (children (js#ref c children:))\n\t\t\t    (comps (js#ref c props: components:)))\n  (org#org-value->child h children comps))\n","post-blank":0,"post-affiliated":26999},contents:[]}]}]},{$$data_type:"org-node",type:"headline",ref:"orge84ca02",drawer:{},properties:{"tags-all":[],"raw-value":"~headline~ becomes ~OrgNodeHeadline~ with ~OrgNodeHeadlineTitle~","pre-blank":1,level:2,priority:null,tags:[],"todo-keyword":null,"todo-type":null,"post-blank":1,"footnote-section-p":!1,archivedp:!1,commentedp:!1,"post-affiliated":27182,title:[{$$data_type:"org-node",type:"code",ref:"org07a18a3",properties:{value:"headline","post-blank":1},contents:[]},"becomes ",{$$data_type:"org-node",type:"code",ref:"org70681d7",properties:{value:"OrgNodeHeadline","post-blank":1},contents:[]},"with ",{$$data_type:"org-node",type:"code",ref:"orge29a1e6",properties:{value:"OrgNodeHeadlineTitle","post-blank":0},contents:[]}]},contents:[{$$data_type:"org-node",type:"section",ref:"orga170722",properties:{"post-blank":1,"post-affiliated":27251},contents:[{$$data_type:"org-node",type:"src-block",ref:"org351272d",properties:{language:"scheme",switches:null,parameters:null,"number-lines":null,"preserve-indent":!1,"retain-labels":!0,"use-labels":!0,"label-fmt":null,value:'(def OrgNodeHeadlineTitle\n  (js#jso functional: #t\n\t  render: (lambda (h c)\n\t\t    (def level (js#ref c props: node: properties: level:))\n\t\t    (def sz (+ 0.75 (/ 2 level)))\n\t\t    (def size (##string-append (##number->string sz) "em"))\n\t\t    (def height (##string-append (##number->string (/ sz 2)) "em"))\n\t\t    (def style (let ((s (js#ref c props: style:)))\n\t\t\t\t (if (js#undefined? s)\n\t\t\t\t   (js#jso\n\t\t\t\t    display: "block"\n\t\t\t\t    font-size: size\n\t\t\t\t    font-weight: "bold"\n\t\t\t\t    line-height: height\n\t\t\t\t    padding: 0\n\t\t\t\t    margin: 0\n\t\t\t\t    margin-top: "0.75em"\n\t\t\t\t    margin-bottom: "0.5em")\n\t\t\t\t   s)))\n\t\t    (h (##string-append "h" (##number->string level))\n\t\t       (js#jso style: style)\n\t\t       (renderOrgNodeChildren\n\t\t\th c (js#ref c props: node: properties: title:))))))\n(def OrgNodeHeadline\n  (js#jso functional: #t\n\t  render: (lambda (h c)\n\t\t    (def node (js#ref c props: node:))\n\t\t    (def children (js#ref c children:))\n\t\t    (def props (js#ref node properties:))\n\t\t    (def comps (js#ref props components:))\n\t\t    (def data (js#jso props: (js#jso node: node components: comps)))\n\t\t   ; (js#console.log children)\n\t\t    (h "div" data\n\t\t       (##vector-append\n\t\t\t(vector (h (find-org-node-component node key: \'headlineTitle comps)\n\t\t\t\t   data))\n\t\t\tchildren)\n\t\t    ))))\n',"post-blank":1,"post-affiliated":27251},contents:[]},{$$data_type:"org-node",type:"src-block",ref:"orgf4e25be",properties:{language:"scheme",switches:null,parameters:null,"number-lines":null,"preserve-indent":!1,"retain-labels":!0,"use-labels":!0,"label-fmt":null,value:'(def org-node-default-components\n  (js#jso\n   section: "div" paragraph: "p" bold: "strong"\n   headline: OrgNodeHeadline\n   headlineTitle: OrgNodeHeadlineTitle\n   keyword: OrgNodeNull\n   timestamp: org#OrgNodeTimestamp\n   unknown: org#OrgNodeUnknown\n   documentProperties: org#OrgDocPropTest))\n',"post-blank":0,"post-affiliated":28572},contents:[]}]}]},{$$data_type:"org-node",type:"headline",ref:"orge28c4c6",drawer:{},properties:{"tags-all":[],"raw-value":"~make-OrgValueNode~","pre-blank":1,level:2,priority:null,tags:[],"todo-keyword":null,"todo-type":null,"post-blank":1,"footnote-section-p":!1,archivedp:!1,commentedp:!1,"post-affiliated":28895,title:[{$$data_type:"org-node",type:"code",ref:"org76080fa",properties:{value:"make-OrgValueNode","post-blank":0},contents:[]}]},contents:[{$$data_type:"org-node",type:"section",ref:"orge023416",properties:{"post-blank":1,"post-affiliated":28919},contents:[{$$data_type:"org-node",type:"paragraph",ref:"org7b43a1c",properties:{"post-blank":1,"post-affiliated":28919},contents:["Some nodes have their data in the ",{$$data_type:"org-node",type:"code",ref:"org886c4a9",properties:{value:"value:","post-blank":1},contents:[]},"property. If there are any\n",{$$data_type:"org-node",type:"code",ref:"org8122248",properties:{value:"post-blank:","post-blank":0},contents:[]},"'s they also have a child.\n"]},{$$data_type:"org-node",type:"paragraph",ref:"orgab3eaf5",properties:{"post-blank":1,"post-affiliated":29030},contents:['The simple tactic of "render them with this component/element" will do.\n']},{$$data_type:"org-node",type:"src-block",ref:"orga6883e7",properties:{language:"scheme",switches:null,parameters:null,"number-lines":null,"preserve-indent":!1,"retain-labels":!0,"use-labels":!0,"label-fmt":null,value:'(def (make-OrgValueNode comp)\n  (js#jso\n   functional: #t\n   render:\n   (lambda (h c)\n    (def node (js#ref c props: node:))\n    (def children (js#ref c children:))\n    (def value (renderOrgNodeChildren\n\t\th (js#ref c components:)\n\t\t(js#ref node properties: value:)))\n    (def vchild (##vector-append (if (##vector? value) value (##vector value))\n\t\t\t\t  children))\n    ;;  (js#console.log (js#scm->js "code value") (js#scm->js vchild) c)\n       (##vector-append (vector (h comp (js#jso props: (js#jso node: node)) value))\n\t\t\tchildren))))\n',"post-blank":0,"post-affiliated":29103},contents:[]}]}]},{$$data_type:"org-node",type:"headline",ref:"org3820952",drawer:{},properties:{"tags-all":[],"raw-value":"~OrgNodeCode~, the first use of a ValueNode","pre-blank":1,level:2,priority:null,tags:[],"todo-keyword":null,"todo-type":null,"post-blank":1,"footnote-section-p":!1,archivedp:!1,commentedp:!1,"post-affiliated":29669,title:[{$$data_type:"org-node",type:"code",ref:"org754ef3b",properties:{value:"OrgNodeCode","post-blank":0},contents:[]},", the first use of a ValueNode"]},contents:[{$$data_type:"org-node",type:"section",ref:"org3bb6106",properties:{"post-blank":1,"post-affiliated":29717},contents:[{$$data_type:"org-node",type:"src-block",ref:"orge9625a8",properties:{language:"scheme",switches:null,parameters:null,"number-lines":null,"preserve-indent":!1,"retain-labels":!0,"use-labels":!0,"label-fmt":null,value:'(def OrgNodeCode (make-OrgValueNode "code"))\n',"post-blank":0,"post-affiliated":29717},contents:[]}]}]},{$$data_type:"org-node",type:"headline",ref:"org0995f5e",drawer:{},properties:{"tags-all":[],"raw-value":"~OrgNodeSrcBlock~ is functioning yet non-functional.","pre-blank":1,level:2,priority:null,tags:[],"todo-keyword":null,"todo-type":null,"post-blank":1,"footnote-section-p":!1,archivedp:!1,commentedp:!1,"post-affiliated":29792,title:[{$$data_type:"org-node",type:"code",ref:"org36d0dd8",properties:{value:"OrgNodeSrcBlock","post-blank":1},contents:[]},"is functioning yet non-functional."]},contents:[{$$data_type:"org-node",type:"section",ref:"orgd6bd3f1",properties:{"post-blank":1,"post-affiliated":29849},contents:[{$$data_type:"org-node",type:"paragraph",ref:"org431c37e",properties:{"post-blank":1,"post-affiliated":29849},contents:["We'll use ",{$$data_type:"org-node",type:"bold",ref:"orgb1555fe",properties:{"post-blank":0},contents:["Prism"]},{$$data_type:"org-node",type:"footnote-reference",ref:"orgfd6b12a",properties:{label:"prism",type:"standard","post-blank":1},contents:[]},"for highlights. Because we want the ",{$$data_type:"org-node",type:"code",ref:"org9f17fc0",properties:{value:"mounted:","post-blank":0},contents:[]},"\nproperty it cannot be functional.\n"]},{$$data_type:"org-node",type:"src-block",ref:"org35da22d",properties:{language:"scheme",switches:null,parameters:null,"number-lines":null,"preserve-indent":!1,"retain-labels":!0,"use-labels":!0,"label-fmt":null,value:'(def OrgNodeSrcBlock\n  (js#jso\n  ;functional: #t\n   props: #( "node" "components")\n   mounted: (js#function ()\n\t       (##inline-host-statement\n\t\t "(Prism.highlightElement(g_scm2host(@1@).$el.firstChild));"\n\t\t  js#this))\n   render:\n   (js#function (h c)\n    (def c js#this)\n    (def node (js#ref c node:))\n    (def value (renderOrgNodeChildren h c (js#ref node properties: value:)))\n    (def lang (js#ref node properties: language:))\n    ;;(js#console.error (current-OrgDoc))\n    ;; (##inline-host-statement "window.food = (@1@);" (js#scm->js c))\n    (h "pre"\n       (vector\n\t(h "code"\n\t\t  (js#jso class: (##string-append "language-" lang))\n\t\t  value))))))\n\n',"post-blank":0,"post-affiliated":29959},contents:[]}]}]},{$$data_type:"org-node",type:"headline",ref:"orgab99c26",drawer:{},properties:{"tags-all":[],"raw-value":"~OrgTestSpecial~ and ~$mount~ makes dynamic scope for *Vue*","pre-blank":1,level:2,priority:null,tags:[],"todo-keyword":null,"todo-type":null,"post-blank":2,"footnote-section-p":!1,archivedp:!1,commentedp:!1,"post-affiliated":30647,title:[{$$data_type:"org-node",type:"code",ref:"org649858e",properties:{value:"OrgTestSpecial","post-blank":1},contents:[]},"and ",{$$data_type:"org-node",type:"code",ref:"org75c4ac1",properties:{value:"$mount","post-blank":1},contents:[]},"makes dynamic scope for ",{$$data_type:"org-node",type:"bold",ref:"orgd83c31e",properties:{"post-blank":0},contents:["Vue"]}]},contents:[{$$data_type:"org-node",type:"section",ref:"org2258429",properties:{"post-blank":1,"post-affiliated":30711},contents:[{$$data_type:"org-node",type:"paragraph",ref:"org4fb7863",properties:{"post-blank":1,"post-affiliated":30711},contents:["For ",{$$data_type:"org-node",type:"code",ref:"org762ab12",properties:{value:"footnote-reference","post-blank":0},contents:[]},", right now an unknown node, I need to access the\n",{$$data_type:"org-node",type:"code",ref:"org8a07ea2",properties:{value:"document:","post-blank":1},contents:[]},"property of the ",{$$data_type:"org-node",type:"code",ref:"org96afce1",properties:{value:"OrgDoc","post-blank":1},contents:[]},"parent node to see/know the footnote\nsection.\n"]},{$$data_type:"org-node",type:"paragraph",ref:"org60b5f8f",properties:{"post-blank":1,"post-affiliated":30869},contents:["There are so many ways to go about it in ",{$$data_type:"org-node",type:"bold",ref:"org2424403",properties:{"post-blank":0},contents:["JavaScript"]},". I could pass the document\nas ",{$$data_type:"org-node",type:"code",ref:"org1483262",properties:{value:"props:","post-blank":0},contents:[]},", or go up the ",{$$data_type:"org-node",type:"code",ref:"org693a701",properties:{value:"context.parent","post-blank":1},contents:[]},"or ",{$$data_type:"org-node",type:"code",ref:"org81f627f",properties:{value:"this.parent","post-blank":1},contents:[]},"chain. But that is\ncumbersome when there's ",{$$data_type:"org-node",type:"bold",ref:"org9d2c3cb",properties:{"post-blank":1},contents:["dynamic"]},"or ",{$$data_type:"org-node",type:"bold",ref:"orgeb13ef1",properties:{"post-blank":1},contents:["special"]},"scope to take care of just that.\n"]},{$$data_type:"org-node",type:"paragraph",ref:"orgd13d9cf",properties:{"post-blank":0,"post-affiliated":31110},contents:["Long story short: I wanted scheme's `parameterize` to work in ",{$$data_type:"org-node",type:"code",ref:"org5b932b5",properties:{value:"js","post-blank":0},contents:[]},", and\nspecifically around the ",{$$data_type:"org-node",type:"code",ref:"org3629572",properties:{value:"render:","post-blank":1},contents:[]},"functions. ",{$$data_type:"org-node",type:"bold",ref:"org90814d6",properties:{"post-blank":1},contents:["Vue.js"]},"does not nest render\nfunctions ",{$$data_type:"org-node",type:"italic",ref:"org61b0fb9",properties:{"post-blank":0},contents:["per se"]},". Rather they return a ",{$$data_type:"org-node",type:"code",ref:"org7c40d23",properties:{value:"createElement","post-blank":1},contents:[]},"object which calls the\nrender functions as ",{$$data_type:"org-node",type:"underline",ref:"org038cd04",properties:{"post-blank":1},contents:["something"]},"is mounted.\n"]}]},{$$data_type:"org-node",type:"headline",ref:"orgea28fc8",drawer:{},properties:{"tags-all":[],"raw-value":"~OrgTestUnSpecial~ and ~OrgTestComp~ fails","pre-blank":1,level:3,priority:null,tags:[],"todo-keyword":null,"todo-type":null,"post-blank":2,"footnote-section-p":!1,archivedp:!1,commentedp:!1,"post-affiliated":31382,title:[{$$data_type:"org-node",type:"code",ref:"org7588d8d",properties:{value:"OrgTestUnSpecial","post-blank":1},contents:[]},"and ",{$$data_type:"org-node",type:"code",ref:"orgdd5ef21",properties:{value:"OrgTestComp","post-blank":1},contents:[]},"fails"]},contents:[{$$data_type:"org-node",type:"section",ref:"orgeb217ed",properties:{"post-blank":2,"post-affiliated":31430},contents:[{$$data_type:"org-node",type:"paragraph",ref:"orgc76805b",properties:{"post-blank":1,"post-affiliated":31430},contents:["To demonstrate: this is what drove me to the around method.\n"]},{$$data_type:"org-node",type:"paragraph",ref:"orgcae868f",properties:{"post-blank":0,"post-affiliated":31491},contents:["A scheme parameter.\n"]},{$$data_type:"org-node",type:"src-block",ref:"org1ec7715",properties:{language:"scheme",switches:null,parameters:null,"number-lines":null,"preserve-indent":!1,"retain-labels":!0,"use-labels":!0,"label-fmt":null,value:'(def current-special-element (##make-parameter "i"))\n',"post-blank":1,"post-affiliated":31511},contents:[]},{$$data_type:"org-node",type:"paragraph",ref:"org5042de0",properties:{"post-blank":1,"post-affiliated":31594},contents:["A functional component that uses it and a non-functional component which uses\nthat first component.\n"]},{$$data_type:"org-node",type:"src-block",ref:"org0cc9c2c",properties:{language:"scheme",switches:null,parameters:null,"number-lines":null,"preserve-indent":!1,"retain-labels":!0,"use-labels":!0,"label-fmt":null,value:"(def OrgTestComp\n  (js#jso\n   functional: #t\n   render: (lambda (h c)\n\t     ;; (js#console.log 1543 c)\n\t     (h (current-special-element) (js#ref c children:)))))\n\n\n(def OrgTestSubComp\n  (js#jso\n   functional: #f\n   render: (js#function (h)\n\t     ;; (js#console.log 2515 js#this)\n\t     (h OrgTestComp (js#ref js#this $slots: default:)))))\n","post-blank":1,"post-affiliated":31695},contents:[]},{$$data_type:"org-node",type:"paragraph",ref:"org97461c2",properties:{"post-blank":1,"post-affiliated":32064},contents:['And now sone "toplevel" components which uses them. First, what fooled me.\n']},{$$data_type:"org-node",type:"src-block",ref:"org808d45b",properties:{language:"scheme",switches:null,parameters:null,"number-lines":null,"preserve-indent":!1,"retain-labels":!0,"use-labels":!0,"label-fmt":null,value:'(def OrgTestFoolSpecial\n  (js#jso functional: #t\n   render: (lambda (h c)\n\t     (parameterize ((current-special-element "b"))\n\t       (h OrgTestComp (vector "Special? So you think, FU P&T!"))))))\n',"post-blank":1,"post-affiliated":32140},contents:[]},{$$data_type:"org-node",type:"paragraph",ref:"orgf371e99",properties:{"post-blank":1,"post-affiliated":32366},contents:["This actually works, which confused the heck out of me.\n"]},{$$data_type:"org-node",type:"paragraph",ref:"org6f0a2d6",properties:{"post-blank":1,"post-affiliated":32469,caption:[[["The fool us special is a good show"]]]},contents:[{$$data_type:"org-node",type:"link",ref:"orgf8fbae3",properties:{type:"file",path:"./0004_test-fool-special.png",format:"bracket","raw-link":"./0004_test-fool-special.png",application:null,"search-option":null,"post-blank":0,"is-internal":!1,"target-ref":null,"is-inline-image":!0},contents:[]},"\n"]},{$$data_type:"org-node",type:"paragraph",ref:"org09f3a96",properties:{"post-blank":1,"post-affiliated":32520},contents:["Once we step outside of functional rendering it fails.\n"]},{$$data_type:"org-node",type:"src-block",ref:"org106f190",properties:{language:"scheme",switches:null,parameters:null,"number-lines":null,"preserve-indent":!1,"retain-labels":!0,"use-labels":!0,"label-fmt":null,value:'(def OrgTestUnSpecial\n  (js#jso functional: #t\n   render: (lambda (h c)\n\t     (parameterize ((current-special-element "h4"))\n\t       (h OrgTestSubComp (vector "Special? Nay :("))))))\n',"post-blank":1,"post-affiliated":32576},contents:[]},{$$data_type:"org-node",type:"paragraph",ref:"org4dcb216",properties:{"post-blank":1,"post-affiliated":32789},contents:["It does not work as (I) expected. It seems a functional component is rendered\ninside ",{$$data_type:"org-node",type:"code",ref:"org53879b1",properties:{value:"h","post-blank":1},contents:[]},"AKA ",{$$data_type:"org-node",type:"code",ref:"org79deaf8",properties:{value:"createElement","post-blank":0},contents:[]},". But a normal component is rendered when mounted, not when ",{$$data_type:"org-node",type:"code",ref:"org8bd9eb9",properties:{value:"createElement","post-blank":0},contents:[]},"'ed.\n"]},{$$data_type:"org-node",type:"paragraph",ref:"org99a16a9",properties:{"post-blank":1,"post-affiliated":32978},contents:["As they say:\n"]},{$$data_type:"org-node",type:"quote-block",ref:"org6877219",properties:{"post-blank":1,"post-affiliated":32992},contents:[{$$data_type:"org-node",type:"paragraph",ref:"org2529601",properties:{"post-blank":1,"post-affiliated":33006},contents:["What is ",{$$data_type:"org-node",type:"code",ref:"org0b77ff1",properties:{value:"createElement","post-blank":1},contents:[]},"actually returning? It’s not exactly a real DOM element.\nIt could perhaps more accurately be named ",{$$data_type:"org-node",type:"code",ref:"org8116a05",properties:{value:"createNodeDescription","post-blank":0},contents:[]},", as it\ncontains information describing to Vue what kind of node it should render on the\npage, including descriptions of any child nodes.\n"]},{$$data_type:"org-node",type:"paragraph",ref:"orgb396406",properties:{"post-blank":0,"post-affiliated":33291},contents:["We call this node description a “virtual node”, usually abbreviated to VNode.\n“Virtual DOM” is what we call the entire tree of VNodes, built by a tree of Vue\ncomponents. ",{$$data_type:"org-node",type:"footnote-reference",ref:"org338cfd7",properties:{label:"vdom",type:"standard","post-blank":0},contents:[]},"\n"]}]},{$$data_type:"org-node",type:"paragraph",ref:"orgdaefebb",properties:{"post-blank":1,"post-affiliated":33484},contents:["Because of that, the ",{$$data_type:"org-node",type:"italic",ref:"orge97e9da",properties:{"post-blank":1},contents:["Special"]},{$$data_type:"org-node",type:"code",ref:"org0303ec6",properties:{value:"parameter","post-blank":0},contents:[]},", AKA dynamic scope, is in the wrong\nplace.\n"]},{$$data_type:"org-node",type:"paragraph",ref:"orgeca5e09",properties:{"post-blank":0,"post-affiliated":33608,caption:[[["The unspecial does not h4"]]]},contents:[{$$data_type:"org-node",type:"link",ref:"org06a73f1",properties:{type:"file",path:"./0004_test-unspecial.png",format:"bracket","raw-link":"./0004_test-unspecial.png",application:null,"search-option":null,"post-blank":0,"is-internal":!1,"target-ref":null,"is-inline-image":!0},contents:[]},"\n"]}]}]},{$$data_type:"org-node",type:"headline",ref:"org331b090",drawer:{},properties:{"tags-all":[],"raw-value":"~Vue.prototype.$mount~ is where the special scope lies","pre-blank":1,level:3,priority:null,tags:[],"todo-keyword":null,"todo-type":null,"post-blank":1,"footnote-section-p":!1,archivedp:!1,commentedp:!1,"post-affiliated":33657,title:[{$$data_type:"org-node",type:"code",ref:"orgeace97e",properties:{value:"Vue.prototype.$mount","post-blank":1},contents:[]},"is where the special scope lies"]},contents:[{$$data_type:"org-node",type:"section",ref:"org8f44a40",properties:{"post-blank":1,"post-affiliated":33717},contents:[{$$data_type:"org-node",type:"paragraph",ref:"org128a1c9",properties:{"post-blank":1,"post-affiliated":33717},contents:["Because ",{$$data_type:"org-node",type:"code",ref:"org10b6f2e",properties:{value:"render:","post-blank":1},contents:[]},"functions do not actually have to call other render functions\nsimply wrapping ",{$$data_type:"org-node",type:"code",ref:"org7155b63",properties:{value:"parameterize","post-blank":1},contents:[]},"around ",{$$data_type:"org-node",type:"code",ref:"org980599e",properties:{value:"createElement","post-blank":1},contents:[]},"does not work.\n"]},{$$data_type:"org-node",type:"paragraph",ref:"org28d89f8",properties:{"post-blank":1,"post-affiliated":33867},contents:["Rather, ",{$$data_type:"org-node",type:"code",ref:"orga644c27",properties:{value:"render:","post-blank":1},contents:[]},"functions are called when a non-",{$$data_type:"org-node",type:"code",ref:"org4f8932a",properties:{value:"functional:","post-blank":1},contents:[]},"component is\n",{$$data_type:"org-node",type:"code",ref:"orge0cecae",properties:{value:"$mount","post-blank":0},contents:[]},"'ed. I wont bother to go into details, but at one point I had a component\nwrap another component and call ",{$$data_type:"org-node",type:"code",ref:"org8e512f6",properties:{value:"$mount()","post-blank":1},contents:[]},"on it.\n"]},{$$data_type:"org-node",type:"src-block",ref:"org5e808d8",properties:{language:"javascript",switches:null,parameters:null,"number-lines":null,"preserve-indent":!1,"retain-labels":!0,"use-labels":!0,"label-fmt":null,value:"self.__aroundNode.$mount();\n","post-blank":1,"post-affiliated":34077},contents:[]},{$$data_type:"org-node",type:"paragraph",ref:"org1f16952",properties:{"post-blank":1,"post-affiliated":34139},contents:["Trying to pass everything the correct way made me realize that I can just futz\nwith the prototype.\n"]},{$$data_type:"org-node",type:"paragraph",ref:"org0195e00",properties:{"post-blank":1,"post-affiliated":34239},contents:["This is now in the ",{$$data_type:"org-node",type:"code",ref:"org4a39f2e",properties:{value:"src/boot/gxjs.js","post-blank":1},contents:[]},"file.\n"]},{$$data_type:"org-node",type:"paragraph",ref:"orgc00c641",properties:{"post-blank":1,"post-affiliated":34284},contents:["First, keep the old one around.\n"]},{$$data_type:"org-node",type:"src-block",ref:"org49c065b",properties:{language:"javascript",switches:null,parameters:null,"number-lines":null,"preserve-indent":!1,"retain-labels":!0,"use-labels":!0,"label-fmt":null,value:"var gxVueOldMount = Vue.prototype.$mount\n","post-blank":1,"post-affiliated":34317},contents:[]},{$$data_type:"org-node",type:"paragraph",ref:"org8b43781",properties:{"post-blank":1,"post-affiliated":34392},contents:["One thing I discovered is that ",{$$data_type:"org-node",type:"code",ref:"org56a16ed",properties:{value:"$mount","post-blank":1},contents:[]},"certainly wants to mount something and\nfails if it does not. So we'll track if it is run.\n"]},{$$data_type:"org-node",type:"src-block",ref:"orgfa23eba",properties:{language:"javascript",switches:null,parameters:null,"number-lines":null,"preserve-indent":!1,"retain-labels":!0,"use-labels":!0,"label-fmt":null,value:"var gxVueOldMount = Vue.prototype.$mount\nVue.prototype.$mount = function (...args) {\n  var mountedP = false\n  const next = () => {\n    const res = gxVueOldMount.apply(this, args)\n    mountedP = true\n    return res\n  }\n\n  // Now the ~$around~ method if there, if not, same as last time.\n\n  const around = (fn, ...args) => { return fn.apply(this, args) }\n  if (typeof this.$around === 'function') {\n    around(this.$around, next)\n    // if next was not called, call it.\n    if (!mountedP) { next() }\n  } else {\n    next()\n  }\n  return this\n}\n","post-blank":1,"post-affiliated":34523},contents:[]},{$$data_type:"org-node",type:"paragraph",ref:"orgdb376a1",properties:{"post-blank":0,"post-affiliated":35097},contents:["That's all we need to have dynamic scope around the rendering.\n"]}]}]},{$$data_type:"org-node",type:"headline",ref:"org48e7665",drawer:{},properties:{"tags-all":[],"raw-value":"~OrgTestSpecial~ is the component to ~$mount~!!","pre-blank":1,level:3,priority:null,tags:[],"todo-keyword":null,"todo-type":null,"post-blank":0,"footnote-section-p":!1,archivedp:!1,commentedp:!1,"post-affiliated":35161,title:[{$$data_type:"org-node",type:"code",ref:"orgb60261f",properties:{value:"OrgTestSpecial","post-blank":1},contents:[]},"is the component to ",{$$data_type:"org-node",type:"code",ref:"org908152c",properties:{value:"$mount","post-blank":0},contents:[]},"!!"]},contents:[{$$data_type:"org-node",type:"section",ref:"org85aa20e",properties:{"post-blank":2,"post-affiliated":35214},contents:[{$$data_type:"org-node",type:"paragraph",ref:"orgb1567e9",properties:{"post-blank":1,"post-affiliated":35214},contents:["We've created a way to wrap an ",{$$data_type:"org-node",type:"code",ref:"orge5a87e9",properties:{value:"$around","post-blank":1},contents:[]},"around ",{$$data_type:"org-node",type:"code",ref:"org23d4620",properties:{value:"$mount","post-blank":1},contents:[]},"in ",{$$data_type:"org-node",type:"code",ref:"orgaf5cb96",properties:{value:"methods:","post-blank":0},contents:[]},". Let's use it.\n"]},{$$data_type:"org-node",type:"src-block",ref:"orged37de9",properties:{language:"scheme",switches:null,parameters:null,"number-lines":null,"preserve-indent":!1,"retain-labels":!0,"use-labels":!0,"label-fmt":null,value:'(def OrgTestSpecial\n  (js#jso\n   methods: (js#jso $around: (js#function (call-next-method)\n\t\t\t       (parameterize ((current-special-element "h4"))\n\t\t\t\t (call-next-method))))\n   render: (js#function (h)\n\t       (h OrgTestSubComp (vector "Special? Yay! :)")))))\n',"post-blank":2,"post-affiliated":35301},contents:[]},{$$data_type:"org-node",type:"paragraph",ref:"org51db6b3",properties:{"post-blank":0,"post-affiliated":35639,caption:[[["The special in the around does h4!"]]]},contents:[{$$data_type:"org-node",type:"link",ref:"org84126c5",properties:{type:"file",path:"./0004_test-special.png",format:"bracket","raw-link":"./0004_test-special.png",application:null,"search-option":null,"post-blank":0,"is-internal":!1,"target-ref":null,"is-inline-image":!0},contents:[]},"\n"]}]}]}]},{$$data_type:"org-node",type:"headline",ref:"org3ee2cf8",drawer:{},properties:{"tags-all":[],"raw-value":"~OrgDoc~ becomes a scheme parameter!","pre-blank":1,level:2,priority:null,tags:[],"todo-keyword":null,"todo-type":null,"post-blank":1,"footnote-section-p":!1,archivedp:!1,commentedp:!1,"post-affiliated":35686,title:[{$$data_type:"org-node",type:"code",ref:"org003cfe9",properties:{value:"OrgDoc","post-blank":1},contents:[]},"becomes a scheme parameter!"]},contents:[{$$data_type:"org-node",type:"section",ref:"orgc51b2b2",properties:{"post-blank":1,"post-affiliated":35727},contents:[{$$data_type:"org-node",type:"paragraph",ref:"org98d124a",properties:{"post-blank":1,"post-affiliated":35727},contents:["Because ",{$$data_type:"org-node",type:"code",ref:"org6a0976c",properties:{value:"OrgDoc","post-blank":1},contents:[]},"is a non-functional component the render function must be\nchanged.\n"]},{$$data_type:"org-node",type:"src-block",ref:"orgc5015db",properties:{language:"scheme",switches:null,parameters:null,"number-lines":null,"preserve-indent":!1,"retain-labels":!0,"use-labels":!0,"label-fmt":null,value:'(def (renderOrgDoc this h)\n  (def doc (js#ref this document:))\n  (def comps (js#ref this components:))\n    (h "div"\n       (##vector-append (vector (h (find-org-node-component doc key: \'documentProperties comps)\n\t\t\t\t   (js#jso props: (js#jso document: doc))))\n\t\t\t(org#org-value->child h (js#ref doc contents:) comps))))\n',"post-blank":1,"post-affiliated":35812},contents:[]},{$$data_type:"org-node",type:"paragraph",ref:"orgd904403",properties:{"post-blank":1,"post-affiliated":36162},contents:["Since the component is now an object and not a function we need to pass the\n",{$$data_type:"org-node",type:"code",ref:"org913751b",properties:{value:"props:","post-blank":1},contents:[]},"to make them a part of the object it seems.\n"]},{$$data_type:"org-node",type:"paragraph",ref:"orgf8a0cf9",properties:{"post-blank":1,"post-affiliated":36292},contents:["Beyond that a parameter, ",{$$data_type:"org-node",type:"code",ref:"orgdba1927",properties:{value:"current-OrgDoc","post-blank":0},contents:[]},", and that's that for now.\n"]},{$$data_type:"org-node",type:"src-block",ref:"org016c9cf",properties:{language:"scheme",switches:null,parameters:null,"number-lines":null,"preserve-indent":!1,"retain-labels":!0,"use-labels":!0,"label-fmt":null,value:'(def current-OrgDoc (##make-parameter #f))\n(def OrgDoc (js#jso props: #( "document" "components")\n\t\t    methods: (js#jso $around: (js#function (next)\n\t\t\t\t\t\t(parameterize ((current-OrgDoc js#this))\n\t\t\t\t\t\t  (next))))\n\t\t    render: (js#function (h) (renderOrgDoc js#this h))))\n',"post-blank":0,"post-affiliated":36361},contents:[]}]}]},{$$data_type:"org-node",type:"headline",ref:"org8eb39ca",drawer:{},properties:{"tags-all":[],"raw-value":"~OrgNodeFootnoteDefinition~","pre-blank":1,level:2,priority:null,tags:[],"todo-keyword":null,"todo-type":null,"post-blank":0,"footnote-section-p":!1,archivedp:!1,commentedp:!1,"post-affiliated":36665,title:[{$$data_type:"org-node",type:"code",ref:"org89afe9a",properties:{value:"OrgNodeFootnoteDefinition","post-blank":0},contents:[]}]},contents:[{$$data_type:"org-node",type:"section",ref:"orgf60ef24",properties:{"post-blank":0,"post-affiliated":36697},contents:[{$$data_type:"org-node",type:"paragraph",ref:"org08eabe0",properties:{"post-blank":1,"post-affiliated":36697},contents:['We really should store the nodes in the meta and not just the definitions, but\nthe thought process did not get there until it was "done" this way.\n']},{$$data_type:"org-node",type:"src-block",ref:"org68d1a44",properties:{language:"scheme",switches:null,parameters:null,"number-lines":null,"preserve-indent":!1,"retain-labels":!0,"use-labels":!0,"label-fmt":null,value:'(def (find-org-mode-footnote-definitions document)\n  (def defines (js#jso))\n  (def (set-def! node)\n    (set! (js#ref defines (js#ref node properties: label:)) node))\n  (def (find-defs node)\n   ; (js#console.error 3232 (js#ref node contents:) node)\n    (vector-map (lambda (n)\n\t\t    (if (org#org-node? n)\n\t\t      (if (equal? "footnote-definition" (js#ref n type:))\n\t\t\t(set-def! n)\n\t\t\t(find-defs n))\n\t\t      #f))\n\t\t  (js#ref node contents:)))\n\n  (find-defs document)\n  defines)\n\n(def (OrgDoc-footnote-definitions (Doc (current-OrgDoc)))\n  (def fndef? (js#ref (current-OrgDoc) meta: footnote: definition:))\n  (if (and fndef? (not (js#undefined? fndef?)))\n    fndef?\n    (let ((fndef (find-org-mode-footnote-definitions (js#ref Doc document:))))\n      (set! (js#ref (current-OrgDoc) meta: footnote: definition:)\n\tfndef)\n      fndef)))\n\n(def (org-footnote-definition-id node)\n  (string-append (js#ref node properties: label:) (js#ref node ref:)))\n\n(def OrgNodeFootnoteDefinition\n  { functional: #t\n    render: (lambda (h c)\n\t      (def node (js#ref c props: node))\n\t      (def label (js#ref node properties: label:))\n\t      (def inline? (js#ref c props: inline:))\n\t      (h "div" { style: { display: "inline-block" padding: "1em" } }\n\t\t (vector-append (vector\n\t\t\t\t (if (or (not inline?) (js#undefined? inline?))\n\t\t\t\t  (h "h5" label)\n\t\t\t\t  ""))\n\t\t\t\t(js#ref c children:))))\n   })\n\n',"post-blank":0,"post-affiliated":36845},contents:[]}]}]},{$$data_type:"org-node",type:"headline",ref:"org2746e06",drawer:{},properties:{"tags-all":[],"raw-value":"~OrgNodeFootnoteReference~","pre-blank":1,level:2,priority:null,tags:[],"todo-keyword":null,"todo-type":null,"post-blank":1,"footnote-section-p":!1,archivedp:!1,commentedp:!1,"post-affiliated":38248,title:[{$$data_type:"org-node",type:"code",ref:"org0347301",properties:{value:"OrgNodeFootnoteReference","post-blank":0},contents:[]}]},contents:[{$$data_type:"org-node",type:"section",ref:"org752efc5",properties:{"post-blank":1,"post-affiliated":38279},contents:[{$$data_type:"org-node",type:"paragraph",ref:"org257e12e",properties:{"post-blank":1,"post-affiliated":38279},contents:["A footnote reference ",{$$data_type:"org-node",type:"italic",ref:"org44a3fb8",properties:{"post-blank":1},contents:["can"]},"reference a footnote definition by the label.\nAccording to The ",{$$data_type:"org-node",type:"bold",ref:"org30a7646",properties:{"post-blank":1},contents:["OrgMode"]},"Documentation",{$$data_type:"org-node",type:"footnote-reference",ref:"orge6afb1d",properties:{label:"orgcf",type:"inline","post-blank":1},contents:["\n",{$$data_type:"org-node",type:"link",ref:"org7b670c8",properties:{type:"https",path:"//orgmode.org/manual/Creating-Footnotes.html",format:"plain","raw-link":"https://orgmode.org/manual/Creating-Footnotes.html",application:null,"search-option":null,"post-blank":0,"is-internal":!1,"target-ref":null,"is-inline-image":!1},contents:[]}]},"a footnote can be defined in\na number of ways.\n"]},{$$data_type:"org-node",type:"paragraph",ref:"org3ffdd39",properties:{"post-blank":1,"post-affiliated":38503},contents:["They start with 'fn:'. Remember when footnotes were numbered? That's the first.\n"]},{$$data_type:"org-node",type:"src-block",ref:"orge00c747",properties:{language:"org",switches:null,parameters:null,"number-lines":null,"preserve-indent":!1,"retain-labels":!0,"use-labels":!0,"label-fmt":null,value:"  The Org homepage[fn:1] now looks a lot better than it used to.\n...\n[fn:1] The link is: https://orgmode.org\n\n","post-blank":1,"post-affiliated":38584},contents:[]},{$$data_type:"org-node",type:"paragraph",ref:"org96bf341",properties:{"post-blank":1,"post-affiliated":38721},contents:["So here's our meta numbered attempt",{$$data_type:"org-node",type:"footnote-reference",ref:"org5013612",properties:{label:"42",type:"standard","post-blank":0},contents:[]},". It comes out in ",{$$data_type:"org-node",type:"code",ref:"org489f6b9",properties:{value:"oxjson","post-blank":1},contents:[]},"as follows.\n"]},{$$data_type:"org-node",type:"src-block",ref:"orgf826280",properties:{language:"json",switches:null,parameters:null,"number-lines":null,"preserve-indent":!1,"retain-labels":!0,"use-labels":!0,"label-fmt":null,value:'{\n    "$$data_type": "org-node",\n    "type": "footnote-reference",\n    "ref": "org485160e",\n    "properties": {\n\t"label": "42",\n\t"type": "standard",\n\t"post-blank": 0\n    },\n    "contents": []\n}\n',"post-blank":1,"post-affiliated":38803},contents:[]},{$$data_type:"org-node",type:"src-block",ref:"org8f760bc",properties:{language:"scheme",switches:null,parameters:null,"number-lines":null,"preserve-indent":!1,"retain-labels":!0,"use-labels":!0,"label-fmt":null,value:'\n(def OrgNodeFootnoteReferenceStandard\n  (cut js#jso functional: #f\n       props: #( "node" "components")\n       data: (js#function () { text-decoration: "none" show-definition: #f org-doc: #f definition: #f} )\n       created: (js#function () (set! (js#ref js#this org-doc:) (current-OrgDoc)))\n       ;; methods: (js#jso\n       ;;           $around: (js#function (next)\n       ;;                      (parameterize ((current-OrgDoc (js#ref js#this org-doc:))) (next))))\n       render: (js#function (h)\n\t       (def cod (or (js#ref js#this org-doc:) (current-OrgDoc)))\n\t       (def fn-ref (js#ref js#this node:))\n\t       (def label (js#ref fn-ref properties: label:))\n\t       (def fn-def (if cod (js#ref (OrgDoc-footnote-definitions cod) label)))\n\t       (def comps (js#ref js#this components:))\n\t       (def def-data (js#jso props: (js#jso node: fn-def components: comps inline: #t)))\n\t       (def (show-def) (if (not (js#undefined? fn-def)) (renderOrgNode h def-data) "NO DEF FOUND"))\n\t      ; (js#console.log 666 (js#scm->js label) cod fn-def js#this)\n\t       (h "div"\n\t\t  { style: (js#jso display: "inline") }\n\t\t  (vector\n\t\t   (h "sup"\n\t\t      { style: { text-decoration: (js#ref js#this text-decoration:)\n\t\t\t\t font-size: "50%" cursor: "pointer"\n\t\t\t\t}\n\t\t\ton: { mouseover: (lambda _ (set! (js#ref js#this text-decoration:)\n\t\t\t\t\t\t"underline"))\n\n\t\t\t      mouseleave: (lambda _ (set! (js#ref js#this text-decoration:)\n\t\t\t\t\t\t "none"))\n\t\t\t      click: (lambda _ (set! (js#ref js#this show-definition:)\n\t\t\t\t\t    (not (js#ref js#this show-definition:))))\n\t\t\t      }\n\t\t\t}\n\t\t      (vector label (js#ref js#this foo:)))\n\t\t   (if (js#ref js#this show-definition:)\n\t\t     (show-def)\n\t\t     ""))))))\n\n',"post-blank":0,"post-affiliated":39025},contents:[]}]}]},{$$data_type:"org-node",type:"headline",ref:"org61d6526",drawer:{},properties:{"tags-all":[],"raw-value":"~OrgNodeLink~","pre-blank":1,level:2,priority:null,tags:[],"todo-keyword":null,"todo-type":null,"post-blank":1,"footnote-section-p":!1,archivedp:!1,commentedp:!1,"post-affiliated":40745,title:[{$$data_type:"org-node",type:"code",ref:"orgbddb908",properties:{value:"OrgNodeLink","post-blank":0},contents:[]}]},contents:[{$$data_type:"org-node",type:"section",ref:"org3b84490",properties:{"post-blank":1,"post-affiliated":40763},contents:[{$$data_type:"org-node",type:"paragraph",ref:"org90509a5",properties:{"post-blank":1,"post-affiliated":40763},contents:["There are different sorts of links. What I learned in the footnote attempt is\nhow ",{$$data_type:"org-node",type:"code",ref:"org60e5603",properties:{value:"Async Components","post-blank":0},contents:[]},{$$data_type:"org-node",type:"footnote-reference",ref:"org8d7d05c",properties:{label:"vac",type:"standard","post-blank":1},contents:[]},'work. I think that mixed with object local\n"components" IF I can refer to them by name get get rid of a lot of\n',{$$data_type:"org-node",type:"code",ref:"org27076cb",properties:{value:"find-org-node-*","post-blank":1},contents:[]},"type code.\n"]},{$$data_type:"org-node",type:"paragraph",ref:"org9669bfe",properties:{"post-blank":1,"post-affiliated":41013},contents:["But I digress.\n"]},{$$data_type:"org-node",type:"paragraph",ref:"org4d935e8",properties:{"post-blank":1,"post-affiliated":41029},contents:["What that allows is us to define a node as a function that either returns a node\nor fails trying.\n"]},{$$data_type:"org-node",type:"paragraph",ref:"orgb20daf1",properties:{"post-blank":1,"post-affiliated":41128},contents:["We don't want to fail. So to start.\n"]},{$$data_type:"org-node",type:"src-block",ref:"org95d5e7d",properties:{language:"scheme",switches:null,parameters:null,"number-lines":null,"preserve-indent":!1,"retain-labels":!0,"use-labels":!0,"label-fmt":null,value:"(def OrgNodeLink\n  (lambda (resolve _)\n    (resolve (OrgNodeLinkUnknown))))\n","post-blank":1,"post-affiliated":41165},contents:[]},{$$data_type:"org-node",type:"paragraph",ref:"org48959d5",properties:{"post-blank":1,"post-affiliated":41271},contents:["Last time I also did some mouse binding. I'll do that again for an unknown link\nso I can see what it is. It's not a function but an object.\n"]},{$$data_type:"org-node",type:"src-block",ref:"org5e0472d",properties:{language:"scheme",switches:null,parameters:null,"number-lines":null,"preserve-indent":!1,"retain-labels":!0,"use-labels":!0,"label-fmt":null,value:'\n(def (js#JSON.stringify jso (f2host #t))\n  (let ((obj (if (and f2host (##foreign? jso)) (js#foreign->js jso) jso)))\n    (##inline-host-expression "g_host2scm(JSON.stringify(@1@));" obj)))\n\n(def OrgNodeLinkUnknown\n  (cut js#jso\n       functional: #f\n       props: #( "node" "components")\n       data: (js#function () { show-definition: #f } )\n      ; created: (js#function () (set! (js#ref js#this org-doc:) (current-OrgDoc)))\n       render: (js#function\n\t\t(h)\n\t\t(def link-node (js#ref js#this node:))\n\t\t(def link-type (js#ref link-node properties: type:))\n\t\t(def comps (js#ref js#this components:))\n\t\t(def (show-def) (h "div" {style: {display: "inline-block"}}\n\t\t\t\t   (vector (js#JSON.stringify link-node))))\n\t\t(h "a" { on: {click: (lambda _ (set! (js#ref js#this show-definition:)\n\t\t\t\t\t     (not (js#ref js#this show-definition:))))}\n\t\t\t style: { border: "1px solid black" }\n\t\t       }\n\t\t   (vector-append\n\t\t    (vector "Unknown: " link-type\n\t\t\t    (if (js#ref js#this show-definition:)\n\t\t\t      (show-def)\n\t\t\t      ""))\n\t\t    (js#ref js#this $children:))))))\n\n',"post-blank":0,"post-affiliated":41412},contents:[]}]},{$$data_type:"org-node",type:"headline",ref:"orgdb6aad0",drawer:{},properties:{"tags-all":[],"raw-value":"~OrgNodeLinkHttps~","pre-blank":1,level:3,priority:null,tags:[],"todo-keyword":null,"todo-type":null,"post-blank":2,"footnote-section-p":!1,archivedp:!1,commentedp:!1,"post-affiliated":42505,title:[{$$data_type:"org-node",type:"code",ref:"org1700721",properties:{value:"OrgNodeLinkHttps","post-blank":0},contents:[]}]},contents:[{$$data_type:"org-node",type:"section",ref:"orgc02bc3c",properties:{"post-blank":2,"post-affiliated":42529},contents:[{$$data_type:"org-node",type:"paragraph",ref:"orgfa88827",properties:{"post-blank":1,"post-affiliated":42529},contents:["The first I see in this document is a footnote ",{$$data_type:"org-node",type:"code",ref:"org5b7cf30",properties:{value:"oxjson","post-blank":0},contents:[]},".\n"]},{$$data_type:"org-node",type:"src-block",ref:"org807a13f",properties:{language:"json",switches:null,parameters:null,"number-lines":null,"preserve-indent":!1,"retain-labels":!0,"use-labels":!0,"label-fmt":null,value:'{\n"$$data_type": "org-node",\n"type": "link",\n"ref": "orgf58126d",\n"properties": {\n"type": "https",\n"path": "//github.com/jlumpe/ox-json",\n"format": "plain",\n"raw-link": "https://github.com/jlumpe/ox-json",\n"application": null,\n"search-option": null,\n"post-blank": 0,\n"is-internal": false,\n"target-ref": null,\n"is-inline-image": false\n},\n"contents": []\n}\n',"post-blank":1,"post-affiliated":42587},contents:[]},{$$data_type:"org-node",type:"paragraph",ref:"orgb1ace3e",properties:{"post-blank":1,"post-affiliated":42969},contents:["What matters to us first is the ",{$$data_type:"org-node",type:"code",ref:"org4eb2c02",properties:{value:"properties.type","post-blank":1},contents:[]},"field.\n"]},{$$data_type:"org-node",type:"src-block",ref:"org9f47fb8",properties:{language:"scheme",switches:null,parameters:null,"number-lines":null,"preserve-indent":!1,"retain-labels":!0,"use-labels":!0,"label-fmt":null,value:"(def org-node-link-type (cut js#ref <> properties: type:))\n","post-blank":1,"post-affiliated":43027},contents:[]},{$$data_type:"org-node",type:"paragraph",ref:"org828b12d",properties:{"post-blank":1,"post-affiliated":43116},contents:["For this it is ",{$$data_type:"org-node",type:"code",ref:"orgffdca4f",properties:{value:'"https"',"post-blank":0},contents:[]},". I note there is no contents, but I predict there will\nbe for others.\n"]},{$$data_type:"org-node",type:"src-block",ref:"org66b6872",properties:{language:"scheme",switches:null,parameters:null,"number-lines":null,"preserve-indent":!1,"retain-labels":!0,"use-labels":!0,"label-fmt":null,value:'(def OrgNodeLinkHttps\n  { functional: #t\n    render: (lambda (h c)\n\t      (def node (js#ref c props: node:))\n\t      (def path (js#ref node properties: path:))\n\t      #;(js#console.log 4323 path c (js#ref c props:) (js#ref c props: node:))\n\t      (def children (let ((cs (js#ref c children:)))\n\t\t\t      (if (> (vector-length cs) 0) cs\n\t\t\t\t  (vector (js#ref node properties: raw-link:)))))\n\t      (if (not (##string? path)) (h "strong" "NO PATH?")\n\t\t  (h "a" { attrs: { href: (##string-append "https://" path)\n\t\t\t\t    target: "_blank"\n\t\t\t\t  }\n\t\t\t }\n\t\t     children)))\n  })\n',"post-blank":1,"post-affiliated":43212},contents:[]},{$$data_type:"org-node",type:"paragraph",ref:"org1fbc184",properties:{"post-blank":1,"post-affiliated":43813},contents:["So a new ",{$$data_type:"org-node",type:"code",ref:"orgfac082b",properties:{value:"OrgNodeLink","post-blank":0},contents:[]},", now with an ",{$$data_type:"org-node",type:"code",ref:"org931f77b",properties:{value:"OrgNodeChooseLink","post-blank":1},contents:[]},"functional thing.\n"]},{$$data_type:"org-node",type:"src-block",ref:"orgdb786ab",properties:{language:"scheme",switches:null,parameters:null,"number-lines":null,"preserve-indent":!1,"retain-labels":!0,"use-labels":!0,"label-fmt":null,value:'#;(def OrgNodeChooseLink\n  (lambda (r _) (r\n\t    { functional: #f\n\t      props: #("node")\n\t      render: (js#function\n\t\t       (h)\n\t\t       (def node (js#ref js#this node:))\n\t\t       (def type (org-node-link-type node))\n\t\t       (js#console.log 7666 js#this (current-org-paragraph-properties))\n\t\t       (h\n\t\t\t(cond ((equal? type "https") OrgNodeLinkHttps)\n\t\t\t      (else (OrgNodeLinkUnknown)))\n\t\t\t{ props: { node: node } }\n\t\t\t(js#ref js#this $children:)))\n       })))\n(def OrgNodeChooseLinkFunctional\n     { functional: #t\n  ;     props: #("node")\n       render: (js#function\n\t\t(h c)\n\t\t(def node (js#ref c props: node:))\n\t\t(def type (org-node-link-type node))\n\t      ;;  (js#console.log 10007666 (current-org-paragraph-properties))\n\t\t(h\n\t\t (cond ((equal? type "https") OrgNodeLinkHttps)\n\t\t       (else (OrgNodeLinkUnknown)))\n\t\t (js#ref c data:)\n\t\t (js#ref c children:)))\n       })\n(def OrgNodeLink OrgNodeChooseLinkFunctional)\n',"post-blank":0,"post-affiliated":43888},contents:[]}]}]},{$$data_type:"org-node",type:"headline",ref:"org02ed1b8",drawer:{},properties:{"tags-all":[],"raw-value":"~OrgModeLinkInlineImage~","pre-blank":1,level:3,priority:null,tags:[],"todo-keyword":null,"todo-type":null,"post-blank":1,"footnote-section-p":!1,archivedp:!1,commentedp:!1,"post-affiliated":44846,title:[{$$data_type:"org-node",type:"code",ref:"org844c8a5",properties:{value:"OrgModeLinkInlineImage","post-blank":0},contents:[]}]},contents:[{$$data_type:"org-node",type:"section",ref:"orgdbb3914",properties:{"post-blank":1,"post-affiliated":44876},contents:[{$$data_type:"org-node",type:"paragraph",ref:"org88a7da2",properties:{"post-blank":1,"post-affiliated":44876},contents:["This time around I wanted inline images as they are a great way to show\nscreenshots along the way.\n"]},{$$data_type:"org-node",type:"src-block",ref:"org959d104",properties:{language:"json",switches:null,parameters:null,"number-lines":null,"preserve-indent":!1,"retain-labels":!0,"use-labels":!0,"label-fmt":null,value:'{\n    "$$data_type": "org-node",\n    "type": "link",\n    "ref": "org851c986",\n    "properties": {\n\t"type": "file",\n\t"path": "./0004_first-test.png",\n\t"format": "bracket",\n\t"raw-link": "./0004_first-test.png",\n\t"application": null,\n\t"search-option": null,\n\t"post-blank": 0,\n\t"is-internal": false,\n\t"target-ref": null,\n\t"is-inline-image": true\n    },\n    "contents": []\n}\n',"post-blank":0,"post-affiliated":44976},contents:[]}]},{$$data_type:"org-node",type:"headline",ref:"org26e084b",drawer:{},properties:{"tags-all":[],"raw-value":"~<img src=...>~. We need to know the path","pre-blank":1,level:4,priority:null,tags:[],"todo-keyword":null,"todo-type":null,"post-blank":1,"footnote-section-p":!1,archivedp:!1,commentedp:!1,"post-affiliated":45374,title:[{$$data_type:"org-node",type:"code",ref:"orgbd92b5d",properties:{value:"<img src=...>","post-blank":0},contents:[]},". We need to know the path"]},contents:[{$$data_type:"org-node",type:"section",ref:"orgadec63a",properties:{"post-blank":1,"post-affiliated":45422},contents:[{$$data_type:"org-node",type:"paragraph",ref:"orgb4daf82",properties:{"post-blank":1,"post-affiliated":45422},contents:["Right now there's no rhyme or reason behind our testing so no way to know the location.\n"]},{$$data_type:"org-node",type:"paragraph",ref:"org281d316",properties:{"post-blank":1,"post-affiliated":45511},contents:["When I have routing setup the existing path should just work. For now.\n"]},{$$data_type:"org-node",type:"src-block",ref:"org9af07ec",properties:{language:"scheme",switches:null,parameters:null,"number-lines":null,"preserve-indent":!1,"retain-labels":!0,"use-labels":!0,"label-fmt":null,value:'(def (org-hack-img-path path)\n  (string-append "/log/" path))\n',"post-blank":0,"post-affiliated":45583},contents:[]}]}]},{$$data_type:"org-node",type:"headline",ref:"org768e3d1",drawer:{},properties:{"tags-all":[],"raw-value":"Caption?","pre-blank":1,level:4,priority:null,tags:[],"todo-keyword":null,"todo-type":null,"post-blank":1,"footnote-section-p":!1,archivedp:!1,commentedp:!1,"post-affiliated":45675,title:["Caption?"]},contents:[{$$data_type:"org-node",type:"section",ref:"org4139fe8",properties:{"post-blank":1,"post-affiliated":45690},contents:[{$$data_type:"org-node",type:"paragraph",ref:"org2dace75",properties:{"post-blank":1,"post-affiliated":45690},contents:["But wait! There's actually a caption around it.\n"]},{$$data_type:"org-node",type:"src-block",ref:"orged05de4",properties:{language:"json",switches:null,parameters:null,"number-lines":null,"preserve-indent":!1,"retain-labels":!0,"use-labels":!0,"label-fmt":null,value:'{\n    "$$data_type": "org-node",\n    "type": "paragraph",\n    "ref": "orga12671a",\n    "properties": {\n\t"post-blank": 1,\n\t"post-affiliated": 4550,\n\t"caption": [\n\t    [\n\t\t[\n\t\t    "This is also the first caption!"\n\t\t]\n\t    ]\n\t],\n\t"name": "screenshot:first-test"\n    },\n    "contents": [\n\t{\n\t    "$$data_type": "org-node",\n\t    "type": "link",\n\t    "ref": "org851c986",\n\t    "properties": {\n\t\t"type": "file",\n\t\t"path": "./0004_first-test.png",\n\t\t"format": "bracket",\n\t\t"raw-link": "./0004_first-test.png",\n\t\t"application": null,\n\t\t"search-option": null,\n\t\t"post-blank": 0,\n\t\t"is-internal": false,\n\t\t"target-ref": null,\n\t\t"is-inline-image": true\n\t    },\n\t    "contents": []\n\t},\n\t"\\n"\n    ]\n}\n',"post-blank":1,"post-affiliated":45739},contents:[]},{$$data_type:"org-node",type:"paragraph",ref:"orgd1e17c7",properties:{"post-blank":0,"post-affiliated":46455},contents:["We very much need to redefine a paragraph so we can see that caption. I gave it\na name as well. Ignore that for now.\n"]}]}]},{$$data_type:"org-node",type:"headline",ref:"orgab1efc2",drawer:{},properties:{"tags-all":[],"raw-value":"~OrgNodeParagraph~","pre-blank":1,level:4,priority:null,tags:[],"todo-keyword":null,"todo-type":null,"post-blank":1,"footnote-section-p":!1,archivedp:!1,commentedp:!1,"post-affiliated":46573,title:[{$$data_type:"org-node",type:"code",ref:"orgc826650",properties:{value:"OrgNodeParagraph","post-blank":0},contents:[]}]},contents:[{$$data_type:"org-node",type:"section",ref:"orgb4b1d9c",properties:{"post-blank":1,"post-affiliated":46598},contents:[{$$data_type:"org-node",type:"paragraph",ref:"org785087b",properties:{"post-blank":1,"post-affiliated":46598},contents:["We already have ",{$$data_type:"org-node",type:"code",ref:"orge8d008b",properties:{value:"parameterize","post-blank":1},contents:[]},"working, so the idea is to make an\n",{$$data_type:"org-node",type:"code",ref:"org80e7dd8",properties:{value:"OrgNodeParagraph","post-blank":1},contents:[]},"that dynamically binds the ",{$$data_type:"org-node",type:"code",ref:"orgbad0df6",properties:{value:"properties:","post-blank":1},contents:[]},"of the paragraph.\n"]},{$$data_type:"org-node",type:"src-block",ref:"org51f92a3",properties:{language:"scheme",switches:null,parameters:null,"number-lines":null,"preserve-indent":!1,"retain-labels":!0,"use-labels":!0,"label-fmt":null,value:'(def current-org-paragraph-properties (##make-parameter #f))\n(def OrgNodeParagraph\n  (lambda (r _)\n    (r (js#jso\n\tprops: #( "node" "components")\n\tmethods: (js#jso\n\t\t  $around: (js#function (next)\n\t\t\t     (parameterize ((current-org-paragraph-properties\n\t\t\t\t\t     (js#ref js#this node: properties:)))\n\t\t\t       (next))))\n\trender: (js#function\n\t\t (h)\n\t\t (def node (js#ref js#this node:))\n\t\t (def comps (js#ref js#this components:))\n\t\t #;(js#console.log\n\t\t      "p" (js#ref js#this $children:) (js#ref js#this node: type:) js#this)\n\t       ; (js#console.error 925265296 js#this (current-org-paragraph-properties))\n\t\t (render-org-node h node comps "p"))))))\n',"post-blank":0,"post-affiliated":46743},contents:[]}]}]},{$$data_type:"org-node",type:"headline",ref:"org172ca9c",drawer:{},properties:{"tags-all":[],"raw-value":"So we can ~<figcaption>~ or not","pre-blank":1,level:4,priority:null,tags:[],"todo-keyword":null,"todo-type":null,"post-blank":1,"footnote-section-p":!1,archivedp:!1,commentedp:!1,"post-affiliated":47428,title:["So we can ",{$$data_type:"org-node",type:"code",ref:"orgda89b90",properties:{value:"<figcaption>","post-blank":1},contents:[]},"or not"]},contents:[{$$data_type:"org-node",type:"section",ref:"org9952e48",properties:{"post-blank":1,"post-affiliated":47466},contents:[{$$data_type:"org-node",type:"paragraph",ref:"orgddb6a97",properties:{"post-blank":1,"post-affiliated":47466},contents:["A certain webpage",{$$data_type:"org-node",type:"footnote-reference",ref:"org3817fe8",properties:{label:"mfc",type:"standard","post-blank":1},contents:[]},"gives us what we need.\n"]},{$$data_type:"org-node",type:"src-block",ref:"orgdbfa950",properties:{language:"html",switches:null,parameters:null,"number-lines":null,"preserve-indent":!1,"retain-labels":!0,"use-labels":!0,"label-fmt":null,value:'<figure>\n    <img src="/media/cc0-images/elephant-660-480.jpg"\n\t alt="Elephant at sunset">\n    <figcaption>An elephant at sunset</figcaption>\n</figure>\n',"post-blank":1,"post-affiliated":47516},contents:[]},{$$data_type:"org-node",type:"src-block",ref:"org72cc94f",properties:{language:"scheme",switches:null,parameters:null,"number-lines":null,"preserve-indent":!1,"retain-labels":!0,"use-labels":!0,"label-fmt":null,value:'(def (org-node-link-inline-image? node)\n  (js#ref node properties: is-inline-image:))\n\n(def OrgNodeLinkInlineImage\n  {\n   functional: #t\n   render: (lambda (h c)\n\t     (def node (js#ref c props: node:))\n\t     (def path (js#ref node properties: path:))\n\t     (def caption (let ((o (current-org-paragraph-properties)))\n\t\t\t    (and o (let ((c (js#ref o caption:)))\n\t\t\t\t     (and (not (js#undefined? c)) c)))))\n\t     (def src (org-hack-img-path path))\n\n\t     ;;; (js#console.log 8765 src (string-length "asd") (if caption caption) (current-org-paragraph-properties))\n\t     (h "figure" (vector (h "img" { attrs: { src: src alt: caption } })\n\t\t\t\t (if caption (h "figcaption" caption) ""))))\n\n  })\n',"post-blank":0,"post-affiliated":47696},contents:[]}]}]},{$$data_type:"org-node",type:"headline",ref:"orgd8635c3",drawer:{},properties:{"tags-all":[],"raw-value":"Add it to ChooseLink","pre-blank":0,level:4,priority:null,tags:[],"todo-keyword":null,"todo-type":null,"post-blank":0,"footnote-section-p":!1,archivedp:!1,commentedp:!1,"post-affiliated":48417,title:["Add it to ChooseLink"]},contents:[{$$data_type:"org-node",type:"section",ref:"orgeb7cec0",properties:{"post-blank":1,"post-affiliated":48443},contents:[{$$data_type:"org-node",type:"src-block",ref:"org1381078",properties:{language:"scheme",switches:null,parameters:null,"number-lines":null,"preserve-indent":!1,"retain-labels":!0,"use-labels":!0,"label-fmt":null,value:'(def OrgNodeChooseLink\n     { functional: #t\n  ;     props: #("node")\n       render:\n       (js#function (h c)\n\t(def node (js#ref c props: node:))\n\t(def type (org-node-link-type node))\n\t;;  (js#console.log 10007666 (current-org-paragraph-properties))\n\t(h\n\t (cond ((equal? type "https") OrgNodeLinkHttps)\n\t       ((org-node-link-inline-image? node) OrgNodeLinkInlineImage)\n\t       (else (OrgNodeLinkUnknown)))\n\t (js#ref c data:)\n\t (js#ref c children:)))\n       })\n(def OrgNodeLink OrgNodeChooseLink)\n',"post-blank":0,"post-affiliated":48443},contents:[]}]}]}]},{$$data_type:"org-node",type:"headline",ref:"org1341001",drawer:{},properties:{"tags-all":[],"raw-value":"~OrgNodeLinkCustomId~","pre-blank":2,level:3,priority:null,tags:[],"todo-keyword":null,"todo-type":null,"post-blank":0,"footnote-section-p":!1,archivedp:!1,commentedp:!1,"post-affiliated":48972,title:[{$$data_type:"org-node",type:"code",ref:"org0f4d67a",properties:{value:"OrgNodeLinkCustomId","post-blank":0},contents:[]}]},contents:[{$$data_type:"org-node",type:"section",ref:"orgb14dd6c",properties:{"post-blank":1,"post-affiliated":49e3},contents:[{$$data_type:"org-node",type:"paragraph",ref:"org52f16f5",properties:{"post-blank":0,"post-affiliated":49e3},contents:["First, this is an internal link to a headline's ",{$$data_type:"org-node",type:"code",ref:"org9c3ab5d",properties:{value:"CUSTOM_ID","post-blank":1},contents:[]},"parameter. We need\nto redo that.\n"]}]},{$$data_type:"org-node",type:"headline",ref:"org52d28f9",drawer:{},properties:{"tags-all":[],"raw-value":"~OrgNodeHeadlineTitle~ again","pre-blank":1,level:4,priority:null,tags:[],"todo-keyword":null,"todo-type":null,"post-blank":1,"footnote-section-p":!1,archivedp:!1,commentedp:!1,"post-affiliated":49094,title:[{$$data_type:"org-node",type:"code",ref:"org2a66f5d",properties:{value:"OrgNodeHeadlineTitle","post-blank":1},contents:[]},"again"]},contents:[{$$data_type:"org-node",type:"section",ref:"org6af905c",properties:{"post-blank":1,"post-affiliated":49129},contents:[{$$data_type:"org-node",type:"paragraph",ref:"org2ac1a19",properties:{"post-blank":1,"post-affiliated":49129},contents:["Here's the relevant JSON. In the drawer there's a ",{$$data_type:"org-node",type:"code",ref:"orgbb6087b",properties:{value:"CUSTOM_ID:","post-blank":0},contents:[]},". Othwerwise, use\nthe ",{$$data_type:"org-node",type:"code",ref:"orgb0a8bec",properties:{value:"ref:","post-blank":0},contents:[]},".\n"]},{$$data_type:"org-node",type:"src-block",ref:"orga86f3c7",properties:{language:"json",switches:null,parameters:null,"number-lines":null,"preserve-indent":!1,"retain-labels":!0,"use-labels":!0,"label-fmt":null,value:'{\n    "$$data_type": "org-node",\n    "type": "headline",\n    "ref": "orgcde64e5",\n    "drawer": {\n\t"CUSTOM_ID": "OrgNodeTest"\n    },\n    "properties": {\n\t"tags-all": [],\n\t"raw-value": "~OrgNodeTest~? Nested, functional, here we go.",\n\t"pre-blank": 0,\n\t"level": 1,\n\t"priority": null,\n\t"tags": [],\n\t"todo-keyword": null,\n\t"todo-type": null,\n\t"post-blank": 1,\n\t"footnote-section-p": false,\n\t"archivedp": false,\n\t"commentedp": false,\n\t"post-affiliated": 2891,\n\t"title": [\n\t    {\n\t\t"$$data_type": "org-node",\n\t\t"type": "code",\n\t\t"ref": "org5a651d5",\n\t\t"properties": {\n\t\t    "value": "OrgNodeTest",\n\t\t    "post-blank": 0\n\t\t},\n\t\t"contents": []\n\t    },\n\t    "? Nested, functional, here we go."\n\t]\n    },\n    "contents": [ ... ]\n}\n\n',"post-blank":2,"post-affiliated":49222},contents:[]},{$$data_type:"org-node",type:"src-block",ref:"org7cf7ca9",properties:{language:"scheme",switches:null,parameters:null,"number-lines":null,"preserve-indent":!1,"retain-labels":!0,"use-labels":!0,"label-fmt":null,value:'(def (org-headline-id node)\n  (def cid? (js#ref node drawer: CUSTOM_ID:))\n  (if (not (js#undefined? cid?)) cid? (js#ref node ref:)))\n\n(def OrgNodeHeadlineTitle\n  (js#jso functional: #t\n\t  render: (lambda (h c)\n\t\t    (def level (js#ref c props: node: properties: level:))\n\t\t    (def no-id (let ((nid (js#ref c props: noID:)))\n\t\t\t\t (if (js#undefined? nid) #f nid)))\n\t\t    (def sz (+ 0.75 (/ 2 level)))\n\t\t    (def size (##string-append (##number->string sz) "em"))\n\t\t    (def height (##string-append (##number->string (/ sz 2)) "em"))\n\t\t    (def hid (org-headline-id (js#ref c props: node:)))\n\t\t    (def style (let ((s (js#ref c props: style:)))\n\t\t\t\t (if (js#undefined? s)\n\t\t\t\t   (js#jso\n\t\t\t\t    display: "block"\n\t\t\t\t    font-size: size\n\t\t\t\t    font-weight: "bold"\n\t\t\t\t    line-height: height\n\t\t\t\t    padding: 0\n\t\t\t\t    margin: 0\n\t\t\t\t    margin-top: "0.75em"\n\t\t\t\t    margin-bottom: "0.5em")\n\t\t\t\t   s)))\n\t\t    ;;(js#console.error 43221 no-id (js#ref c props:))\n\t\t    (h (##string-append "h" (##number->string level))\n\t\t       { style: style }\n\t\t       (vector-append\n\t\t\t(if no-id #()\n\t\t\t    (vector (h "div" { style: {\n\t\t\t\t\t\t   position: "absolute"\n\t\t\t\t\t\t   margin: "-4.15em"\n\t\t\t\t\t\t   }\n\t\t\t\t\t   attrs: { id: hid }\n\n\t\t\t\t\t   }\n\t\t\t\t   "")))\n\t\t\t(renderOrgNodeChildren\n\t\t\t h c (js#ref c props: node: properties: title:)))))))\n(def OrgNodeHeadline\n  (js#jso functional: #t\n\t  render: (lambda (h c)\n\t\t    (def node (js#ref c props: node:))\n\t\t    (def children (js#ref c children:))\n\t\t    (def props (js#ref node properties:))\n\t\t    (def comps (js#ref props components:))\n\t\t    (def data (js#jso props: (js#jso node: node components: comps)))\n\t\t   ; (js#console.log children)\n\t\t    (h "div" data\n\t\t       (##vector-append\n\t\t\t(vector (h (find-org-node-component node key: \'headlineTitle comps)\n\t\t\t\t   data))\n\t\t\tchildren)\n\t\t    ))))\n',"post-blank":0,"post-affiliated":49974},contents:[]}]}]},{$$data_type:"org-node",type:"headline",ref:"orgace7ced",drawer:{},properties:{"tags-all":[],"raw-value":"Now the Node","pre-blank":0,level:4,priority:null,tags:[],"todo-keyword":null,"todo-type":null,"post-blank":2,"footnote-section-p":!1,archivedp:!1,commentedp:!1,"post-affiliated":51823,title:["Now the Node"]},contents:[{$$data_type:"org-node",type:"section",ref:"org0a1d976",properties:{"post-blank":2,"post-affiliated":51841},contents:[{$$data_type:"org-node",type:"paragraph",ref:"org6530696",properties:{"post-blank":1,"post-affiliated":51841},contents:["Almost a direct c/p of the HTTPS link.\n"]},{$$data_type:"org-node",type:"src-block",ref:"org9f4390e",properties:{language:"scheme",switches:null,parameters:null,"number-lines":null,"preserve-indent":!1,"retain-labels":!0,"use-labels":!0,"label-fmt":null,value:'(def OrgNodeLinkCustomId\n  { functional: #t\n    render: (lambda (h c)\n\t      (def node (js#ref c props: node:))\n\t      (def path (js#ref node properties: raw-link:))\n\t      (def children (let ((cs (js#ref c children:)))\n\t\t\t      (if (> (vector-length cs) 0) cs\n\t\t\t\t  (vector (js#ref node properties: raw-link:)))))\n\t\t  (h "a" { attrs: { href: path } } children))\n\n  })\n',"post-blank":0,"post-affiliated":51881},contents:[]}]}]},{$$data_type:"org-node",type:"headline",ref:"org2d3b35c",drawer:{},properties:{"tags-all":[],"raw-value":"Add it to ChooseLink","pre-blank":0,level:4,priority:null,tags:[],"todo-keyword":null,"todo-type":null,"post-blank":0,"footnote-section-p":!1,archivedp:!1,commentedp:!1,"post-affiliated":52281,title:["Add it to ChooseLink"]},contents:[{$$data_type:"org-node",type:"section",ref:"orgbb21e53",properties:{"post-blank":1,"post-affiliated":52307},contents:[{$$data_type:"org-node",type:"src-block",ref:"orgc1b17ab",properties:{language:"scheme",switches:null,parameters:null,"number-lines":null,"preserve-indent":!1,"retain-labels":!0,"use-labels":!0,"label-fmt":null,value:'(def OrgNodeChooseLink\n     { functional: #t\n  ;     props: #("node")\n       render:\n       (js#function (h c)\n\t(def node (js#ref c props: node:))\n\t(def type (org-node-link-type node))\n\t;;  (js#console.log 10007666 (current-org-paragraph-properties))\n\t(h\n\t (cond ((equal? type "https") OrgNodeLinkHttps)\n\t       ((equal? type "custom-id") OrgNodeLinkCustomId)\n\t       ((org-node-link-inline-image? node) OrgNodeLinkInlineImage)\n\t       (else (OrgNodeLinkUnknown)))\n\t (js#ref c data:)\n\t (js#ref c children:)))\n       })\n(def OrgNodeLink OrgNodeChooseLink)\n',"post-blank":0,"post-affiliated":52307},contents:[]}]}]}]}]},{$$data_type:"org-node",type:"headline",ref:"orge7f4cd4",drawer:{},properties:{"tags-all":[],"raw-value":"~OrgNodeQuoteBlock~","pre-blank":1,level:2,priority:null,tags:[],"todo-keyword":null,"todo-type":null,"post-blank":1,"footnote-section-p":!1,archivedp:!1,commentedp:!1,"post-affiliated":52892,title:[{$$data_type:"org-node",type:"code",ref:"org2baa7a7",properties:{value:"OrgNodeQuoteBlock","post-blank":0},contents:[]}]},contents:[{$$data_type:"org-node",type:"section",ref:"org6f1ed1f",properties:{"post-blank":1,"post-affiliated":52916},contents:[{$$data_type:"org-node",type:"paragraph",ref:"orgf4576e8",properties:{"post-blank":1,"post-affiliated":52916},contents:["We use quote blocks. While ",{$$data_type:"org-node",type:"code",ref:"orgff1efac",properties:{value:"#+CAPTION:","post-blank":1},contents:[]},"works for links to images, and for\nsource blocks apparently(!!), it does not work for quote blocks.\n"]},{$$data_type:"org-node",type:"paragraph",ref:"orgc0ff021",properties:{"post-blank":1,"post-affiliated":53057},contents:["So I've decided to make one.\n"]},{$$data_type:"org-node",type:"paragraph",ref:"org9110581",properties:{"post-blank":1,"post-affiliated":53087},contents:["Here is the quote.\n"]},{$$data_type:"org-node",type:"quote-block",ref:"org13112e2",properties:{"post-blank":1,"post-affiliated":53107},contents:[{$$data_type:"org-node",type:"paragraph",ref:"org388b9c6",properties:{"post-blank":1,"post-affiliated":53121},contents:["This is a quote\n"]},{$$data_type:"org-node",type:"paragraph",ref:"org79d8c72",properties:{"post-blank":0,"post-affiliated":53138},contents:["— This is a caption or attribution\n"]}]},{$$data_type:"org-node",type:"paragraph",ref:"orgaa7a5b5",properties:{"post-blank":0,"post-affiliated":53187},contents:["Here is the source of that quote.\n"]},{$$data_type:"org-node",type:"src-block",ref:"org6fa8940",properties:{language:"org",switches:null,parameters:null,"number-lines":null,"preserve-indent":!1,"retain-labels":!0,"use-labels":!0,"label-fmt":null,value:"#+begin_quote\nThis is a quote\n\n — This is a caption or attribution\n#+end_quote\n","post-blank":1,"post-affiliated":53221},contents:[]},{$$data_type:"org-node",type:"paragraph",ref:"orgf2c5d6f",properties:{"post-blank":1,"post-affiliated":53329},contents:["At the very end, to mark the caption, we use the the ",{$$data_type:"org-node",type:"bold",ref:"org42bb12e",properties:{"post-blank":0},contents:["Em Dash"]},{$$data_type:"org-node",type:"footnote-reference",ref:"org29ccc16",properties:{label:"emd",type:"standard","post-blank":0},contents:[]},". That character, ",{$$data_type:"org-node",type:"code",ref:"orgb7ec313",properties:{value:"—","post-blank":0},contents:[]},", is like a slightly longer hyphen. But it is not a hypen, it's a dash.\n"]},{$$data_type:"org-node",type:"paragraph",ref:"orgd04278f",properties:{"post-blank":1,"post-affiliated":53493},contents:["I get it by holding ",{$$data_type:"org-node",type:"bold",ref:"orge433197",properties:{"post-blank":1},contents:["Compose"]},'while hitting the hypen 3 times: "[Compose]---".\nDifferent approaches for different OS\'s',{$$data_type:"org-node",type:"footnote-reference",ref:"orgdbaa93c",properties:{label:"wd",type:"standard","post-blank":0},contents:[]},".\n"]},{$$data_type:"org-node",type:"paragraph",ref:"org923b4b1",properties:{"post-blank":1,"post-affiliated":53621},contents:["So if the last line starts with an ",{$$data_type:"org-node",type:"bold",ref:"orgb59ffd4",properties:{"post-blank":1},contents:["em dash"]},"then it becomes a caption.\n",{$$data_type:"org-node",type:"code",ref:"org7969e71",properties:{value:"<figcaption>","post-blank":0},contents:[]},".\n"]},{$$data_type:"org-node",type:"paragraph",ref:"org60b06b2",properties:{"post-blank":1,"post-affiliated":53710},contents:["Here's the json. This should be a caption! TODO: <--- What I just said.\n"]},{$$data_type:"org-node",type:"src-block",ref:"org16baf23",properties:{language:"json",switches:null,parameters:null,"number-lines":null,"preserve-indent":!1,"retain-labels":!0,"use-labels":!0,"label-fmt":null,value:'{\n    "$$data_type": "org-node",\n    "type": "quote-block",\n    "ref": "orgfb27171",\n    "properties": {\n\t"post-blank": 1,\n\t"post-affiliated": 51926\n    },\n    "contents": [\n\t{\n\t    "$$data_type": "org-node",\n\t    "type": "paragraph",\n\t    "ref": "org13f429e",\n\t    "properties": {\n\t\t"post-blank": 1,\n\t\t"post-affiliated": 51940\n\t    },\n\t    "contents": [\n\t\t"This is a quote\\n"\n\t    ]\n\t},\n\t{\n\t    "$$data_type": "org-node",\n\t    "type": "paragraph",\n\t    "ref": "org03d0a5e",\n\t    "properties": {\n\t\t"post-blank": 0,\n\t\t"post-affiliated": 51957\n\t    },\n\t    "contents": [\n\t\t"— This is a caption or attribution\\n"\n\t    ]\n\t}\n    ]\n}\n',"post-blank":1,"post-affiliated":53783},contents:[]},{$$data_type:"org-node",type:"paragraph",ref:"org3ec126e",properties:{"post-blank":1,"post-affiliated":54439},contents:["We get very lucky in how the tokens are parsed as the space before, which I used because I find it readable, is not in that paragraph at all. That rules!\n"]},{$$data_type:"org-node",type:"src-block",ref:"orgcbe79ae",properties:{language:"scheme",switches:null,parameters:null,"number-lines":null,"preserve-indent":!1,"retain-labels":!0,"use-labels":!0,"label-fmt":null,value:'(def (org-node-quote-block-has-caption? node)\n  (def contents (js#ref node contents:))\n  (def last-node (vector-ref contents (- (vector-length contents) 1)))\n  (def last-node-contents (and (org#org-node? last-node)\n\t\t\t       (js#ref last-node contents:)))\n  (def last-of-last (if last-node-contents\n\t\t      (vector-ref last-node-contents\n\t\t\t\t  (- (vector-length last-node-contents) 1))\n\t\t      last-node))\n  (and (string? last-of-last)\n       (equal? (string-ref last-of-last 0)\n\t       #\\—)))\n\n\n(def OrgNodeQuoteBlock\n  {\n   functional: #t\n   render:\n   (lambda (h c)\n     (def node (js#ref c props: node:))\n     (def post-blank (js#ref node properties: post-blank:))\n     (def children (js#ref c children:))\n     (def caption (let ((c? (org-node-quote-block-has-caption? node)))\n\t\t    (and c?\n\t\t\t (let* ((num (if (equal? 0 post-blank) 1 2))\n\t\t\t\t(c (vector-ref\n\t\t\t\t    children (- (vector-length children) num))))\n\t\t\t   (vector-set! children num "")\n\t\t\t   c))))\n    ;; (js#console.log 911 node c caption post-blank)\n     (h "figure"\n\t(vector (h "blockquote" children)\n\t\t(if caption (h "figcaption" (vector caption)) ""))))\n\n })\n',"post-blank":0,"post-affiliated":54594},contents:[]}]}]},{$$data_type:"org-node",type:"headline",ref:"orga86d0b9",drawer:{},properties:{"tags-all":[],"raw-value":'A ~meta:~ ~data:~ "global"',"pre-blank":1,level:2,priority:null,tags:[],"todo-keyword":null,"todo-type":null,"post-blank":1,"footnote-section-p":!1,archivedp:!1,commentedp:!1,"post-affiliated":55753,title:["A ",{$$data_type:"org-node",type:"code",ref:"org336c0b1",properties:{value:"meta:","post-blank":1},contents:[]},{$$data_type:"org-node",type:"code",ref:"org22dd3bd",properties:{value:"data:","post-blank":1},contents:[]},'"global"']},contents:[{$$data_type:"org-node",type:"section",ref:"orgab0999d",properties:{"post-blank":1,"post-affiliated":55784},contents:[{$$data_type:"org-node",type:"paragraph",ref:"org1f064b7",properties:{"post-blank":1,"post-affiliated":55784},contents:["While going through the now dynamic document parameter and looking for it on\neach reference is actually quite easy and more than possible I can actually\nstore ",{$$data_type:"org-node",type:"code",ref:"org175c262",properties:{value:"meta:","post-blank":1},contents:[]},"information within the ",{$$data_type:"org-node",type:"code",ref:"org6fe5119",properties:{value:"OrgDoc","post-blank":1},contents:[]},"inside ",{$$data_type:"org-node",type:"code",ref:"org7356b57",properties:{value:"data:","post-blank":0},contents:[]},", which is not an\nandroid.\n"]},{$$data_type:"org-node",type:"src-block",ref:"org0559b05",properties:{language:"scheme",switches:null,parameters:null,"number-lines":null,"preserve-indent":!1,"retain-labels":!0,"use-labels":!0,"label-fmt":null,value:'(def current-OrgDoc (##make-parameter #f))\n(def OrgDoc\n  (js#jso\n   props: #( "document" "components")\n   created: (js#function () (set! (js#ref js#this meta:) (js#jso)))\n  ; data: (js#function () (js#jso meta: (js#jso)))\n   methods: (js#jso\n\t     $around: (js#function (next)\n\t\t\t(parameterize ((current-OrgDoc js#this)) (next))))\n   render: (js#function (h)\n\t     ;; (js#console.error js#this)\n\t     (renderOrgDoc js#this h))))\n',"post-blank":0,"post-affiliated":56025},contents:[]}]}]},{$$data_type:"org-node",type:"headline",ref:"org9671348",drawer:{},properties:{"tags-all":[],"raw-value":"The final default components","pre-blank":0,level:2,priority:null,tags:[],"todo-keyword":null,"todo-type":null,"post-blank":0,"footnote-section-p":!1,archivedp:!1,commentedp:!1,"post-affiliated":56484,title:["The final default components"]},contents:[{$$data_type:"org-node",type:"section",ref:"orgbb9c7c6",properties:{"post-blank":0,"post-affiliated":56516},contents:[{$$data_type:"org-node",type:"src-block",ref:"org39442da",properties:{language:"scheme",switches:null,parameters:null,"number-lines":null,"preserve-indent":!1,"retain-labels":!0,"use-labels":!0,"label-fmt":null,value:'(def org-node-default-components\n  (js#jso\n   section: "div" bold: "strong" italic: "em" plain-list: "ul" item: "li"\n   paragraph: OrgNodeParagraph\n   quote-block: OrgNodeQuoteBlock\n   underline: "u"\n   code: OrgNodeCode\n   src-block: OrgNodeSrcBlock\n\n   headline: OrgNodeHeadline\n   headlineTitle: OrgNodeHeadlineTitle\n\n   footnote-reference: (lambda (resolve reject) (resolve (OrgNodeFootnoteReferenceStandard)))\n   footnote-definition: OrgNodeFootnoteDefinition\n\n   link: OrgNodeLink\n\n   keyword: OrgNodeNull\n   timestamp: org#OrgNodeTimestamp\n   unknown: org#OrgNodeUnknown\n\n   documentProperties: org#OrgDocPropTest))\n',"post-blank":0,"post-affiliated":56516},contents:[]}]}]},{$$data_type:"org-node",type:"headline",ref:"org2bfb0c8",drawer:{},properties:{"tags-all":[],"raw-value":"Conclusion","pre-blank":1,level:2,priority:null,tags:[],"todo-keyword":null,"todo-type":null,"post-blank":0,"footnote-section-p":!1,archivedp:!1,commentedp:!1,"post-affiliated":57168,title:["Conclusion"]},contents:[{$$data_type:"org-node",type:"section",ref:"orgcb20c46",properties:{"post-blank":2,"post-affiliated":57183},contents:[{$$data_type:"org-node",type:"paragraph",ref:"orge59004f",properties:{"post-blank":1,"post-affiliated":57183},contents:["As of this moment, in this document, there are no unknown nodes.\n"]},{$$data_type:"org-node",type:"paragraph",ref:"orge76c8be",properties:{"post-blank":3,"post-affiliated":57249},contents:["It's been a long time, so far ",{$$data_type:"org-node",type:"timestamp",ref:"orgb325a56",properties:{type:"active-range","raw-value":"<2020-12-05 Sat>--<2020-12-16 Wed>","post-blank":0,start:"2020-12-05",end:"2020-12-16"},contents:[]},", but this\ndocument is almost meta-complete.\n"]},{$$data_type:"org-node",type:"src-block",ref:"org14a8105",properties:{language:"shell",switches:null,parameters:null,"number-lines":null,"preserve-indent":!1,"retain-labels":!0,"use-labels":!0,"label-fmt":null,value:'_gxc () {\n    _givr="gxc -d . -S -static $1"\n echo "--- Compiling $_givr"; $_givr || exit 1 ;\n}\n_statics=""\n\n_gsc () {\n _js=$(basename $1 .scm).js\n _js=`echo $_js | sed \'s/js.*_\\(.*\\)/\\1/\'`\n _statics="$_statics $1"\n\n  echo "--- compiling $1 to $_js"\n  gsc -target js -prelude \'(include "~~lib/_gambit#.scm")\' -o  $_js $1 || exit 2; echo;\n}\n\n_comp () {\n _fn=$(basename $1 .ss)\n _st=static/js__${2}$_fn.scm\n\n _gxc $1;\n _gsc $_st;\n }\n# _comp Org.gx.ss && mv Org.gx.js ../src/assets/\n# _comp components/ButtonCounter.gx.ss components__ && mv ButtonCounter.gx.js ../src/components/\n# _comp components/org/OrgNode.gx.ss components__org__ && mv OrgNode.gx.js ../src/components/org/\n# _comp components/org/OrgDocFirstTest.gx.ss components__org__ && mv OrgDocFirstTest.gx.js ../src/components/org/\n# _comp components/org/OrgDocPropTest.gx.ss components__org__ && mv OrgDocPropTest.gx.js ../src/components/org/\n# _comp components/org/OrgDocTest.gx.ss components__org__ && mv OrgDocTest.gx.js ../src/components/org/\n_comp components/org/OrgDoc.gx.ss components__org__ && mv OrgDoc.gx.js ../src/components/org/\n# _comp components/org/OrgNodeFirstTest.gx.ss components__org__ && \\\n#    mv OrgNodeFirstTest.gx.js ../src/components/org/\n# _comp components/org/OrgNodeSecondTest.gx.ss components__org__ && \\\n#    mv OrgNodeSecondTest.gx.js ../src/components/org/\n _comp components/org/OrgNodeThirdTest.gx.ss components__org__ && \\\n    mv OrgNodeThirdTest.gx.js ../src/components/org/\n_comp components/org/OrgNodeFourthTest.gx.ss components__org__ && \\\n   mv OrgNodeFourthTest.gx.js ../src/components/org/\n',"post-blank":0,"post-affiliated":57361},contents:[]}]}]}]},{$$data_type:"org-node",type:"headline",ref:"orge47f6e7",drawer:{},properties:{"tags-all":[],"raw-value":"Table of Contents","pre-blank":1,level:1,priority:null,tags:[],"todo-keyword":null,"todo-type":null,"post-blank":2,"footnote-section-p":!1,archivedp:!1,commentedp:!1,"post-affiliated":58980,title:["Table of Contents"]},contents:[{$$data_type:"org-node",type:"section",ref:"org8e02982",properties:{"post-blank":0,"post-affiliated":59001},contents:[{$$data_type:"org-node",type:"paragraph",ref:"org2589b00",properties:{"post-blank":1,"post-affiliated":59001},contents:["We are using ",{$$data_type:"org-node",type:"bold",ref:"org8a5eebe",properties:{"post-blank":0},contents:["Quasar"]},{$$data_type:"org-node",type:"footnote-reference",ref:"org0de49ef",properties:{label:"q",type:"standard","post-blank":1},contents:[]},"and ",{$$data_type:"org-node",type:"bold",ref:"org6c87855",properties:{"post-blank":0},contents:["Vue.js"]},", which has some nice ways to lay things\nout. I should have started with this (he says, now that it seems easy) as I am\nsick of scrolling and this is, at this moment, a 4894 line document.\n"]},{$$data_type:"org-node",type:"paragraph",ref:"orgebac7bf",properties:{"post-blank":1,"post-affiliated":59231},contents:["So a TOC is in order. Here's what we know.\n"]},{$$data_type:"org-node",type:"plain-list",ref:"orgb730b50",properties:{type:"ordered",structure:[[59275,2,"1) ",null,null,null,59363]],"post-blank":1,"post-affiliated":59275},contents:[{$$data_type:"org-node",type:"item",ref:"org75ab37b",properties:{bullet:"1) ",checkbox:null,counter:null,"pre-blank":0,"post-blank":0,"post-affiliated":59275,tag:[]},contents:[{$$data_type:"org-node",type:"paragraph",ref:"org1e8511f",properties:{"post-blank":0,"post-affiliated":59280},contents:["A headline will always be toplevel in a document or a headline's\n",{$$data_type:"org-node",type:"code",ref:"orgc07bbdc",properties:{value:"contents:","post-blank":0},contents:[]},".\n"]}]}]},{$$data_type:"org-node",type:"paragraph",ref:"org6e91f54",properties:{"post-blank":1,"post-affiliated":59364},contents:["Should be pretty easy.\n"]},{$$data_type:"org-node",type:"src-block",ref:"orgfd4421d",properties:{language:"scheme",switches:null,parameters:null,"number-lines":null,"preserve-indent":!1,"retain-labels":!0,"use-labels":!0,"label-fmt":null,value:'(def (org-contents-headlines contents)\n  (def (ohc)\n    (def headlines [])\n\n    (def (copy-headline hl)\n      (let ((new (js#jso)))\n\t(js#map-object (lambda (k v) (if (not (equal? k "contents"))\n\t\t\t\t  (set! (js#ref new k) (js#scm->js v))))\n\t\t       hl)\n\t(set! (js#ref new contents:) (vector-map js#scm->js (org-contents-headlines (js#ref hl contents:))))\n\tnew))\n\n    (vector-for-each (lambda (node)\n\t\t       (when (and (org#org-node? node)\n\t\t\t\t(equal? (js#ref node type:) "headline"))\n\n\t\t\t  ;; (js#console.log 5123 node)\n\t\t\t (set! headlines (cons (copy-headline node) headlines))))\n\t\t     contents)\n    (list->vector (reverse headlines)))\n\n  (if (vector? contents) (ohc) #()))\n',"post-blank":1,"post-affiliated":59388},contents:[]},{$$data_type:"org-node",type:"src-block",ref:"orgd9e5e42",properties:{language:"scheme",switches:null,parameters:null,"number-lines":null,"preserve-indent":!1,"retain-labels":!0,"use-labels":!0,"label-fmt":null,value:'\n(def (render-OrgTOCHeadlines h contents)\n  (h "ol" (vector-map (lambda (hl)\n\t\t\t(h "li" { style: { list-style-type: "none" } } (vector (h OrgDocTOCHeadline { props: { headline: hl } }))))\n\t\t      contents)))\n\n(def OrgDocTOCHeadline\n  (lambda (go _)\n    (go {\n\t props: #( "headline" )\n\t data: (lambda _ { expand?: #f })\n\t render: (js#function (h)\n\t\t  (def headline (js#ref js#this headline:))\n\t\t  (def expand? (js#ref js#this expand?:))\n\t\t  (def arrow (if expand?  "⯅" "⯆"))\n\t\t  (def child-size (vector-length (js#ref headline contents:)))\n\t\t  (h "div" { style: { display: "inline-block" } }\n\t\t     (vector\n\t\t      (if (zero? child-size) ""\n\t\t\t  (h "big" { style: { float: "right" margin-top: "0.25em" margin-left: "2em" opacity: "0.5" cursor: "pointer" }\n\t\t\t\t     on: { click: (lambda _ (set! (js#ref js#this expand?:) (not expand?))) }\n\t\t\t\t   }\n\t\t\t     arrow))\n\t\t      (h "div" { style: { position: "absolute"\n\t\t\t\t\t  margin: "-12.15em"\n\t\t\t\t\t}\n\t\t\t\t attrs: { id: (string-append "TOC" (org-headline-id headline)) }\n\n\t\t\t\t }\n\t\t\t "")\n\t\t      (h "a" { attrs: { href: (string-append "#" (org-headline-id headline)) } }\n\t\t\t (vector (h OrgNodeHeadlineTitle\n\t\t\t\t    { props: { node: headline\n\t\t\t\t\t       noID: #t\n\t\t\t\t\t       style: { font-size: "2em" line-height: "0.25rem" display: "inline-block" }\n\t\t\t\t\t     }\n\t\t\t\t      })))\n\t\t      (if (or (not expand?) (zero? child-size)) "" (render-OrgTOCHeadlines h (js#ref headline contents:))\n\t\t\t  #;(h "div" (js#JSON.stringify (vector-ref (js#ref headline contents:) 0)))\n\t\t\t  #;(h OrgDocTOCHeadline { props: { headline: (vector-ref (js#ref headline contents:) 0) } })))))\n\t })))\n\n(def OrgDocTOC\n  {\n   functional: #t\n   render: (lambda (h c)\n\t     (def doc (js#ref c props: document:))\n\t     (def lines (org-contents-headlines (js#ref doc contents:)))\n\t     (js#console.log lines)\n\t     (h "div"\n\t       (vector (render-OrgTOCHeadlines h lines))))\n\n  })\n',"post-blank":1,"post-affiliated":60094},contents:[]},{$$data_type:"org-node",type:"paragraph",ref:"org1af9882",properties:{"post-blank":0,"post-affiliated":62012},contents:["Now I want a want to g\n"]},{$$data_type:"org-node",type:"src-block",ref:"org0918a7a",properties:{language:"scheme",switches:null,parameters:null,"number-lines":null,"preserve-indent":!1,"retain-labels":!0,"use-labels":!0,"label-fmt":null,value:'(def (org-headline-id node)\n  (def cid? (js#ref node drawer: CUSTOM_ID:))\n  (if (not (js#undefined? cid?)) cid? (js#ref node ref:)))\n\n(def OrgNodeHeadlineTitle\n  (js#jso functional: #t\n\t  render: (lambda (h c)\n\t\t    (def level (js#ref c props: node: properties: level:))\n\t\t    (def no-id (let ((nid (js#ref c props: noID:)))\n\t\t\t\t (if (js#undefined? nid) #f nid)))\n\t\t    (def sz (+ 0.75 (/ 2 level)))\n\t\t    (def size (##string-append (##number->string sz) "em"))\n\t\t    (def height (##string-append (##number->string (/ sz 2)) "em"))\n\t\t    (def hid (org-headline-id (js#ref c props: node:)))\n\t\t    (def style (let ((s (js#ref c props: style:)))\n\t\t\t\t (if (js#undefined? s)\n\t\t\t\t   (js#jso\n\t\t\t\t    display: "block"\n\t\t\t\t    font-size: size\n\t\t\t\t    font-weight: "bold"\n\t\t\t\t    line-height: height\n\t\t\t\t    padding: 0\n\t\t\t\t    margin: 0\n\t\t\t\t    margin-top: "0.75em"\n\t\t\t\t    margin-bottom: "0.5em")\n\t\t\t\t   s)))\n\t\t    (if (not (##number? level))\n\t\t      (begin (js#console.log 123 "wta?" c) (h "div" "no number"))\n\t\t    ;;(js#console.error 43221 no-id (js#ref c props:))\n\t\t    (h (##string-append "h" (##number->string level))\n\t\t       { style: style }\n\t\t       (vector-append\n\t\t\t(if no-id #()\n\t\t\t    (vector (h "div" { style: {\n\t\t\t\t\t\t   position: "absolute"\n\t\t\t\t\t\t   margin: "-4.15em"\n\t\t\t\t\t\t   }\n\t\t\t\t\t   attrs: { id: hid }\n\n\t\t\t\t\t   }\n\t\t\t\t   "")\n\t\t\t\t    (h "a" { style: { float: "right" margin-top: "0.25em" margin-left: "2em"\n\t\t\t\t\t\t      opacity: "0.5" cursor: "pointer" text-decoration: "none"\n\t\t\t\t\t\t    }\n\t\t\t\t\t     attrs: { href: (string-append "#TOC" hid) title: "Back to Table Of Contents" }\n\t\t\t\t\t   }\n\t\t\t\t       "☰")))\n\t\t\t(renderOrgNodeChildren\n\t\t\t h c (js#ref c props: node: properties: title:)))))))\n  )\n(def OrgNodeHeadline\n  (js#jso functional: #t\n\t  render: (lambda (h c)\n\t\t    (def node (js#ref c props: node:))\n\t\t    (def children (js#ref c children:))\n\t\t    (def props (js#ref node properties:))\n\t\t    (def comps (js#ref props components:))\n\t\t    (def data (js#jso props: (js#jso node: node components: comps)))\n\t\t   ; (js#console.log children)\n\t\t    (h "div" data\n\t\t       (##vector-append\n\t\t\t(vector (h (find-org-node-component node key: \'headlineTitle comps)\n\t\t\t\t   data))\n\t\t\tchildren)\n\t\t    ))))\n',"post-blank":0,"post-affiliated":62035},contents:[]}]},{$$data_type:"org-node",type:"headline",ref:"org940058f",drawer:{},properties:{"tags-all":[],"raw-value":"~OrgDoc~ with TOC","pre-blank":1,level:2,priority:null,tags:[],"todo-keyword":null,"todo-type":null,"post-blank":0,"footnote-section-p":!1,archivedp:!1,commentedp:!1,"post-affiliated":64266,title:[{$$data_type:"org-node",type:"code",ref:"org46609d2",properties:{value:"OrgDoc","post-blank":1},contents:[]},"with TOC"]},contents:[{$$data_type:"org-node",type:"section",ref:"org78ee982",properties:{"post-blank":2,"post-affiliated":64288},contents:[{$$data_type:"org-node",type:"paragraph",ref:"orge74959d",properties:{"post-blank":1,"post-affiliated":64288},contents:["While going through the now dynamic document parameter and looking for it on\neach reference is actually quite easy and more than possible I can actually\nstore ",{$$data_type:"org-node",type:"code",ref:"orgc0ed53a",properties:{value:"meta:","post-blank":1},contents:[]},"information within the ",{$$data_type:"org-node",type:"code",ref:"org5a1c1be",properties:{value:"OrgDoc","post-blank":1},contents:[]},"inside ",{$$data_type:"org-node",type:"code",ref:"org69d7243",properties:{value:"data:","post-blank":0},contents:[]},", which is not an\nandroid.\n"]},{$$data_type:"org-node",type:"src-block",ref:"org28e7e79",properties:{language:"scheme",switches:null,parameters:null,"number-lines":null,"preserve-indent":!1,"retain-labels":!0,"use-labels":!0,"label-fmt":null,value:'(def current-OrgDoc (##make-parameter #f))\n(def OrgDoc\n  (js#jso\n   props: #( "document" "components")\n   created: (js#function ()\n\t     (set! (js#ref js#this meta:) (js#jso))\n\t     (set! (js#ref js#this show-popup?:) #f))\n   ;data: (lambda _ (js#jso show-popup?: #f))\n   methods: (js#jso\n\t     $around: (js#function (next)\n\t\t\t(parameterize ((current-OrgDoc js#this)) (next))))\n   render: (js#function (h)\n\t     ;; (js#console.error 23445 js#this (js#ref js#this document: contents:))\n\t      (h "div"\n\t\t (vector\n\t\t\t (renderOrgDoc js#this h))))))\n',"post-blank":0,"post-affiliated":64529},contents:[]}]}]}]},{$$data_type:"org-node",type:"headline",ref:"org918cbfa",drawer:{},properties:{"tags-all":[],"raw-value":"The (new) Syntax","pre-blank":1,level:1,priority:null,tags:[],"todo-keyword":null,"todo-type":null,"post-blank":2,"footnote-section-p":!1,archivedp:!1,commentedp:!1,"post-affiliated":65106,title:["The (new) Syntax"]},contents:[{$$data_type:"org-node",type:"section",ref:"org8dc9e29",properties:{"post-blank":2,"post-affiliated":65126},contents:[{$$data_type:"org-node",type:"src-block",ref:"org7a06fe5",properties:{language:"scheme",switches:null,parameters:null,"number-lines":null,"preserve-indent":!1,"retain-labels":!0,"use-labels":!0,"label-fmt":null,value:"namespace: #f\n\n\n(import\n  (prefix-in (only-in <MOP> @method) @))\n\n(defsyntax (@method stx)\n  (syntax-case stx ()\n    ((_ kv ...)\n     #'(js#jso kv ...))))\n\n(export js#function js#this js#++)\n\n(export @method @@method)\n(def js#this (##inline-host-expression \"window;\"))\n\n(defsyntax (js#function stx)\n  (syntax-case stx ()\n    ((macro _args body ...)\n     (let* ((args (syntax->datum #'_args))\n\t    (binds (let lp ((bs args) (n 0))\n\t\t     (if (null? bs) bs\n\t\t\t (cons (list (car bs) `(##vector-ref js#arguments ,n))\n\t\t\t       (lp (cdr bs) (+ n 1)))))))\n       (with-syntax ((lbinds (datum->syntax #'macro binds))\n\t\t     (this\n\t\t      (datum->syntax #'macro 'js#this))\n\t\t     (args (datum->syntax #'macro 'js#arguments)))\n\t   #'(let ((fn (lambda (this args)\n\t\t\t (let lbinds\n\t\t\t     (begin (##inline-host-expression \"undefined\") body ...)))))\n\t       (js#js->foreign (##inline-host-expression\n\t\t\t      \"function (...args) { let scmProc = g_scm2host(@1@);\n  return scmProc(this, args);\n   };\" fn))))))))\n\n(defsyntax (js#++ stx)\n  (syntax-case stx ()\n    ((macro place number)\n       #'(let ((val place))\n\t   (set! place (+ val number))))\n    ((macro place)\n     #'(macro place 1))))\n","post-blank":0,"post-affiliated":65126},contents:[]}]}]},{$$data_type:"org-node",type:"headline",ref:"orgf50ef44",drawer:{},properties:{"tags-all":[],"raw-value":"The (new) FFI","pre-blank":1,level:1,priority:null,tags:[],"todo-keyword":null,"todo-type":null,"post-blank":1,"footnote-section-p":!1,archivedp:!1,commentedp:!1,"post-affiliated":66334,title:["The (new) FFI"]},contents:[{$$data_type:"org-node",type:"section",ref:"orgce8ca04",properties:{"post-blank":1,"post-affiliated":66351},contents:[{$$data_type:"org-node",type:"src-block",ref:"org1d25b16",properties:{language:"scheme",switches:null,parameters:null,"number-lines":null,"preserve-indent":!1,"retain-labels":!0,"use-labels":!0,"label-fmt":null,value:'namespace: js\n(export @method @@method)\n\n(import\n  (prefix-in (only-in <MOP> @method) @))\n\n(defsyntax (@method stx)\n  (syntax-case stx ()\n    ((_ kv ...)\n     #\'(js#jso kv ...))))\n\n(def (console.log . objs)\n  (##inline-host-statement "console.log.apply(this, (@1@))" (##list->vector objs)))\n\n(def (debug . args) (##apply console.log (map scm->js args)))\n\n(def (console.error . objs)\n  (##inline-host-statement "console.error.apply(this, (@1@))" (##list->vector objs)))\n(def (undefined? thing)\n  (##inline-host-expression "(() => { res = @1@ === undefined ; return g_host2scm(res); })()" thing))\n\n(def (new-plist->jso plist)\n  (def alist [])\n  (let lp ((pl plist))\n    (if (null? pl)\n      (let ((jso ((lambda () (##inline-host-expression "(() => { foo = (@1@);  return g_host2foreign(g_scm2host(foo)); })();"\n\t\t\t\t\t    (reverse alist))))))\n\t;; (js#console.log jso)\n\tjso)\n\t(let* ((key (##car pl))\n\t       (key (if (or (keyword? key) (symbol? key))\n\t\t      (##symbol->string key)\n\t\t      key))\n\t       (val (##cadr pl))\n\t       (rest (##cddr pl)))\n\t(set! alist (##cons (##cons key val) alist))\n\t(lp rest)))))\n\n(def (jso . plist)\n  (if (null? plist) (##inline-host-expression "g_host2scm({});")\n  (new-plist->jso plist)))\n\n\n{%js#ref%}\n{%js#ref-set!%}\n\n(def (Object.keys obj)\n  (def js-obj (if (##foreign? obj) (js#scm->js obj) obj))\n  (def vkeys (##inline-host-expression "g_host2scm(Object.keys(@1@))" js-obj))\n  vkeys)\n\n(def (map-object fn obj)\n  (vector-map (lambda (k) (fn k (js#ref obj k))) (js#Object.keys obj)))\n\n\n(def (alert thing) (##inline-host-statement "var foo = (@1@);\n  var bar = typeof foo === \'string\' ? foo : g_scm2host(foo)\n  alert(bar);" thing))\n\n;; (alert "New FFi")\n\n(def (js->foreign obj)\n  (##inline-host-expression "g_host2foreign(@1@);" obj))\n(def (foreign->js obj)\n  (if (not (##foreign? obj))\n    (##error "Not a foreign object"))\n  (##inline-host-expression "g_foreign2host(@1@);" obj))\n\n\n(def (scm->js obj)\n  (begin\n    (##inline-host-statement "var result;")\n    (##inline-host-statement "try {result = g_scm2host(@1@);} catch (e) {result = Error(e);}" obj)\n    (let ((result (##inline-host-expression "result;")))\n      (if (js->scm (##inline-host-expression "@1@ instanceof Error;" result))\n\t  (##error result)\n\t  result))))\n\n(def (js->scm obj)\n  (##inline-host-expression "g_host2scm(@1@);" obj))\n\n(def (JSON.stringify jso (f2host #t))\n  (let ((obj (if (and f2host (##foreign? jso)) (js#foreign->js jso) jso)))\n    (##inline-host-expression "g_host2scm(JSON.stringify(@1@));" obj)))\n\n(def (plist->jso plist)\n  (def jso (##make-vector 0))\n  (def (p->o p)\n    (if (null? p) jso\n\t(begin ; (console.log p)\n\t       (set! jso (##vector-set!\n\t\t\t  jso (##car p)\n\t\t\t  (let ((obj (##cadr p)))\n\t\t\t    (if (##foreign? obj)\n\t\t\t      (##inline-host-expression "g_foreign2host(@1@);" obj)\n\t\t\t     ; (if (##procedure? obj) obj\n\t\t\t      (##inline-host-expression "g_scm2host(@1@);" obj)))))\n\t       (p->o (##cddr p)))))\n  (##inline-host-expression "Object.fromEntries(Object.entries(@1@));" (p->o plist)))\n\n',"post-blank":0,"post-affiliated":66351},contents:[]}]}]},{$$data_type:"org-node",type:"headline",ref:"orgeff7da3",drawer:{},properties:{"tags-all":[],"raw-value":"The (new) Runtime","pre-blank":1,level:1,priority:null,tags:["NOEXPORT"],"todo-keyword":null,"todo-type":null,"post-blank":1,"footnote-section-p":!1,archivedp:!1,commentedp:!1,"post-affiliated":69401,title:["The (new) Runtime"]},contents:[{$$data_type:"org-node",type:"section",ref:"orgad90fca",properties:{"post-blank":1,"post-affiliated":69433},contents:[{$$data_type:"org-node",type:"paragraph",ref:"org78cc1df",properties:{"post-blank":1,"post-affiliated":69433},contents:["This ",{$$data_type:"org-node",type:"code",ref:"org831005e",properties:{value:".scm","post-blank":1},contents:[]},"file is con'",{$$data_type:"org-node",type:"code",ref:"org55c45af",properties:{value:"cat","post-blank":0},contents:[]},"'ed at the end. It's just because Gerbil and Gambit\ntreat namespaces slightly differently.\n"]},{$$data_type:"org-node",type:"src-block",ref:"orgc0aaa88",properties:{language:"scheme",switches:null,parameters:null,"number-lines":null,"preserve-indent":!1,"retain-labels":!0,"use-labels":!0,"label-fmt":null,value:"(namespace (\"\"))\n(define (apply . args) (##apply ##apply args))\n(define (string-append . strs) (##apply ##string-append strs))\n(define (error . args) (apply ##error args))\n;; (##include \"header.scm\")\n\n;; (##include \"~~/lib/gambit#.scm\")\n;; (##include \"~~/lib/_gambit#.scm\")\n;; (include \"~~lib/_system#.scm\")\n\n(##declare\n  (multilisp)\n  (extended-bindings)\n  (not safe)\n  (block)\n;;  (fixnum)\n  (inlining-limit 134)\n  (not run-time-bindings)\n)\n\n;;;============================================================================\n;;; _system // hmmm.. may be important\n(##define-macro (macro-define-equal-objs?\n\t\t equal-objs?\n\t\t params\n\t\t custom-recursion-handler\n\t\t .\n\t\t local-defines)\n\n  `(define (,equal-objs? obj1 obj2 ,@params)\n\n     ,@local-defines\n\n     ,@(if custom-recursion-handler\n\t   `()\n\t   `((define (table-equal obj1 obj2 ,@params)\n\t       (conj (gc-hash-table-equal (macro-table-gcht obj1)\n\t\t\t\t\t  obj2\n\t\t\t\t\t  ,@params)\n\t\t     (if (macro-table-test obj1)\n\t\t\t (gc-hash-table-equal (macro-table-hash obj1)\n\t\t\t\t\t      obj2\n\t\t\t\t\t      ,@params)\n\t\t\t (true))))\n\n\t     (define (gc-hash-table-equal ht1 table2 ,@params)\n\t       (##declare (not interrupts-enabled))\n\t       (if (##gc-hash-table? ht1)\n\t\t   (let loop ((i (macro-gc-hash-table-key0))\n\t\t\t      ,@(map (lambda (p) `(,p ,p))\n\t\t\t\t     params))\n\t\t     (if (##fx< i (##vector-length ht1))\n\t\t\t (let ((key1 (##vector-ref ht1 i)))\n\t\t\t   (if (or (##eq? key1 (macro-unused-obj))\n\t\t\t\t   (##eq? key1 (macro-deleted-obj)))\n\t\t\t       (let ()\n\t\t\t\t (##declare (interrupts-enabled))\n\t\t\t\t (loop (##fx+ i 2)\n\t\t\t\t       ,@params))\n\t\t\t       (let* ((val1\n\t\t\t\t       (##vector-ref ht1 (##fx+ i 1)))\n\t\t\t\t      (val2\n\t\t\t\t       (##table-ref table2\n\t\t\t\t\t\t    key1\n\t\t\t\t\t\t    (macro-unused-obj))))\n\t\t\t\t (conj (,equal-objs?\n\t\t\t\t\tval1\n\t\t\t\t\tval2\n\t\t\t\t\t,@params)\n\t\t\t\t       (let ()\n\t\t\t\t\t (##declare (interrupts-enabled))\n\t\t\t\t\t (loop (##fx+ i 2)\n\t\t\t\t\t       ,@params))))))\n\t\t\t (true)))))\n\n\t     (define (structure-equal obj1 obj2 type len ,@params)\n\t       (if (##not type) ;; have we reached root of inheritance chain?\n\t\t   (true)\n\t\t   (let ((fields (##type-fields type)))\n\t\t     (let loop ((i*3 (##fx- (##vector-length fields) 3))\n\t\t\t\t(len len)\n\t\t\t\t,@(map (lambda (p) `(,p ,p))\n\t\t\t\t       params))\n\t\t       (if (##fx< i*3 0) ;; time to check inherited fields?\n\t\t\t   (structure-equal obj1\n\t\t\t\t\t    obj2\n\t\t\t\t\t    (##type-super type)\n\t\t\t\t\t    len\n\t\t\t\t\t    ,@params)\n\t\t\t   (let ((field-attributes\n\t\t\t\t  (##vector-ref fields (##fx+ i*3 1)))\n\t\t\t\t (len-1\n\t\t\t\t  (##fx- len 1)))\n\t\t\t     (if (##not (##fx= ;; equality-skip flag set?\n\t\t\t\t\t (##fxand field-attributes 4)\n\t\t\t\t\t 0))\n\t\t\t\t (loop (##fx- i*3 3) ;; don't check this field\n\t\t\t\t       len-1\n\t\t\t\t       ,@params)\n\t\t\t\t (conj (,equal-objs? (##unchecked-structure-ref\n\t\t\t\t\t\t      obj1\n\t\t\t\t\t\t      len-1\n\t\t\t\t\t\t      type\n\t\t\t\t\t\t      #f)\n\t\t\t\t\t\t     (##unchecked-structure-ref\n\t\t\t\t\t\t      obj2\n\t\t\t\t\t\t      len-1\n\t\t\t\t\t\t      type\n\t\t\t\t\t\t      #f)\n\t\t\t\t\t\t     ,@params)\n\t\t\t\t       (loop (##fx- i*3 3)\n\t\t\t\t\t     len-1\n\t\t\t\t\t     ,@params)))))))))))\n\n     (macro-force-vars (obj1 obj2)\n       (if (##eq? obj1 obj2)\n\t   (begin\n\t     (profile! 0)\n\t     (true))\n\t   (cond ((##pair? obj1)\n\t\t  (profile! 1)\n\t\t  (if (##not (##pair? obj2))\n\t\t      (false)\n\t\t      ,(if custom-recursion-handler\n\t\t\t   `(,custom-recursion-handler obj1 obj2 ,@params)\n\t\t\t   `(recursion\n\t\t\t     obj1\n\t\t\t     obj2\n\t\t\t     (conj (,equal-objs? (##car obj1)\n\t\t\t\t\t\t (##car obj2)\n\t\t\t\t\t\t ,@params)\n\t\t\t\t   (,equal-objs? (##cdr obj1)\n\t\t\t\t\t\t (##cdr obj2)\n\t\t\t\t\t\t ,@params))))))\n\t\t ((##vector? obj1)\n\t\t  (profile! 2)\n\t\t  (if (##not (##vector? obj2))\n\t\t      (false)\n\t\t      (let ((len (##vector-length obj1)))\n\t\t\t(if (##not (##fx= len (##vector-length obj2)))\n\t\t\t    (false)\n\t\t\t    ,(if custom-recursion-handler\n\t\t\t\t `(,custom-recursion-handler obj1 obj2 ,@params)\n\t\t\t\t `(recursion\n\t\t\t\t   obj1\n\t\t\t\t   obj2\n\t\t\t\t   (let loop ((i (##fx- len 1))\n\t\t\t\t\t      ,@(map (lambda (p) `(,p ,p))\n\t\t\t\t\t\t     params))\n\t\t\t\t     (if (##fx< i 0)\n\t\t\t\t\t (true)\n\t\t\t\t\t (conj (,equal-objs?\n\t\t\t\t\t\t(##vector-ref obj1 i)\n\t\t\t\t\t\t(##vector-ref obj2 i)\n\t\t\t\t\t\t,@params)\n\t\t\t\t\t       (loop (##fx- i 1)\n\t\t\t\t\t\t     ,@params))))))))))\n\t\t ((##fixnum? obj1)\n\t\t  (profile! 3)\n\t\t  (if (and (##fixnum? obj2)\n\t\t\t   (##fx= obj1 obj2))\n\t\t      (true)\n\t\t      (false)))\n\t\t ((##bignum? obj1)\n\t\t  (profile! 4)\n\t\t  (if (and (##bignum? obj2)\n\t\t\t   (##exact-int.= obj1 obj2))\n\t\t      (true)\n\t\t      (false)))\n\t\t ((##ratnum? obj1)\n\t\t  (profile! 5)\n\t\t  (if (and (##ratnum? obj2)\n\t\t\t   (##ratnum.= obj1 obj2))\n\t\t      (true)\n\t\t      (false)))\n\t\t ((##flonum? obj1)\n\t\t  (profile! 6)\n\t\t  (if (and (##flonum? obj2)\n\t\t\t   (##fleqv? obj1 obj2))\n\t\t      (true)\n\t\t      (false)))\n\t\t ((##cpxnum? obj1)\n\t\t  (profile! 7)\n\t\t  (if (and (##cpxnum? obj2)\n\t\t\t   (##eqv? (macro-cpxnum-real obj1)\n\t\t\t\t   (macro-cpxnum-real obj2))\n\t\t\t   (##eqv? (macro-cpxnum-imag obj1)\n\t\t\t\t   (macro-cpxnum-imag obj2)))\n\t\t      (true)\n\t\t      (false)))\n\t\t ((macro-table? obj1)\n\t\t  (profile! 8)\n\t\t  (if (##not (and (macro-table? obj2)\n\t\t\t\t  (##fx= (macro-table-flags obj1)\n\t\t\t\t\t (macro-table-flags obj2))\n\t\t\t\t  (##eq? (macro-table-test obj1)\n\t\t\t\t\t (macro-table-test obj2))\n\t\t\t\t  (if (macro-table-test obj1)\n\t\t\t\t      (##eq? (macro-table-hash obj1)\n\t\t\t\t\t     (macro-table-hash obj2))\n\t\t\t\t      #t)\n\t\t\t\t  (##fx= (##table-length obj1)\n\t\t\t\t\t (##table-length obj2))))\n\t\t      (false)\n\t\t      ,(if custom-recursion-handler\n\t\t\t   `(,custom-recursion-handler\n\t\t\t     obj1\n\t\t\t     obj2\n\t\t\t     ,@params)\n\t\t\t   `(recursion\n\t\t\t     obj1\n\t\t\t     obj2\n\t\t\t     (table-equal\n\t\t\t      obj1\n\t\t\t      obj2\n\t\t\t      ,@params)))))\n\t\t ((##structure? obj1)\n\t\t  (profile! 9)\n\t\t  (if (##not (##structure? obj2))\n\t\t      (false)\n\t\t      (let ((type (##structure-type obj1)))\n\t\t\t(if (##not (##eq? (##type-id type)\n\t\t\t\t\t  (##type-id\n\t\t\t\t\t   (##structure-type obj2))))\n\t\t\t    (false)\n\t\t\t    (let ((len (##structure-length obj1)))\n\t\t\t      (if (##not\n\t\t\t\t   (and (##fx=\n\t\t\t\t\t len\n\t\t\t\t\t (##structure-length obj2))\n\t\t\t\t\t(##fx= ;; not opaque?\n\t\t\t\t\t (##fxand\n\t\t\t\t\t  (##type-flags type)\n\t\t\t\t\t  1)\n\t\t\t\t\t 0)))\n\t\t\t\t  (false)\n\t\t\t\t  ,(if custom-recursion-handler\n\t\t\t\t       `(,custom-recursion-handler\n\t\t\t\t\t obj1\n\t\t\t\t\t obj2\n\t\t\t\t\t ,@params)\n\t\t\t\t       `(recursion\n\t\t\t\t\t obj1\n\t\t\t\t\t obj2\n\t\t\t\t\t (structure-equal\n\t\t\t\t\t  obj1\n\t\t\t\t\t  obj2\n\t\t\t\t\t  type\n\t\t\t\t\t  len\n\t\t\t\t\t  ,@params)))))))))\n\t\t ((##box? obj1)\n\t\t  (profile! 10)\n\t\t  (if (##not (##box? obj2))\n\t\t      (false)\n\t\t      ,(if custom-recursion-handler\n\t\t\t   `(,custom-recursion-handler\n\t\t\t     obj1\n\t\t\t     obj2\n\t\t\t     ,@params)\n\t\t\t   `(recursion\n\t\t\t     obj1\n\t\t\t     obj2\n\t\t\t     (,equal-objs?\n\t\t\t      (##unbox obj1)\n\t\t\t      (##unbox obj2)\n\t\t\t      ,@params)))))\n\t\t ((##string? obj1)\n\t\t  (profile! 11)\n\t\t  (if (and (##string? obj2)\n\t\t\t   (##string-equal? obj1 obj2))\n\t\t      (true)\n\t\t      (false)))\n\t\t ((##u8vector? obj1)\n\t\t  (profile! 12)\n\t\t  (if (and (##u8vector? obj2)\n\t\t\t   (##u8vector-equal? obj1 obj2))\n\t\t      (true)\n\t\t      (false)))\n\t\t ((##s8vector? obj1)\n\t\t  (profile! 13)\n\t\t  (if (and (##s8vector? obj2)\n\t\t\t   (##s8vector-equal? obj1 obj2))\n\t\t      (true)\n\t\t      (false)))\n\t\t ((##u16vector? obj1)\n\t\t  (profile! 14)\n\t\t  (if (and (##u16vector? obj2)\n\t\t\t   (##u16vector-equal? obj1 obj2))\n\t\t      (true)\n\t\t      (false)))\n\t\t ((##s16vector? obj1)\n\t\t  (profile! 15)\n\t\t  (if (and (##s16vector? obj2)\n\t\t\t   (##s16vector-equal? obj1 obj2))\n\t\t      (true)\n\t\t      (false)))\n\t\t ((##u32vector? obj1)\n\t\t  (profile! 16)\n\t\t  (if (and (##u32vector? obj2)\n\t\t\t   (##u32vector-equal? obj1 obj2))\n\t\t      (true)\n\t\t      (false)))\n\t\t ((##s32vector? obj1)\n\t\t  (profile! 17)\n\t\t  (if (and (##s32vector? obj2)\n\t\t\t   (##s32vector-equal? obj1 obj2))\n\t\t      (true)\n\t\t      (false)))\n\t\t ((##u64vector? obj1)\n\t\t  (profile! 18)\n\t\t  (if (and (##u64vector? obj2)\n\t\t\t   (##u64vector-equal? obj1 obj2))\n\t\t      (true)\n\t\t      (false)))\n\t\t ((##s64vector? obj1)\n\t\t  (profile! 19)\n\t\t  (if (and (##s64vector? obj2)\n\t\t\t   (##s64vector-equal? obj1 obj2))\n\t\t      (true)\n\t\t      (false)))\n\t\t ((##f32vector? obj1)\n\t\t  (profile! 20)\n\t\t  (if (and (##f32vector? obj2)\n\t\t\t   (##f32vector-equal? obj1 obj2))\n\t\t      (true)\n\t\t      (false)))\n\t\t ((##f64vector? obj1)\n\t\t  (profile! 21)\n\t\t  (if (and (##f64vector? obj2)\n\t\t\t   (##f64vector-equal? obj1 obj2))\n\t\t      (true)\n\t\t      (false)))\n\t\t (else\n\t\t  (profile! 22)\n\t\t  (false)))))))\n(define-prim (##equal? obj1 obj2)\n\n  (##define-macro (profile! i)\n    `#f) ;; disable profiling\n\n  (macro-define-equal-objs?\n   equal-objs? ()\n   #f\n\n   (##define-macro (macro-table-hash obj) `#f)\n   (##define-macro (macro-table-gcht obj) `#f)\n\n   (##define-macro (true) `#t)\n   (##define-macro (false) `#f)\n\n   (##define-macro (recursion obj1 obj2 tail-expr)\n     tail-expr)\n\n   (##define-macro (conj equal-obj?-expr tail-expr)\n     `(and ,equal-obj?-expr ,tail-expr)))\n\n  (equal-objs? obj1 obj2))\n\n(define-prim (equal? obj1 obj2)\n  (##equal? obj1 obj2))\n;;;============================================================================\n\n;; sys\n;;; Type operations.\n\n\n(define-prim (##type obj))\n(define-prim (##type-cast obj type))\n(define-prim (##subtype obj))\n(define-prim (##subtype-set! obj subtype))\n\n;;; Basic type predicates.\n(define-prim (##subtyped? obj)\n  (##eq? (##type obj) (macro-type-subtyped)))\n\n(define-prim (##structure? obj)\n  (and (##subtyped? obj)\n       (##eq? (##subtype obj) (macro-subtype-structure))))\n\n;;;----------------------------------------------------------------------------\n\n;;;============================================================================\n;; Kernel\n(define ##os-system-version-string-saved\n  (let ()\n\n    (##define-macro (comp-version-string)\n      (c#compiler-version-string))\n\n    (macro-case-target\n     ((C)\n      (or ((c-lambda () char-string \"___return(___STAMP_VERSION);\"))\n\t  (comp-version-string)))\n     (else\n      (comp-version-string)))))\n\n(define-prim (##system-version-string)\n  ##os-system-version-string-saved)\n\n(define-prim (system-version-string)\n  (##system-version-string))\n\n\n;;;----------------------------------------------------------------------------\n\n;;; Garbage collection.\n\n(define (##execute-final-wills!)\n  ;; do nothing because wills are only implemented in C backend\n  #f)\n\n;;;----------------------------------------------------------------------------\n\n;;; Jobs.\n\n(define-prim (##make-jobs)\n  (macro-make-fifo))\n\n(define-prim (##add-job-at-tail! jobs job)\n  (macro-fifo-insert-at-tail! jobs job))\n\n(define-prim (##add-job! jobs job)\n  (macro-fifo-insert-at-head! jobs job))\n\n(define-prim (##execute-jobs! jobs)\n  (let loop ((lst (macro-fifo->list jobs)))\n    (if (##pair? lst)\n      (begin\n\t((##car lst))\n\t(loop (##cdr lst))))))\n\n(define-prim (##execute-and-clear-jobs! jobs)\n  (let loop ((lst (macro-fifo-remove-all! jobs)))\n    (if (##pair? lst)\n      (begin\n\t((##car lst))\n\t(loop (##cdr lst))))))\n\n(define-prim (##clear-jobs! jobs)\n  (macro-fifo-remove-all! jobs)\n  (##void))\n\n;;;----------------------------------------------------------------------------\n\n;;;----------------------------------------------------------------------------\n\n;;; Process exit.\n\n(define-prim (##exit-with-err-code-no-cleanup err-code)\n  (##declare (not interrupts-enabled))\n  (macro-case-target\n\n   ((js)\n    (##inline-host-statement\n     \"\n      var code = g_scm2host(@1@);\n      if ((function () { return this !== this.window; })()) { // nodejs?\n\tprocess.exit(code);\n      } else {\n\tthrow Error('process exiting with code=' + code);\n      }\n     \"\n     (##fx- err-code 1)))\n\n   ((python)\n    (##inline-host-statement \"exit(@1@)\" (##fx- err-code 1)))\n\n   (else\n    (println \"unimplemented ##exit-with-err-code-no-cleanup called with err-code=\")\n    (println err-code))))\n\n(define ##exit-jobs (##make-jobs))\n\n;;; (##add-exit-job! thunk) can be called to add a job to\n;;; do when the program exits.  (##clear-exit-jobs!) clears the jobs.\n\n(define-prim (##add-exit-job! thunk)\n  (##add-job! ##exit-jobs thunk))\n\n(define-prim (##clear-exit-jobs!)\n  (##clear-jobs! ##exit-jobs))\n\n(define ##cleaning-up? #f)\n\n(define-prim (##exit-cleanup)\n  (let ((is-in-cleanup? ##cleaning-up?))\n    (set! ##cleaning-up? #t) ;; only do cleanup once\n    (if (##not is-in-cleanup?)\n\t(begin\n\t  (##execute-and-clear-jobs! ##exit-jobs)\n\t  (##execute-final-wills!)))))\n\n(define-prim (##exit-with-err-code err-code)\n  (##exit-cleanup)\n  (##exit-with-err-code-no-cleanup err-code))\n\n(define-prim (##exit #!optional (status (macro-EXIT-CODE-OK)))\n  (##exit-with-err-code (##fx+ status 1)))\n\n(define-prim (##exit-abruptly #!optional (status (macro-EXIT-CODE-SOFTWARE)))\n  (##exit-with-err-code-no-cleanup (##fx+ status 1)))\n\n(define-prim (##exit-with-exception exc)\n  (##exit (macro-EXIT-CODE-SOFTWARE)))\n\n(implement-library-type-wrong-number-of-arguments-exception)\n\n(define-prim (##raise-wrong-number-of-arguments-exception-nary proc . args)\n  (##declare (not interrupts-enabled))\n  (##raise-wrong-number-of-arguments-exception proc args))\n\n#;(define-prim (##raise-wrong-number-of-arguments-exception proc args)\n  (##declare (not interrupts-enabled))\n  (macro-raise\n   (macro-make-wrong-number-of-arguments-exception proc args)))\n;;;----------------------------------------------------------------------------\n\n;;;============================================================================\n;; ;;; Structure support.\n\n;; ;; For bootstraping purposes the type of type objects must be\n;; ;; explicitly constructed.  It is as though the following form had\n;; ;; been used:\n;; ;;\n;; ;;   (define-type type\n;; ;;     id: ...special-type...\n;; ;;     (id      unprintable: equality-test:)\n;; ;;     (name    unprintable: equality-skip:)\n;; ;;     (flags   unprintable: equality-skip:)\n;; ;;     (super   unprintable: equality-skip:)\n;; ;;     (fields  unprintable: equality-skip:)\n;; ;;   )\n\n;; (##define-macro (macro-type-type-constant)\n;;   (let ((type-type\n;;          (##structure\n;;           #f ;; this structure's type descriptor is itself! (set later)\n;;           '##type-5\n;;           'type\n;;           '8\n;;           '#f\n;;           '#(id 1 #f name 5 #f flags 5 #f super 5 #f fields 5 #f))))\n;;     (##structure-type-set! type-type type-type) ;; self reference\n;;     `',type-type))\n\n;; (define ##type-type (macro-type-type-constant))\n\n;; (define-prim (##type-id type)\n;;   (##unchecked-structure-ref type 1 ##type-type ##type-id))\n\n;; (define-prim (##type-name type)\n;;   (##unchecked-structure-ref type 2 ##type-type ##type-name))\n\n;; (define-prim (##type-flags type)\n;;   (##unchecked-structure-ref type 3 ##type-type ##type-flags))\n\n;; (define-prim (##type-super type)\n;;   (##unchecked-structure-ref type 4 ##type-type ##type-super))\n\n;; (define-prim (##type-fields type)\n;;   (##unchecked-structure-ref type 5 ##type-type ##type-fields))\n\n;; (define-prim (##structure-direct-instance-of? obj type-id)\n;;   (and (##structure? obj)\n;;        (##eq? (##type-id (##structure-type obj))\n;;               type-id)))\n\n;; (define-prim (##structure-instance-of? obj type-id)\n;;   (and (##structure? obj)\n;;        (let loop ((c (##structure-type obj)))\n;;          (if (##eq? (##type-id c) type-id)\n;;            #t\n;;            (let ((super (##type-super c)))\n;;              (and super\n;;                   (loop super)))))))\n\n;; (define-prim (##type? obj)\n;;   (##structure-direct-instance-of? obj (##type-id ##type-type)))\n\n;; (define-prim (##structure-type obj)\n;;   (##vector-ref obj 0))\n\n;; (define-prim (##structure-type-set! obj type)\n;;   (##vector-set! obj 0 type))\n\n;; (define-prim (##make-structure type len)\n;;   (let ((s (##make-vector len)))\n;;     (##subtype-set! s (macro-subtype-structure))\n;;     (##vector-set! s 0 type)\n;;     s))\n\n;; (define-prim (##structure-length obj)\n;;   (##vector-length obj))\n\n;; (define-prim (##structure type . fields)\n\n;;   (define (make-struct fields i)\n;;     (if (##pair? fields)\n;;         (let ((s (make-struct (##cdr fields) (##fx+ i 1))))\n;;           (##unchecked-structure-set! s (##car fields) i type #f)\n;;           s)\n;;         (##make-structure type i)))\n\n;;   (make-struct fields 1))\n\n;; (define-prim (##structure-ref obj i type proc)\n;;   (if (##structure-instance-of? obj (##type-id type))\n;;     (##unchecked-structure-ref obj i type proc)\n;;     (##raise-type-exception\n;;      1\n;;      type\n;;      (if proc proc ##structure-ref)\n;;      (if proc (##list obj) (##list obj i type proc)))))\n\n;; (define-prim (##structure-set! obj val i type proc)\n;;   (if (##structure-instance-of? obj (##type-id type))\n;;     (begin\n;;       (##unchecked-structure-set! obj val i type proc)\n;;       (##void))\n;;     (##raise-type-exception\n;;      1\n;;      type\n;;      (if proc proc ##structure-set!)\n;;      (if proc (##list obj val) (##list obj val i type proc)))))\n\n;; (define-prim (##structure-set obj val i type proc)\n;;   (if (##structure-instance-of? obj (##type-id type))\n;;     (let ((result (##structure-copy obj)))\n;;       (##unchecked-structure-set! result val i type proc)\n;;       result)\n;;     (##raise-type-exception\n;;      1\n;;      type\n;;      (if proc proc ##structure-set)\n;;      (if proc (##list obj val) (##list obj val i type proc)))))\n\n;; (define-prim (##structure-cas! obj val oldval i type proc)\n;;   (if (##structure-instance-of? obj (##type-id type))\n;;     (begin\n;;       (##unchecked-structure-cas! obj val oldval i type proc)\n;;       (##void))\n;;     (##raise-type-exception\n;;      1\n;;      type\n;;      (if proc proc ##structure-cas!)\n;;      (if proc (##list obj val oldval) (##list obj val oldval i type proc)))))\n\n;; (define-prim (##direct-structure-ref obj i type proc)\n;;   (if (##structure-direct-instance-of? obj (##type-id type))\n;;     (##unchecked-structure-ref obj i type proc)\n;;     (##raise-type-exception\n;;      1\n;;      type\n;;      (if proc proc ##direct-structure-ref)\n;;      (if proc (##list obj) (##list obj i type proc)))))\n\n;; (define-prim (##direct-structure-set! obj val i type proc)\n;;   (if (##structure-direct-instance-of? obj (##type-id type))\n;;     (begin\n;;       (##unchecked-structure-set! obj val i type proc)\n;;       (##void))\n;;     (##raise-type-exception\n;;      1\n;;      type\n;;      (if proc proc ##direct-structure-set!)\n;;      (if proc (##list obj val) (##list obj val i type proc)))))\n\n;; (define-prim (##direct-structure-set obj val i type proc)\n;;   (if (##structure-direct-instance-of? obj (##type-id type))\n;;     (let ((result (##structure-copy obj)))\n;;       (##unchecked-structure-set! result val i type proc)\n;;       result)\n;;     (##raise-type-exception\n;;      1\n;;      type\n;;      (if proc proc ##direct-structure-set)\n;;      (if proc (##list obj val) (##list obj val i type proc)))))\n\n;; (define-prim (##direct-structure-cas! obj val oldval i type proc)\n;;   (if (##structure-direct-instance-of? obj (##type-id type))\n;;     (begin\n;;       (##unchecked-structure-cas! obj val oldval i type proc)\n;;       (##void))\n;;     (##raise-type-exception\n;;      1\n;;      type\n;;      (if proc proc ##direct-structure-cas!)\n;;      (if proc (##list obj val oldval) (##list obj val oldval i type proc)))))\n\n;; (define-prim (##unchecked-structure-ref obj i type proc))\n\n;; (define-prim (##unchecked-structure-set! obj val i type proc))\n\n;; (define-prim (##unchecked-structure-cas! obj val oldval i type proc)\n;;   ;; TODO: remove after bootstrap\n;;   (##vector-cas! obj i val oldval))\n\n;; (define-prim (##structure-copy obj)\n;;   (let* ((len (##structure-length obj))\n;;          (type (##structure-type obj))\n;;          (result (##make-structure type len)))\n;;     (let loop ((i (##fx- len 1)))\n;;       (if (##fx> i 0)\n;;           (begin\n;;             (##unchecked-structure-set!\n;;              result\n;;              (##unchecked-structure-ref obj i type ##structure-copy)\n;;              i\n;;              type\n;;              ##structure-copy)\n;;             (loop (##fx- i 1)))\n;;           result))))\n\n;;;----------------------------------------------------------------------------\n\n;;;============================================================================\n;; lists\n\n(##include \"~~/lib/gambit/list/list#.scm\")\n\n(define-fail-check-type pair 'pair)\n(define-fail-check-type pair-list 'pair-list)\n(define-fail-check-type list 'list)\n\n(define-prim (##pair? obj))\n\n(define-prim (pair? obj)\n  (macro-force-vars (obj)\n    (##pair? obj)))\n\n(define-prim (##cons*-aux x rest)\n\n  (include \"~~lib/gambit/prim/prim#.scm\") ;; map fx+ to ##fx+, etc\n\n  (if (pair? rests)\n      (let loop ((x x) (probe rest))\n\t(let ((y (car probe))\n\t      (tail (cdr probe)))\n\t  (set-car! probe x)\n\t  (if (pair? tail)\n\t      (loop y tail)\n\t      (begin\n\t\t(set-cdr! probe y)\n\t\trest))))\n      x))\n(define-prim (##cons* x . rest)\n  (##cons*-aux x rest))\n\n(define-prim (cons* x . rest)\n  (##cons*-aux x rest))\n\n(define-prim (##member obj lst #!optional (compare ##equal?))\n\n  (include \"~~lib/gambit/prim/prim#.scm\") ;; map fx+ to ##fx+, etc\n\n  (let loop ((x lst))\n    (if (pair? x)\n\t(if (compare obj (car x))\n\t    x\n\t    (loop (cdr x)))\n\t#f)))\n\n(define-prim (member obj lst #!optional (c (macro-absent-obj)))\n\n  (include \"~~lib/gambit/prim/prim#.scm\") ;; map fx+ to ##fx+, etc\n  (namespace (\"\" member)) ;; but not member to ##member\n\n  (macro-force-vars (c)\n    (let ((compare (if (eq? c (macro-absent-obj)) ##equal? c)))\n      (macro-check-procedure compare 3 (member obj lst c)\n\t(let loop ((x lst))\n\t  (macro-force-vars (x)\n\t    (if (pair? x)\n\t\t(let ((y (car x)))\n\t\t  (if (compare obj y)\n\t\t      x\n\t\t      (loop (cdr x))))\n\t\t(macro-check-list x 2 (member obj lst c)\n\t\t  #f))))))))\n\n(define-prim (##reverse lst)\n\n  (include \"~~lib/gambit/prim/prim#.scm\") ;; map fx+ to ##fx+, etc\n\n  (let loop ((x lst) (result '()))\n    (if (pair? x)\n\t(loop (cdr x) (cons (car x) result))\n\tresult)))\n\n(define-prim (reverse lst)\n\n  (include \"~~lib/gambit/prim/prim#.scm\") ;; map fx+ to ##fx+, etc\n  (namespace (\"\" reverse)) ;; but not reverse to ##reverse\n\n  (let loop ((x lst) (result '()))\n    (macro-force-vars (x)\n      (if (pair? x)\n\t  (loop (cdr x) (cons (car x) result))\n\t  (macro-check-list x 1 (reverse lst)\n\t    result)))))\n\n(define-prim (##make-list n #!optional (fill 0))\n\n  (include \"~~lib/gambit/prim/prim#.scm\") ;; map fx+ to ##fx+, etc\n\n  (let loop ((i n) (result '()))\n    (if (fx> i 0)\n\t(loop (fx- i 1) (cons fill result))\n\tresult)))\n\n(define-prim (make-list n #!optional (fill (macro-absent-obj)))\n\n  (include \"~~lib/gambit/prim/prim#.scm\") ;; map fx+ to ##fx+, etc\n  (namespace (\"\" make-list)) ;; but not make-list to ##make-list\n\n  (macro-force-vars (n fill)\n    (macro-check-index n 1 (make-list n fill)\n      (if (eq? fill (macro-absent-obj))\n\t  (##make-list n)\n\t  (##make-list n fill)))))\n\n(define-prim (##length lst)\n\n  (include \"~~lib/gambit/prim/prim#.scm\") ;; map fx+ to ##fx+, etc\n\n  (let loop ((x lst) (n 0))\n    (if (pair? x)\n\t(loop (cdr x) (fx+ n 1))\n\tn)))\n\n(define-prim (length lst)\n\n  (include \"~~lib/gambit/prim/prim#.scm\") ;; map fx+ to ##fx+, etc\n  (namespace (\"\" length)) ;; but not length to ##length\n\n  (let loop ((x lst) (n 0))\n    (macro-force-vars (x)\n      (if (pair? x)\n\t  (loop (cdr x) (fx+ n 1))\n\t  (macro-check-list x 1 (length lst)\n\t    n)))))\n\n(define-prim (##append2 lst1 lst2)\n\n  (include \"~~lib/gambit/prim/prim#.scm\") ;; map fx+ to ##fx+, etc\n\n  (if (pair? lst1)\n      (cons (car lst1) (##append2 (cdr lst1) lst2))\n      lst2))\n\n(define-prim (##append-lists lst)\n\n  (include \"~~lib/gambit/prim/prim#.scm\") ;; map fx+ to ##fx+, etc\n\n  (if (pair? lst)\n      (let ((rev-lst (reverse lst)))\n\t(let loop ((rev-lst (cdr rev-lst)) (result (car rev-lst)))\n\t  (if (pair? rev-lst)\n\t      (loop (cdr rev-lst)\n\t\t    (##append2 (car rev-lst) result))\n\t      result)))\n      '()))\n\n(define-prim (##append\n\t      #!optional\n\t      (lst1 (macro-absent-obj))\n\t      (lst2 (macro-absent-obj))\n\t      #!rest\n\t      others)\n\n  (include \"~~lib/gambit/prim/prim#.scm\") ;; map fx+ to ##fx+, etc\n\n  (if (eq? lst2 (macro-absent-obj))\n      (if (eq? lst1 (macro-absent-obj))\n\t  '()\n\t  lst1)\n      (##append-lists (cons lst1 (cons lst2 others)))))\n\n(define-prim (append\n\t      #!optional\n\t      (lst1 (macro-absent-obj))\n\t      (lst2 (macro-absent-obj))\n\t      #!rest\n\t      others)\n\n  (include \"~~lib/gambit/prim/prim#.scm\") ;; map fx+ to ##fx+, etc\n  (namespace (\"\" append)) ;; but not append to ##append\n\n  (define (append-multiple head tail arg-num)\n    (if (null? tail)\n\thead\n\t(macro-force-vars (head)\n\t  (if (null? head)\n\t      (append-multiple (car tail) (cdr tail) (fx+ arg-num 1))\n\t      (list-expected-check\n\t       (append-multiple-non-null head\n\t\t\t\t\t tail\n\t\t\t\t\t arg-num\n\t\t\t\t\t (fx+ arg-num 1)))))))\n\n  (define (append-multiple-non-null x lsts arg-num1 arg-num2)\n    ;; x!=(), returns fixnum on error\n    (let ((head (car lsts))\n\t  (tail (cdr lsts)))\n      (if (null? tail)\n\t  (append-2-non-null x head arg-num1)\n\t  (macro-force-vars (head)\n\t    (if (null? head)\n\t\t(append-multiple-non-null x\n\t\t\t\t\t  tail\n\t\t\t\t\t  arg-num1\n\t\t\t\t\t  (fx+ arg-num2 1))\n\t\t(let ((result\n\t\t       (append-multiple-non-null head\n\t\t\t\t\t\t tail\n\t\t\t\t\t\t arg-num2\n\t\t\t\t\t\t (fx+ arg-num2 1))))\n\t\t  (macro-if-checks\n\t\t   (if (fixnum? result)\n\t\t       result\n\t\t       (append-2-non-null x result arg-num1))\n\t\t   (append-2-non-null x result arg-num1))))))))\n\n  (define (append-2-non-null x y arg-num)\n    ;; x!=(), returns fixnum on error\n    (if (pair? x)\n\t(let ((result (cons (car x) '())))\n\t  (let loop ((last result) (tail (cdr x)))\n\t    (macro-force-vars (tail)\n\t      (if (pair? tail)\n\t\t  (let ((next (cons (car tail) '())))\n\t\t    (set-cdr! last next)\n\t\t    (loop next (cdr tail)))\n\t\t  (begin\n\t\t    (set-cdr! last y)\n\t\t    (macro-if-checks\n\t\t     (if (null? tail)\n\t\t\t result\n\t\t\t arg-num) ;; error: list expected\n\t\t     result))))))\n\t(macro-if-checks\n\t arg-num ;; error: list expected\n\t y)))\n\n  (define (list-expected-check result)\n    (macro-if-checks\n     (if (fixnum? result)\n\t (macro-fail-check-list result (append lst1 lst2 . others))\n\t result)\n     result))\n\n  (cond ((eq? lst2 (macro-absent-obj))\n\t (if (eq? lst1 (macro-absent-obj))\n\t     '()\n\t     lst1))\n\t((null? others)\n\t (macro-force-vars (lst1)\n\t   (if (null? lst1)\n\t       lst2\n\t       (list-expected-check (append-2-non-null lst1 lst2 1)))))\n\t(else\n\t (append-multiple lst1 (cons lst2 others) 1))))\n\n\n;;;============================================================================\n;;; Vectors\n;;;;----------------------------------------------------------------------------\n;;;----------------------------------------------------------------------------\n\n(##include \"~~/lib/gambit/vector/vector#.scm\")\n(define-prim-vector-procedures\n  vector\n  0\n  macro-no-force\n  macro-no-check\n  macro-no-check\n  #f\n  #f\n  define-map-and-for-each\n  ##equal?)\n\n;;;============================================================================\n;;; Nums\n;;;;----------------------------------------------------------------------------\n;;;----------------------------------------------------------------------------\n\n\n(define-prim (##+2 x y)\n  (##inline-host-expression\n   \"((x, y) => { return x + y; })((@1@), (@2@));\" (js#scm->js x) (js#scm->js y)))\n\n (define-prim-nary (##+ x y)\n  0\n  x\n  (##+2 x y)\n  macro-no-force\n  macro-no-check)\n\n(define-prim-nary (+ x y)\n  0\n  (if (##number? x) x '(1))\n  (##+2 x y)\n  macro-force-vars\n  macro-no-check\n  (##pair? ##fail-check-number)\n  (##not ##raise-fixnum-overflow-exception))\n\n\n(define-prim (##/2 x y)\n  (##inline-host-expression\n   \"((x, y) => { return x / y; })((@1@), (@2@));\" (js#scm->js x) (js#scm->js y)))\n\n(define-prim-nary (##/ x y)\n  ()\n  (##inverse x)\n  (##/2 x y)\n  macro-no-force\n  macro-no-check)\n\n(define-prim-nary (/ x y)\n  ()\n  (##inverse x)\n  (##/2 x y)\n  macro-force-vars\n  macro-no-check\n  (##pair? ##fail-check-number)\n  (##not ##raise-divide-by-zero-exception))\n\n;;;============================================================================\n;;;============================================================================\n;;; strings\n(##include \"~~lib/gambit/string/string#.scm\")\n\n(define-prim-vector-procedures\n  string\n  #\\nul\n  macro-force-vars\n  macro-check-char\n  macro-check-char-list\n  macro-test-char\n  ##fail-check-char\n  define-map-and-for-each\n  ##char=?)\n\n(define-prim-nary-bool (##string=? str1 str2)\n  #t\n  #t\n  (##string-equal? str1 str2)\n  macro-no-force\n  macro-no-check)\n\n(define-prim-nary-bool (string=? str1 str2)\n  #t\n  #t\n  (##string-equal? str1 str2)\n  macro-force-vars\n  macro-check-string)\n\n;;;===========================================\n\n;;; threads\n\n(##include \"~~/lib/gambit/prim/thread#.scm\")\n(##include \"~~/lib/gambit/prim/thread-gambit#.scm\")\n\n(define (##enable-interrupts!) #f)\n(macro-case-target\n\n ((js)\n  (##inline-host-declaration \"\n\nif ((function () { return this !== this.window; })()) { // nodejs?\n\n  os = require('os');\n  fs = require('fs');\n  vm = require('vm');\n  process = require('process');\n  child_process = require('child_process')\n\n  g_os_encode_error = function (exn) {\n    switch (exn.code) {\n      case 'EPERM':  return -1;\n      case 'ENOENT': return -2;\n      case 'EINTR':  return -4;\n      case 'EIO':    return -5;\n      case 'EBADF':  return -9;\n      case 'EACCES': return -13;\n      case 'EEXIST': return -17;\n      case 'EAGAIN': return -35;\n    }\n    return -8888;\n  };\n\n  g_os_decode_error = function (code) {\n    switch (code) {\n      case -1:  return 'EPERM (Operation not permitted)';\n      case -2:  return 'ENOENT (No such file or directory)';\n      case -4:  return 'EINTR (Interrupted system call)';\n      case -5:  return 'EIO (Input/output error)';\n      case -9:  return 'EBADF (Bad file descriptor)';\n      case -13: return 'EACCES (Permission denied)';\n      case -17: return 'EEXIST (File exists)';\n      case -35: return 'EAGAIN (Resource temporarily unavailable)';\n    }\n    return 'E??? (unknown error)';\n  };\n}\n\ng_current_time = function () {\n  return new Date().getTime() / 1000;\n};\n\ng_start_time = g_current_time();\n\ng_set_process_times = function (vect) {\n  var elapsed = g_current_time() - g_start_time;\n  vect.elems[0] = elapsed;\n  vect.elems[1] = 0.0;\n  vect.elems[2] = elapsed;\n  return vect;\n};\n\nG_Device = function (fd) {\n  this.fd = fd;\n  this.rbuf = new Uint8Array(1024);\n  this.rlo = 1;\n  this.rhi = 1; // 0 would mean EOF\n};\n\ng_os_debug = false;\n\n\"))\n\n ((python)\n  (##inline-host-declaration \"\n\nimport os\nimport pwd\nimport grp\nimport stat\nimport time\nimport errno\nimport getpass\nimport functools\n\ndef g_os_encode_error(exn):\n    e = exn.errno\n    if e == errno.EPERM:\n      return -1\n    elif e == errno.ENOENT:\n\treturn -2\n    elif e == errno.EINTR:\n\treturn -5\n    elif e == errno.EIO:\n\treturn -9\n    elif e == errno.EBADF:\n\treturn -13\n    elif e == errno.EACCES:\n\treturn -17\n    elif e == errno.EEXIST:\n\treturn -35\n    else:\n\treturn -8888\n\ndef g_os_decode_error(code):\n    if code == -1:\n\treturn 'EPERM (Operation not permitted)'\n    elif code == -2:\n\treturn 'ENOENT (No such file or directory)'\n    elif code == -4:\n\treturn 'EINTR (Interrupted system call)'\n    elif code == -5:\n\treturn 'EIO (Input/output error)'\n    elif code == -9:\n\treturn 'EBADF (Bad file descriptor)'\n    elif code == -13:\n\treturn 'EACCES (Permission denied)'\n    elif code == -17:\n\treturn 'EEXIST (File exists)'\n    elif code == -35:\n\treturn 'EAGAIN (Resource temporarily unavailable)'\n    else:\n\treturn 'E??? (unknown error)'\n\ndef g_current_time():\n    return time.time()\n\ng_start_time = g_current_time()\n\ndef g_set_process_times(vect):\n    elapsed = g_current_time() - g_start_time\n    vect.elems[0] = elapsed\n    vect.elems[1] = 0.0\n    vect.elems[2] = elapsed\n    return vect\n\nclass G_Device:\n\n    def __init__(self, fd):\n\tself.fd = fd\n\n\ng_os_debug = False\n\n\"))\n\n (else))\n(define-prim (##os-condvar-select! devices timeout)\n  (##first-argument #f ##feature-port-fields)\n  (macro-case-target\n\n   ((js)\n    (##inline-host-declaration \"\n\ng_os_condvar_select_should_sleep = true;\n\ng_os_condvar_select = function (devices_scm, timeout_scm) {\n\n  if (g_os_debug)\n    console.log('g_os_condvar_select(devices, timeout)  ***not fully implemented***');\n\n  var at_least_1_device = (devices_scm !== false &&\n\t\t\t   devices_scm !== devices_scm.slots[g_BTQ_DEQ_NEXT]);\n\n  var timeout_ms;\n\n  if (timeout_scm === false)\n    timeout_ms = 0;\n  else if (timeout_scm === true)\n    timeout_ms = 999999;\n  else\n    timeout_ms = (timeout_scm.elems[0]-g_current_time()) * 1000;\n\n  if (!at_least_1_device || g_os_condvar_select_should_sleep) {\n\n    if (at_least_1_device)\n      timeout_ms = 10; // give browser time to refresh\n\n    g_os_condvar_select_should_sleep = false;\n\n    var ra = g_r0;\n    g_r0 = null; // exit trampoline\n\n    setTimeout(function () { g_trampoline(ra); }, // resume execution\n\t       Math.max(0, timeout_ms))\n\n    return g_host2scm(0);\n  }\n\n  g_os_condvar_select_should_sleep = true;\n\n  if (devices_scm !== false) {\n\n    var condvar_scm = devices_scm.slots[g_BTQ_DEQ_NEXT];\n\n    while (condvar_scm !== devices_scm) {\n      var owner = condvar_scm.slots[g_BTQ_OWNER];\n      var dev = g_foreign2host(condvar_scm.slots[g_CONDVAR_NAME]);\n      if (dev.fd === -4) // console?\n\tcondvar_scm.slots[g_BTQ_OWNER] = owner | 1; // mark as 'ready'\n      else\n\tcondvar_scm.slots[g_BTQ_OWNER] = owner & ~1; // mark as 'not ready'\n      condvar_scm = condvar_scm.slots[g_BTQ_DEQ_NEXT];\n    }\n\n  }\n\n  return g_host2scm(0);\n};\n\n\")\n    (##inline-host-expression\n     \"g_os_condvar_select(@1@,@2@)\"\n     devices\n     timeout))\n\n   ((python)\n    (##inline-host-declaration \"\n\ndef g_os_condvar_select(devices_scm, timeout_scm):\n\n    if g_os_debug:\n\tprint('g_os_condvar_select(devices, timeout)  ***not fully implemented***')\n\n    return g_host2scm(0)  # no error\n\n\")\n    (##inline-host-expression\n     \"g_os_condvar_select(@1@,@2@)\"\n     devices\n     timeout))\n\n   (else\n    (println \"unimplemented ##os-condvar-select! called\")\n    -5555)))\n;;;----------------------------------------------------------------------------\n\n;;; Implementation of blocked thread queues and timeout queues.\n\n(implement-btq) ;; defines ##btq-insert!, etc\n(implement-toq) ;; defines ##toq-insert!, etc\n\n;;;----------------------------------------------------------------------------\n\n;;; Inlined thread primitives.\n\n(define-prim (##current-thread))\n(define-prim (##current-processor))\n(define-prim (##current-processor-id))\n(define-prim (##processor id))\n(define-prim (##current-vm))\n\n(define-prim (##primitive-lock! btq i j))\n(define-prim (##primitive-trylock! btq i j))\n(define-prim (##primitive-unlock! btq i j))\n\n(define-prim (##object-before? x y))\n;;;----------------------------------------------------------------------------\n\n;; The procedure current-processor returns the processor executing the\n;; current thread.\n\n(define-prim (current-processor)\n\n  (##declare (not interrupts-enabled))\n\n  (macro-current-processor))\n\n;;;----------------------------------------------------------------------------\n\n;; The procedure processor? returns #t when the parameter is a processor\n;; and #f otherwise.\n\n(define-prim (processor? obj)\n\n  (##declare (not interrupts-enabled))\n\n  (macro-force-vars (obj)\n    (macro-processor? obj)))\n\n;;;----------------------------------------------------------------------------\n\n;; The procedure processor? returns #t when the parameter is a processor\n;; and #f otherwise.\n\n(define-prim (processor-id processor)\n\n  (##declare (not interrupts-enabled))\n\n  (macro-force-vars (processor)\n    (macro-check-processor processor 1 (processor-id processor)\n      (macro-processor-id processor))))\n\n;;;----------------------------------------------------------------------------\n;;;----------------------------------------------------------------------------\n\n;; The procedure current-thread returns the thread currently executing\n;; on the current processor.\n\n(define-prim (current-thread)\n\n  (##declare (not interrupts-enabled))\n\n  (macro-current-thread))\n\n;;;----------------------------------------------------------------------------\n\n;; The procedure thread? returns #t when the parameter is a thread\n;; and #f otherwise.\n\n(define-prim (thread? obj)\n\n  (##declare (not interrupts-enabled))\n\n  (macro-force-vars (obj)\n    (macro-thread? obj)))\n\n;;;----------------------------------------------------------------------------\n(##define-macro (macro-parameter-descr param)\n  `(##closure-ref ,param 1))\n\n(define-prim (##make-tgroup name parent)\n  (##declare (not interrupts-enabled))\n  (macro-make-tgroup name parent))\n\n(define-prim (##env-lookup env param)\n  (##declare (not interrupts-enabled))\n  (let ((hash-param\n\t (macro-parameter-descr-hash\n\t  (macro-parameter-descr param))))\n\n    (define (lookup env)\n      (if (##null? env)\n\t#f\n\t(let* ((x\n\t\t(macro-env-param-val env))\n\t       (param-x\n\t\t(##car x))\n\t       (hash-param-x\n\t\t(macro-parameter-descr-hash\n\t\t (macro-parameter-descr param-x))))\n\t  (cond ((##fx< hash-param hash-param-x)\n\t\t (lookup (macro-env-left env)))\n\t\t((or (##fx< hash-param-x hash-param)\n\t\t     (##not (##eq? param-x param)))\n\t\t (lookup (macro-env-right env)))\n\t\t(else\n\t\t x)))))\n\n    (lookup env)))\n\n;;;----------------------------------------------------------------------------\n\n(define-prim (##dynamic-env-bind denv thunk)\n  (##declare (not interrupts-enabled))\n  (let* ((current-thread\n\t  (macro-current-thread))\n\t (old-denv\n\t  (macro-thread-denv current-thread)))\n    (macro-thread-denv-set! current-thread denv)\n    (let ((x (macro-env-param-val (macro-denv-local denv))))\n      (macro-thread-denv-cache1-set! current-thread x)\n      (macro-thread-denv-cache2-set! current-thread x)\n      (macro-thread-denv-cache3-set! current-thread x)\n      (let* ((results ; may get bound to a multiple-values object\n\t      (thunk))\n\t     (current-thread\n\t      (macro-current-thread)))\n\t(macro-thread-denv-set! current-thread old-denv)\n\t(let ((x (macro-env-param-val (macro-denv-local old-denv))))\n\t  (macro-thread-denv-cache1-set! current-thread x)\n\t  (macro-thread-denv-cache2-set! current-thread x)\n\t  (macro-thread-denv-cache3-set! current-thread x)\n\t  results)))))\n\n;;;----------------------------------------------------------------------------\n\n\n\n\n\n(define-prim (##dynamic-ref param)\n  (##declare (not interrupts-enabled))\n;;  (##inline-host-statement \"console.log('thread', @1@, @2@, @3@)\" param 1 1)\n  (cond ((##eq? param ##current-exception-handler)\n\t (macro-current-exception-handler))\n\t((##eq? param ##current-input-port)\n\t (macro-current-input-port))\n\t((##eq? param ##current-output-port)\n\t (macro-current-output-port))\n\t(else\n #; (##inline-host-statement \"console.log(' here now thread', @1@, @2@, @3@)\"\n\t\t\t   param (macro-current-thread) (macro-thread-denv-cache1 (current-thread)))\n\t (let* ((current-thread\n\t\t (macro-current-thread))\n\t\t(c1\n\t\t (macro-thread-denv-cache1 current-thread)))\n\t   (if (##eq? param (##car c1))\n\t     (##cdr c1)\n\t     (let ((c2 (macro-thread-denv-cache2 current-thread)))\n\t       (if (##eq? param (##car c2))\n\t\t (begin\n\t\t   (macro-thread-denv-cache2-set! current-thread c1)\n\t\t   (macro-thread-denv-cache1-set! current-thread c2)\n\t\t   (##cdr c2))\n\t\t (let ((c3 (macro-thread-denv-cache3 current-thread)))\n\t\t   (if (##eq? param (##car c3))\n\t\t     (begin\n\t\t       (macro-thread-denv-cache3-set! current-thread c2)\n\t\t       (macro-thread-denv-cache2-set! current-thread c1)\n\t\t       (macro-thread-denv-cache1-set! current-thread c3)\n\t\t       (##cdr c3))\n\t\t     (let* ((denv\n\t\t\t     (macro-thread-denv current-thread))\n\t\t\t    (x\n\t\t\t     (##env-lookup (macro-denv-local denv) param)))\n\t\t       (if x\n\t\t\t (begin\n\t\t\t   (macro-thread-denv-cache3-set!\n\t\t\t    current-thread\n\t\t\t    (macro-thread-denv-cache2 current-thread))\n\t\t\t   (macro-thread-denv-cache2-set!\n\t\t\t    current-thread\n\t\t\t    (macro-thread-denv-cache1 current-thread))\n\t\t\t   (macro-thread-denv-cache1-set!\n\t\t\t    current-thread\n\t\t\t    x)\n\t\t\t   (##cdr x))\n\t\t\t (macro-parameter-descr-value\n\t\t\t  (macro-parameter-descr param)))))))))))))\n\n(define-prim (##dynamic-let param val thunk)\n  (##declare (not interrupts-enabled))\n  (cond ((##eq? param ##current-exception-handler)\n\t (macro-dynamic-bind exception-handler\n\t  val\n\t  thunk))\n\t((##eq? param ##current-input-port)\n\t (macro-dynamic-bind input-port\n\t  val\n\t  thunk))\n\t((##eq? param ##current-output-port)\n\t (macro-dynamic-bind output-port\n\t  val\n\t  thunk))\n\t(else\n\t (let* ((param-val\n\t\t (##cons param val))\n\t\t(denv\n\t\t (macro-thread-denv (macro-current-thread)))\n\t\t(new-local-denv\n\t\t (##env-insert (macro-denv-local denv) param-val)))\n\t   (##dynamic-env-bind\n\t    (macro-make-denv\n\t     new-local-denv\n\t     (macro-denv-dynwind denv)\n\t     (macro-denv-interrupt-mask denv)\n\t     (macro-denv-debugging-settings denv)\n\t     (macro-denv-exception-handler denv)\n\t     (macro-denv-input-port denv)\n\t     (macro-denv-output-port denv)\n\t     (macro-denv-repl-context denv))\n\t    thunk)))))\n(define-prim (##dynamic-set! param val)\n  (##declare (not interrupts-enabled))\n  (cond ((##eq? param ##current-exception-handler)\n\t (macro-current-exception-handler-set! val)\n\t (##void))\n\t((##eq? param ##current-input-port)\n\t (macro-current-input-port-set! val)\n\t (##void))\n\t((##eq? param ##current-output-port)\n\t (macro-current-output-port-set! val)\n\t (##void))\n\t(else\n\t (let* ((current-thread\n\t\t (macro-current-thread))\n\t\t(c1\n\t\t (macro-thread-denv-cache1 current-thread)))\n\t   (if (##eq? param (##car c1))\n\t     (begin\n\t       (##set-cdr! c1 val)\n\t       (##void))\n\t     (let ((c2 (macro-thread-denv-cache2 current-thread)))\n\t       (if (##eq? param (##car c2))\n\t\t (begin\n\t\t   (macro-thread-denv-cache2-set! current-thread c1)\n\t\t   (macro-thread-denv-cache1-set! current-thread c2)\n\t\t   (##set-cdr! c2 val)\n\t\t   (##void))\n\t\t (let ((c3 (macro-thread-denv-cache3 current-thread)))\n\t\t   (if (##eq? param (##car c3))\n\t\t     (begin\n\t\t       (macro-thread-denv-cache3-set! current-thread c2)\n\t\t       (macro-thread-denv-cache2-set! current-thread c1)\n\t\t       (macro-thread-denv-cache1-set! current-thread c3)\n\t\t       (##set-cdr! c3 val)\n\t\t       (##void))\n\t\t     (let* ((denv\n\t\t\t     (macro-thread-denv current-thread))\n\t\t\t    (x\n\t\t\t     (##env-lookup (macro-denv-local denv) param)))\n\t\t       (if x\n\t\t\t (begin\n\t\t\t   (macro-thread-denv-cache3-set!\n\t\t\t    current-thread\n\t\t\t    (macro-thread-denv-cache2 current-thread))\n\t\t\t   (macro-thread-denv-cache2-set!\n\t\t\t    current-thread\n\t\t\t    (macro-thread-denv-cache1 current-thread))\n\t\t\t   (macro-thread-denv-cache1-set!\n\t\t\t    current-thread\n\t\t\t    x)\n\t\t\t   (##set-cdr! x val)\n\t\t\t   (##void))\n\t\t\t (begin\n\t\t\t   (macro-parameter-descr-value-set!\n\t\t\t    (macro-parameter-descr param)\n\t\t\t    val)\n\t\t\t   (##void)))))))))))))\n(define-prim (##env-insert env param-val)\n  (let* ((param\n\t  (##car param-val))\n\t (hash-param\n\t  (macro-parameter-descr-hash\n\t   (macro-parameter-descr param))))\n\n    (define (insert env)\n      (if (##null? env)\n\t(macro-make-env\n\t param-val\n\t '()\n\t '())\n\t(let* ((x\n\t\t(macro-env-param-val env))\n\t       (param-x\n\t\t(##car x))\n\t       (hash-param-x\n\t\t(macro-parameter-descr-hash\n\t\t (macro-parameter-descr param-x))))\n\t  (cond ((##fx< hash-param hash-param-x)\n\t\t (macro-make-env\n\t\t  x\n\t\t  (insert (macro-env-left env))\n\t\t  (macro-env-right env)))\n\t\t((or (##fx< hash-param-x hash-param)\n\t\t     (##not (##eq? param-x param)))\n\t\t (macro-make-env\n\t\t  x\n\t\t  (macro-env-left env)\n\t\t  (insert (macro-env-right env))))\n\t\t(else\n\t\t (macro-make-env\n\t\t  param-val\n\t\t  (macro-env-left env)\n\t\t  (macro-env-right env)))))))\n\n    (insert env)))\n\n(define-prim (##make-root-thread\n\t      thunk\n\t      name\n\t      tgroup\n\t      input-port\n\t      output-port)\n\n  (##declare (not interrupts-enabled))\n\n  (let* ((interrupt-mask\n\t  0)\n\t (debugging-settings\n\t  0)\n\t (local-binding\n\t  (##cons ##current-directory\n\t\t  (macro-parameter-descr-value\n\t\t   (macro-parameter-descr ##current-directory)))))\n\n    ;; these macros are defined to prevent the normal thread\n    ;; inheritance mechanism when a root thread is created\n\n    (##define-macro (macro-current-thread)\n      `#f)\n\n    (##define-macro (macro-thread-denv thread)\n      `#f)\n\n    (##define-macro (macro-denv-local denv)\n      `(macro-make-env local-binding '() '()))\n\n    (##define-macro (macro-denv-dynwind denv)\n      `##initial-dynwind)\n\n    (##define-macro (macro-denv-interrupt-mask denv)\n      `interrupt-mask)\n\n    (##define-macro (macro-denv-debugging-settings denv)\n      `debugging-settings)\n\n    (##define-macro (macro-denv-input-port denv)\n      `(##cons ##current-input-port input-port))\n\n    (##define-macro (macro-denv-output-port denv)\n      `(##cons ##current-output-port output-port))\n\n    (##define-macro (macro-thread-denv-cache1 thread)\n      `local-binding)\n\n    (##define-macro (macro-thread-denv-cache2 thread)\n      `local-binding)\n\n    (##define-macro (macro-thread-denv-cache3 thread)\n      `local-binding)\n\n    (##define-macro (macro-thread-floats thread)\n      `#f)\n\n    (##define-macro (macro-base-priority floats)\n      `(macro-thread-root-base-priority))\n\n    (##define-macro (macro-quantum floats)\n      `(macro-thread-root-quantum))\n\n    (##define-macro (macro-priority-boost floats)\n      `(macro-thread-root-priority-boost))\n\n    ;; create root thread\n\n    (macro-make-thread thunk name tgroup)))\n\n(define-prim (make-root-thread\n\t      thunk\n\t      #!optional\n\t      (n (macro-absent-obj))\n\t      (tg (macro-absent-obj))\n\t      (ip (macro-absent-obj))\n\t      (op (macro-absent-obj)))\n  (macro-force-vars (thunk n tg ip op)\n    (let* ((name\n\t    (if (##eq? n (macro-absent-obj))\n\t      (##void)\n\t      n))\n\t   (tgroup\n\t    (if (##eq? tg (macro-absent-obj))\n\t      (macro-thread-tgroup (macro-current-thread))\n\t      tg))\n\t   (input-port\n\t    (if (##eq? ip (macro-absent-obj))\n\t      ##stdin-port\n\t      ip))\n\t   (output-port\n\t    (if (##eq? op (macro-absent-obj))\n\t      ##stdout-port\n\t      op)))\n      (macro-check-procedure thunk 1 (make-root-thread thunk n tg ip op)\n\t(macro-check-tgroup tgroup 3 (make-root-thread thunk n tg ip op)\n\t  (macro-check-input-port input-port 4 (make-root-thread thunk n tg ip op)\n\t    (macro-check-output-port output-port 5 (make-root-thread thunk n tg ip op)\n\t      (##make-root-thread thunk name tgroup input-port output-port))))))))\n\n(define (##startup-processor!)\n\n  (declare (not interrupts-enabled))\n\n  (macro-processor-init! (##current-processor) (##current-processor-id))\n  (##primitive-unlock! (##current-processor) 1 9)\n\n  (let* ((tgroup\n\t  (##make-tgroup 'local #f))\n\t (input-port\n\t  ##stdin-port)\n\t (output-port\n\t  ##stdout-port)\n\t (thread\n\t  (##make-root-thread\n\t   #f\n\t   'local\n\t   tgroup\n\t   input-port\n\t   output-port)))\n\n    (macro-processor-current-thread-set!\n     (macro-current-processor)\n     thread)\n\n    (##btq-insert! (macro-current-processor) thread)\n    )\n\n  (##enable-interrupts!)\n\n  (let loop ()\n    (declare (interrupts-enabled))\n    (##os-condvar-select! #f #t) ;; wait for interrupt\n    (loop)))\n\n;;; ====================\n(define-prim (##parameter? obj)\n  (##declare (not interrupts-enabled))\n  (and (##procedure? obj)\n       (##closure? obj)\n       (##eq? (##closure-code obj)\n\t      (##closure-code ##current-exception-handler))))\n\n(##define-macro (macro-parameter-descr param)\n  `(##closure-ref ,param 1))\n\n(define-prim (##parameterize1 param val thunk)\n  (##declare (not interrupts-enabled))\n  (macro-check-procedure param 1 (##parameterize1 param val thunk)\n    (macro-check-procedure thunk 3 (##parameterize1 param val thunk)\n      (if (##parameter? param)\n\t(##dynamic-let\n\t param\n\t ((macro-parameter-descr-filter (macro-parameter-descr param)) val)\n\t thunk)\n\t(let ((save (param)))\n\t  (##dynamic-wind\n\t   (lambda () ;; before\n\t     (param val))\n\t   thunk\n\t   (lambda () ;; after\n\t     (param save))))))))\n\n(##include \"~~lib/gambit/parameter/parameter#.scm\")\n(define-prim (##partial-bit-reverse i)\n\n  (##define-macro (bit n)\n    `(##fxarithmetic-shift-left\n      (##fxand i ,(expt 2 n)) ,(- 28 (* 2 n))))\n\n  (##fx+\n   (bit 0)\n   (##fx+\n    (bit 1)\n    (##fx+\n     (bit 2)\n     (##fx+\n      (bit 3)\n      (##fx+\n       (bit 4)\n       (##fx+\n\t(bit 5)\n\t(##fx+\n\t (bit 6)\n\t (##fx+\n\t  (bit 7)\n\t  (##fx+\n\t   (bit 8)\n\t   (##fx+\n\t    (bit 9)\n\t    (##fx+\n\t     (bit 10)\n\t     (##fx+\n\t      (bit 11)\n\t      (##fx+\n\t       (bit 12)\n\t       (##fx+\n\t\t(bit 13)\n\t\t(bit 14))))))))))))))))\n\n;;; _t-univ-4\n;;;\n;;;\n\n\n\n;;;----------------------------------------------------------------------------\n;;;\n;;;\n\n\n(define ##parameter-counter 0)\n\n(define-prim (##make-parameter\n\t      init\n\t      #!optional\n\t      (f (macro-absent-obj)))\n  (let ((filter\n\t (if (##eq? f (macro-absent-obj))\n\t   (lambda (x) x)\n\t   f)))\n    (macro-check-procedure filter 2 (make-parameter init f)\n      (let* ((val\n\t      (filter init))\n\t     (new-count\n\t      (+ ##parameter-counter 1)))\n\t;; Note: it is unimportant if the increment of\n\t;; ##parameter-counter is not atomic; it simply means a\n\t;; possible close repetition of the same hash code\n\t(set! ##parameter-counter new-count)\n\t(let ((descr\n\t       (macro-make-parameter-descr\n\t\tval\n\t\t(##partial-bit-reverse new-count)\n\t\tfilter)))\n\t  (letrec ((param\n\t\t    (lambda (#!optional (new-val (macro-absent-obj)))\n\t\t      (if (##eq? new-val (macro-absent-obj))\n\t\t\t(##dynamic-ref param)\n\t\t\t(##dynamic-set!\n\t\t\t param\n\t\t\t ((macro-parameter-descr-filter descr) new-val))))))\n\t    param))))))\n\n(define-prim (make-parameter init #!optional (f (macro-absent-obj)))\n  (macro-force-vars (f)\n    (##make-parameter init f)))\n\n;;;============================================================================\n\n(define (##os-path-normalize-directory path)\n  (##declare (not interrupts-enabled))\n  (macro-case-target\n\n   ((js)\n    (##inline-host-declaration \"\n\ng_os_path_normalize_directory = function (path) {\n  if ((function () { return this !== this.window; })()) { // nodejs?\n    var old = process.cwd();\n    var dir;\n    if (path === false) {\n      dir = old;\n    } else {\n      try {\n\tprocess.chdir(path);\n      } catch (exn) {\n\tif (exn instanceof Error && exn.hasOwnProperty('code')) {\n\t  return g_host2scm(g_os_encode_error(exn));\n\t} else {\n\t  throw exn;\n\t}\n      }\n      dir = process.cwd();\n      process.chdir(old);\n    }\n    if (dir[dir.length-1] === '/' || dir[dir.length-1] === '\\\\\\\\') {\n      return g_host2scm(dir);\n    } else if (dir[0] === '/') {\n      return g_host2scm(dir + '/')\n    } else {\n      return g_host2scm(dir + '\\\\\\\\')\n    }\n  } else {\n    var loc = window.location.href;\n    var root = '/' + loc.slice(0, 1+loc.lastIndexOf('/'));\n    if (path === false) {\n      return g_host2scm(root);\n    } else {\n      return g_host2scm(root + path.slice((path[0] === '/') ? 1 : 0));\n    }\n  }\n};\n\n\")\n    (##inline-host-expression \"g_os_path_normalize_directory(g_scm2host(@1@))\" path))\n\n   ((python)\n    (##inline-host-declaration \"\n\ndef g_os_path_normalize_directory(path):\n    old = os.getcwd()\n    if path is False:\n\tdir = old\n    else:\n\ttry:\n\t    os.chdir(path)\n\texcept OSError as exn:\n\t    return g_host2scm(g_os_encode_error(exn))\n\tdir = os.getcwd()\n\tos.chdir(old)\n    if dir[-1] == '/' or dir[-1] == '\\\\\\\\':\n\treturn g_host2scm(dir)\n    elif dir[0] == '/':\n\treturn g_host2scm(dir + '/')\n    else:\n\treturn g_host2scm(dir + '\\\\\\\\')\n\n\")\n    (##inline-host-expression \"g_os_path_normalize_directory(g_scm2host(@1@))\" path))\n\n   (else\n    (println \"unimplemented ##os-path-normalize-directory called with path=\")\n    (println path)\n    \"/\")))\n\n(define ##initial-current-directory\n  (let ((current-dir\n\t (##os-path-normalize-directory #f)))\n    (if (##fixnum? current-dir)\n\t(##exit-with-err-code current-dir)\n\tcurrent-dir)))\n\n(define-prim (##path-normalize-directory-existing path)\n  (let ((normalized-dir\n\t (##os-path-normalize-directory (##path-expand path))))\n    (if (##fixnum? normalized-dir)\n\t(##raise-os-exception #f normalized-dir ##current-directory path)\n\tnormalized-dir)))\n\n(define-prim (##current-directory-filter val)\n  (if (##eq? val (macro-absent-obj))\n      ##initial-current-directory\n      (macro-check-string val 1 (##current-directory val)\n\t(##path-normalize-directory-existing val))))\n(define ##current-directory\n  (##make-parameter\n   (macro-absent-obj)\n   ##current-directory-filter))\n\n(define current-directory\n  ##current-directory)\n\n(define ##current-exception-handler\n  (##make-parameter\n   (lambda (exc)\n     (##thread-end-with-uncaught-exception! exc))\n   (lambda (val)\n     (macro-check-procedure val 1 (##current-exception-handler val)\n       val))))\n\n(define current-exception-handler\n  ##current-exception-handler)\n\n#;(define ##current-output-port\n  (##make-parameter\n   ##stdout-port\n   (lambda (val)\n     (macro-check-output-port val 1 (##current-output-port val)\n       val))))\n\n#;(define current-output-port\n  ##current-output-port)\n\n(##startup-processor!)\n","post-blank":1,"post-affiliated":69554},contents:[]},{$$data_type:"org-node",type:"paragraph",ref:"org00bde19",properties:{"post-blank":1,"post-affiliated":121902},contents:["Now our Gerbil coded Gambit runtime, where everything starts with ##.\n"]},{$$data_type:"org-node",type:"src-block",ref:"org07cff12",properties:{language:"scheme",switches:null,parameters:null,"number-lines":null,"preserve-indent":!1,"retain-labels":!0,"use-labels":!0,"label-fmt":null,value:"namespace: \"#\"\n\n(define (apply proc arg1 . rest)\n  (declare (not inline))\n  (if (##pair? rest)\n    (let loop ((prev arg1) (lst rest))\n      (let ((temp (##car lst)))\n\t(##set-car! lst prev)\n\t(let ((tail (##cdr lst)))\n\t  (if (##pair? tail)\n\t    (loop temp tail)\n\t    (begin\n\t      (##set-cdr! lst temp)\n\t      (##apply proc rest))))))\n    (##apply proc arg1)))\n\n(def (raise-wrong-number-of-arguments-exception proc args)\n  (##inline-host-statement\n   \"((proc, args) => {\n     var name = (proc._name === undefined) ? proc : proc._name.name;\n     console.error('too many args for', name);\n      throw { name: 'wrong-number-of-arguments',\n\t      message: name + ' called with foo!',\n\t      name: name,\n\t      proc: proc, args: args }\n   })((@1@), (@2@));\"\n   proc args))\n\n(def (raise-type-exception n expected got fn  . args)\n  (##inline-host-statement\n   \"console.error('type exception',\n\t\t   (() => { fn = (@2@);\n\t\t      if (fn !== undefined) { return fn._name.name };\n\t\t    return fn; })(), 'expected', (@1@).name, 'got',  (@3@), (@4@))\"\n    expected (car fn) got (cdr fn)))\n\n(def (fail-check-procedure proc . args)\n  (##inline-host-statement\n   \"console.error('fail check procedure', (@1@), (@2@))\"\n   proc args))\n\n(def (list->vector lst)\n  (def n (##length lst))\n  (def vec (##make-vector n))\n  (let loop ((i 0) (l lst))\n    (if (not (null? l))\n      (begin\n\t(##vector-set! vec i (##car l))\n\t(loop (+ i 1) (##cdr l)))))\n  vec)\n(def (reverse lst)\n  (let loop ((x lst) (result '()))\n    (if (pair? x)\n\t(loop (cdr x) (cons (car x) result))\n\tresult)))\n\n(def (length lst)\n  (if (null? lst) 0 (+ 1 (length (##cdr lst)))))\n\n\n\n(def (vector->list vect)\n  (let loop ((lst '()) (i (- (##vector-length vect) 1)))\n    (if (< i 0)\n      lst\n      (loop (##cons (##vector-ref vect i) lst) (- i 1)))))\n\n(def (vector-append v . vs)\n  (def vvs (list->vector vs))\n  (##inline-host-expression \"((v, vs) => { return v.concat.apply(v, vs); })((@1@), (@2@));\" v vvs))\n\n(def (number? n?)\n  (##inline-host-expression\n   \"(() => {\n      n = g_scm2host(@1@);\n      is_n = typeof n === 'number';\n      return g_host2scm(is_n);\n    })();\" n?))\n\n(def (number->string n)\n  (##inline-host-expression \"(() => { n = g_scm2host(@1@) ; return g_host2scm(n.toString()); })();\" n))\n\n(def (error thing)\n  (if (##string? thing)\n    (set! thing (##inline-host-expression \"g_scm2host(@1@)\" thing)))\n  (##inline-host-statement \"_e = (@1@);\n   if (_e instanceof Error) { throw _e } else { throw new Error(_e) };\" thing))\n\n(def (string-append . strs)\n  (def (strapp s1 s2)\n    (let* ((l1 (##string-length s1))\n\t   (l2 (##string-length s2))\n\t   (l3 (+ l1 l2))\n\t   (s3 (##make-string l3)))\n      (let lp ((n 0))\n\t(if (< n l1)\n\t  (##string-set! s3 n (##string-ref s1 n))\n\t  (if (>= n l1)\n\t    (##string-set! s3 n (##string-ref s2 (- n l1)))))\n      (if (< n l3) (lp (+ 1 n))))\n\t\t\t\t\t;(##apply string-append s3 rst)\n      s3))\n\n  (def str (car strs))\n\n  (let applp ((lst (cdr strs)))\n    (if (null? lst) str\n\t(begin (set! str (strapp str (car lst)))\n\t       (applp (cdr lst))))))\n\n","post-blank":1,"post-affiliated":121973},contents:[]},{$$data_type:"org-node",type:"paragraph",ref:"orgd0a6b5d",properties:{"post-blank":1,"post-affiliated":125034},contents:["And now a runtime coded in gerbil for gerbil after loading gerbil things.\n"]},{$$data_type:"org-node",type:"src-block",ref:"org668300a",properties:{language:"scheme",switches:null,parameters:null,"number-lines":null,"preserve-indent":!1,"retain-labels":!0,"use-labels":!0,"label-fmt":null,value:'namespace: "#"\n#;(def (##member obj lst . args)\n  ;; ~.args~ should really be (compare ##equal?) but we do not yet have such arg\n  ;; dispatch things defined it seems.\n  (def compare (if (null? args) ##equal (car args)))\n  (let loop ((x lst))\n    (if (pair? x)\n\t(if (compare obj (car x))\n\t    x\n\t    (loop (cdr x)))\n\t#f)))\n#;(def member ##member)\n(def (delete-duplicates lst)\n  (cond\n    ((null? lst)\n     \'())\n    ((##member (car lst)\n\t     (cdr lst))\n     (##delete-duplicates (cdr lst)))\n    (else\n      (cons (car lst)\n\t    (##delete-duplicates (cdr lst))))))\n\n(def delete-duplication ##delete-duplicates)\n\n\n',"post-blank":0,"post-affiliated":125109},contents:[]}]}]},{$$data_type:"org-node",type:"headline",ref:"org84ba89d",drawer:{},properties:{"tags-all":[],"raw-value":"~Index.vue~","pre-blank":1,level:1,priority:null,tags:[],"todo-keyword":null,"todo-type":null,"post-blank":5,"footnote-section-p":!1,archivedp:!1,commentedp:!1,"post-affiliated":125751,title:[{$$data_type:"org-node",type:"code",ref:"orgf601ef1",properties:{value:"Index.vue","post-blank":0},contents:[]}]},contents:[{$$data_type:"org-node",type:"section",ref:"org3d70b1e",properties:{"post-blank":5,"post-affiliated":125766},contents:[{$$data_type:"org-node",type:"src-block",ref:"org90e9e8f",properties:{language:"vue",switches:null,parameters:null,"number-lines":null,"preserve-indent":!1,"retain-labels":!0,"use-labels":!0,"label-fmt":null,value:'<template>\n  <q-page>\n    <div>\n      <q-splitter\n\tv-model="splitterModel"\n\t>\n\n\t<template v-slot:before>\n\t<q-tabs\n\t  v-model="tab" no-caps\n\t  vertical\n\t  class="text-teal"\n\t>\n\t  <q-tab name="index" icon="loyalty" label="GerbilJS" />\n\t  <q-tab name="repl" icon="keyboard" label="REPL" />\n\t  <q-tab name="weblog" icon="format_list_numbered" label="Log Files" />\n\t  <q-tab name="tests" icon="verified" label="Tests" />\n\t</q-tabs>\n      </template>\n\n      <template v-slot:after>\n\t<q-tab-panels\n\t  v-model="tab"\n\t  animated\n\t  swipeable\n\t  vertical\n\t  transition-prev="jump-up"\n\t  transition-next="jump-up"\n\t>\n\t  <q-tab-panel name="index">\n\t    <span class="text-h4">GxQuasar</span>\n\t    <span class=\'text-subtitle2\'>An overview of Gerbil Scheme in JavaScript</span>\n\t    <hr>\n\t    <p> Developing Web Applications takes knowledge of a lot of\n\t    languages.</p>\n\t    <p>Centralizing on a lisp dialect, in\n\t    particular <a href="https://cons.io"><b>Gerbil</b>: a meta-dialect\n\t    of Scheme</a>, makes things a lot easier. </p>\n\n\t    <p>To have a look at the code, see the <code>./gx/</code> directory in <a href="https://github.com/drewc/gx-quasar">the github repo. </a> </p>\n\n\t  </q-tab-panel>\n\n\t  <q-tab-panel name="repl">\n\t    <div class="text-h4 q-mb-md">ReadEvalPrint(actually alert, then wait, before)Loop</div>\n\n\t    This is currently just a <a href="http://gambitscheme.org/">Gambit\n\t    Scheme</a> REPL. Gambit is the language that Gerbil\n\t    currently <a href="https://en.wikipedia.org/wiki/Source-to-source_compiler">transpiles</a>\n\t    to which itself can transpile to JavaScript.\n\n\t    <div class="full-width" contenteditable="true" id="gx_repl" style="max-width: 300px; height: 25vh; border: 2px solid black;">\n\t      (list "123" 456 #(7 8 9))\n\t    </div>\n\n\t    <q-btn color="red" @click="sourceCodeRun(\'gx_repl\')"> Repl </q-btn>\n\t    <hr>\n\n\t  </q-tab-panel>\n\n\t  <q-tab-panel name="weblog">\n\t    <div class="text-h4 q-mb-md">Log Files</div>\n\t    <log-index></log-index>\n\t  </q-tab-panel>\n\n\t  <q-tab-panel name="tests">\n\t    <div class="text-h4 q-mb-md">Tests</div>\n\t    This is where the tests come to lie. Reading the logs may help to see what they are and what they do.\n\t    <hr>\n\t    <div> <org-doc :document="orgDoc4"></org-doc> </div>\n\t  </q-tab-panel>\n\t</q-tab-panels>\n      </template>\n\n    </q-splitter>\n  </div>\n  </q-page>\n</template>\n\n<script>\nimport { Loading } from \'quasar\'\nimport LogIndex from \'components/LogIndex.vue\'\n\nvar wp = (window !== undefined) ? window : global\nwp.Prism = wp.Prism || {}\nwp.Prism.manual = true\nimport \'prismjs/prism.js\'\nimport \'prismjs/themes/prism.css\'\nimport \'prismjs/components/prism-scheme.js\'\nimport \'prismjs/components/prism-bash.js\'\nimport \'prismjs/components/prism-lisp.js\'\nimport \'prismjs/components/prism-json.js\'\n\nimport { OrgDoc } from \'components/org/OrgDoc.gx.js\'\nimport orgDoc4 from \'app/public/log/0004_Nested-Components.js\'\n\nexport default {\n  name: \'PageIndex\',\n  components: {\n    LogIndex,\n    OrgDoc\n  },\n  data () {\n    return {\n      tab: \'tests\',\n      splitterModel: 20,\n      orgDoc4: orgDoc4\n    }\n  },\n  mounted: function () {\n    this.$nextTick(function () {\n    // Code that will run only after the\n    // entire view has been re-rendered\n    //  Prism.highlightAll()\n    })\n  },\n  methods: {\n    sourceCodeRun (id) {\n      var scRun = false;\n      (async () => {\n\tif (!scRun) {\n\t  Loading.show()\n\t  const { sourceCodeRun, evalElement } = await import(\'app/public/gambit-repl.js\')\n\t  scRun = sourceCodeRun\n\t  evalElement(\'yay!!\')\n\t  Loading.hide()\n\t}\n\tvar val = scRun(id)\n\talert(\'=> \' + val)\n      })()\n    }\n  }\n}\n<\/script>\n',"post-blank":0,"post-affiliated":125766},contents:[]}]}]},{$$data_type:"org-node",type:"headline",ref:"orgc8d3872",drawer:{},properties:{"tags-all":[],"raw-value":"Build time","pre-blank":1,level:1,priority:null,tags:[],"todo-keyword":null,"todo-type":null,"post-blank":1,"footnote-section-p":!1,archivedp:!1,commentedp:!1,"post-affiliated":129406,title:["Build time"]},contents:[{$$data_type:"org-node",type:"section",ref:"orgbb80690",properties:{"post-blank":1,"post-affiliated":129420},contents:[{$$data_type:"org-node",type:"paragraph",ref:"org9bae073",properties:{"post-blank":1,"post-affiliated":129420},contents:["Now to embed everything into a ",{$$data_type:"org-node",type:"code",ref:"org3281918",properties:{value:":js","post-blank":1},contents:[]},{$$data_type:"org-node",type:"bold",ref:"org692a01f",properties:{"post-blank":1},contents:["Gerbil"]},"package.\n"]},{$$data_type:"org-node",type:"src-block",ref:"orgc397829",properties:{language:"scheme",switches:null,parameters:null,"number-lines":null,"preserve-indent":!1,"retain-labels":!0,"use-labels":!0,"label-fmt":null,value:"(package: js)\n","post-blank":1,"post-affiliated":129476},contents:[]},{$$data_type:"org-node",type:"paragraph",ref:"org2fc5b83",properties:{"post-blank":1,"post-affiliated":129520},contents:["We'll have 3 steps.\n"]},{$$data_type:"org-node",type:"plain-list",ref:"org1b48a2e",properties:{type:"ordered",structure:[[129541,1,"1) ",null,null,null,129574],[129574,1,"2) ",null,null,null,129599],[129599,1,"3) ",null,null,null,129638]],"post-blank":1,"post-affiliated":129541},contents:[{$$data_type:"org-node",type:"item",ref:"org03c8e34",properties:{bullet:"1) ",checkbox:null,counter:null,"pre-blank":0,"post-blank":0,"post-affiliated":129541,tag:[]},contents:[{$$data_type:"org-node",type:"paragraph",ref:"orgda833b3",properties:{"post-blank":0,"post-affiliated":129545},contents:[{$$data_type:"org-node",type:"code",ref:"org0da74d4",properties:{value:"gxjs","post-blank":1},contents:[]},":: Our basic run time\n"]}]},{$$data_type:"org-node",type:"item",ref:"orgecc87af",properties:{bullet:"2) ",checkbox:null,counter:null,"pre-blank":0,"post-blank":0,"post-affiliated":129574,tag:[]},contents:[{$$data_type:"org-node",type:"paragraph",ref:"org451386a",properties:{"post-blank":0,"post-affiliated":129578},contents:["All the lazy modules\n"]}]},{$$data_type:"org-node",type:"item",ref:"org4870d59",properties:{bullet:"3) ",checkbox:null,counter:null,"pre-blank":0,"post-blank":0,"post-affiliated":129599,tag:[]},contents:[{$$data_type:"org-node",type:"paragraph",ref:"orge3014a4",properties:{"post-blank":0,"post-affiliated":129603},contents:["The gambit repl (done the old way)\n"]}]}]},{$$data_type:"org-node",type:"paragraph",ref:"org804e88f",properties:{"post-blank":1,"post-affiliated":129639},contents:["Our ",{$$data_type:"org-node",type:"code",ref:"orgf36885d",properties:{value:"_comp","post-blank":1},contents:[]},"shell function takes a ",{$$data_type:"org-node",type:"code",ref:"org2454e3e",properties:{value:".ss","post-blank":0},contents:[]},", makes a ",{$$data_type:"org-node",type:"code",ref:"org81dbf0b",properties:{value:"static/.scm","post-blank":1},contents:[]},"and compiles that to a ",{$$data_type:"org-node",type:"code",ref:"orgf690628",properties:{value:".js","post-blank":0},contents:[]},".\n"]},{$$data_type:"org-node",type:"src-block",ref:"orgae4bc73",properties:{language:"shell",switches:null,parameters:null,"number-lines":null,"preserve-indent":!1,"retain-labels":!0,"use-labels":!0,"label-fmt":null,value:'_gxc () {\n    _givr="gxc -d . -S -static $1"\n echo "--- Compiling $_givr"; $_givr || exit 1 ;\n}\n_statics=""\n\n_gsc () {\n _js=$(basename $1 .scm).js\n _js=`echo $_js | sed \'s/js__\\(.*\\)/\\1/\'`\n _statics="$_statics $1"\n\n  echo "--- compiling $1 to $_js "\n if [[ -z $2 ]]\n then\n\tgsc -target js -prelude \'(include "~~lib/_gambit#.scm")\' -o $_js  $1 || exit 2; echo;\n else\n     gsc -target js -prelude \'(include "~~lib/_gambit#.scm")\' -o $_js -e \'(include "gerbil/runtime/gx-gambc#.scm")\' $1 || exit 2; echo;\n fi\n}\n\n_comp () {\n _fn=$(basename $1 .ss)\n _st=static/js__$_fn.scm\n\n  echo $@;\n _gxc $1;\n  if  [[ -e $2 ]] ; then cp $_st $_st.pre ; cat $2 >> $_st ; fi\n  if  [[ -e $3 ]] ; then cat $3 >> $_st ; fi\n  if  [[ -e $4 ]] ; then cat $4 >> $_st ; fi\n\n\n _gsc $_st $2;\n\n  if  [[ -e $2 ]] ; then cp $_st.pre $_st ; fi\n\n }\n',"post-blank":0,"post-affiliated":129734},contents:[]}]},{$$data_type:"org-node",type:"headline",ref:"org7f20c27",drawer:{},properties:{"tags-all":[],"raw-value":"Build ~gxjs~","pre-blank":1,level:2,priority:null,tags:[],"todo-keyword":null,"todo-type":null,"post-blank":1,"footnote-section-p":!1,archivedp:!1,commentedp:!1,"post-affiliated":130576,title:["Build ",{$$data_type:"org-node",type:"code",ref:"orgb000876",properties:{value:"gxjs","post-blank":0},contents:[]}]},contents:[{$$data_type:"org-node",type:"section",ref:"orgb2b2547",properties:{"post-blank":1,"post-affiliated":130593},contents:[{$$data_type:"org-node",type:"src-block",ref:"orgdc40e30",properties:{language:"shell",switches:null,parameters:null,"number-lines":null,"preserve-indent":!1,"retain-labels":!0,"use-labels":!0,"label-fmt":null,value:'gxc -v syntax.ss\ngxc -d . -S -static gxjs-rt-post.ss\n_comp gxjs-fixes.ss\n_comp syntax.ss\n_comp gxjs-init.ss\n_comp gxjs-rt.ss gxjs-gambc.scm gerbil/runtime/gx-gambc0.scm static/js__gxjs-rt-post.scm\n_comp gxjs-ffi.ss\n\n\necho "Compiling a gxjs-link.js file from our statics and the _gambit.js runtime."\ngsc -target js -o gxjs-link.js -link $_statics\n\n_gxjs_rt=\'cat gxjs-link.js gxjs-fixes.js syntax.js gxjs-init.js gxjs-rt.js gxjs-ffi.js > gxjs.js\'; echo making exec: $_gxjs_rt; bash -c "$_gxjs_rt";\n\ncp gxjs.js ../public/\n',"post-blank":0,"post-affiliated":130593},contents:[]}]}]},{$$data_type:"org-node",type:"headline",ref:"org8c7f417",drawer:{},properties:{"tags-all":[],"raw-value":"Build the modules","pre-blank":1,level:2,priority:null,tags:[],"todo-keyword":null,"todo-type":null,"post-blank":1,"footnote-section-p":!1,archivedp:!1,commentedp:!1,"post-affiliated":131141,title:["Build the modules"]},contents:[{$$data_type:"org-node",type:"section",ref:"org281019f",properties:{"post-blank":1,"post-affiliated":131163},contents:[{$$data_type:"org-node",type:"plain-list",ref:"org1a312e8",properties:{type:"ordered",structure:[[131163,0,"1) ",null,null,null,131170],[131170,0,"2) ",null,null,null,131179],[131179,0,"3) ",null,null,null,131201],[131201,0,"4) ",null,null,null,131219]],"post-blank":1,"post-affiliated":131163},contents:[{$$data_type:"org-node",type:"item",ref:"org4cbbd06",properties:{bullet:"1) ",checkbox:null,counter:null,"pre-blank":0,"post-blank":0,"post-affiliated":131163,tag:[]},contents:[{$$data_type:"org-node",type:"paragraph",ref:"orgb461722",properties:{"post-blank":0,"post-affiliated":131166},contents:["vue\n"]}]},{$$data_type:"org-node",type:"item",ref:"orgad048e9",properties:{bullet:"2) ",checkbox:null,counter:null,"pre-blank":0,"post-blank":0,"post-affiliated":131170,tag:[]},contents:[{$$data_type:"org-node",type:"paragraph",ref:"orgaac7bd3",properties:{"post-blank":0,"post-affiliated":131173},contents:["hello\n"]}]},{$$data_type:"org-node",type:"item",ref:"orgc7cc475",properties:{bullet:"3) ",checkbox:null,counter:null,"pre-blank":0,"post-blank":0,"post-affiliated":131179,tag:[]},contents:[{$$data_type:"org-node",type:"paragraph",ref:"orgf02b442",properties:{"post-blank":0,"post-affiliated":131182},contents:["gambit-module-test\n"]}]},{$$data_type:"org-node",type:"item",ref:"orgea00894",properties:{bullet:"4) ",checkbox:null,counter:null,"pre-blank":0,"post-blank":0,"post-affiliated":131201,tag:[]},contents:[{$$data_type:"org-node",type:"paragraph",ref:"orgc30c0c4",properties:{"post-blank":0,"post-affiliated":131204},contents:["button-counter\n"]}]}]},{$$data_type:"org-node",type:"src-block",ref:"org0541c8a",properties:{language:"shell",switches:null,parameters:null,"number-lines":null,"preserve-indent":!1,"retain-labels":!0,"use-labels":!0,"label-fmt":null,value:"_comp vue.ss\n_comp hello.ss\n_comp gambit-module-test.ss\n_comp button-counter.ss\n\ncp vue.js hello.js gambit-module-test.js button-counter.js ../public\n","post-blank":0,"post-affiliated":131220},contents:[]}]},{$$data_type:"org-node",type:"headline",ref:"org0c9cbd5",drawer:{},properties:{"tags-all":[],"raw-value":"~gambit-module-test.ss~: A module not loaded in the gambit program","pre-blank":1,level:3,priority:null,tags:[],"todo-keyword":null,"todo-type":null,"post-blank":0,"footnote-section-p":!1,archivedp:!1,commentedp:!1,"post-affiliated":131399,title:[{$$data_type:"org-node",type:"code",ref:"org2a3fe78",properties:{value:"gambit-module-test.ss","post-blank":0},contents:[]},": A module not loaded in the gambit program"]},contents:[{$$data_type:"org-node",type:"section",ref:"org6be6433",properties:{"post-blank":1,"post-affiliated":131471},contents:[{$$data_type:"org-node",type:"src-block",ref:"org1160f1e",properties:{language:"scheme",switches:null,parameters:null,"number-lines":null,"preserve-indent":!1,"retain-labels":!0,"use-labels":!0,"label-fmt":null,value:"(##inline-host-statement\n \"exports.Test = (arg) => {\n   var hello_fn = g_scm2host(@1@)\n   hello_fn('Test' + arg)\n}\n\nconsole.log('init gambit-module-test');\n\n\"\n (lambda (str)\n   (let* ((mod (##inline-host-expression \"g_module_name(gx_gambit_module_table[1]);\")))\n     ;; (js#console.log mod)\n     (js#alert str))))\n","post-blank":0,"post-affiliated":131471},contents:[]}]}]}]},{$$data_type:"org-node",type:"headline",ref:"orgc87eae8",drawer:{},properties:{"tags-all":[],"raw-value":"Now the full gambit repl","pre-blank":1,level:2,priority:null,tags:[],"todo-keyword":null,"todo-type":null,"post-blank":0,"footnote-section-p":!1,archivedp:!1,commentedp:!1,"post-affiliated":131815,title:["Now the full gambit repl"]},contents:[{$$data_type:"org-node",type:"section",ref:"org83ba270",properties:{"post-blank":1,"post-affiliated":131844},contents:[{$$data_type:"org-node",type:"paragraph",ref:"orgc5f48d8",properties:{"post-blank":1,"post-affiliated":131844},contents:["This time we try without the module reset/init.\n"]},{$$data_type:"org-node",type:"src-block",ref:"org4fc917d",properties:{language:"shell",switches:null,parameters:null,"number-lines":null,"preserve-indent":!1,"retain-labels":!0,"use-labels":!0,"label-fmt":null,value:'_comp lazy-gambit-repl.ss\n_lazy="cat lazy-gambit-repl.js $(gsc -e \'(display (path-expand "~~lib/_gambit.js"))\')  > gambit-repl.js"\necho Building the gambit repl: \\"$_lazy\\"; bash -c "$_lazy";\ncp gambit-repl.js ../public\n',"post-blank":2,"post-affiliated":131893},contents:[]},{$$data_type:"org-node",type:"src-block",ref:"orgd776de1",properties:{language:"scheme",switches:null,parameters:null,"number-lines":null,"preserve-indent":!1,"retain-labels":!0,"use-labels":!0,"label-fmt":null,value:'(import :gerbil/gambit)\n(declare (extended-bindings))\n\n(##inline-host-statement\n "exports.evalElement = (arg) => {\n  alert(\'Lazy? This is working without the reset Hello \' + arg)\n}"\n)\n\n(define (document.getElementById id)\n  (##inline-host-expression "g_host2foreign(document.getElementById(g_scm2host(@1@)))" id))\n\n(define (Element.innerText-ref elem)\n  (##inline-host-expression "g_host2scm(g_foreign2host(@1@).innerText)" elem))\n\n(define (g-sourceCodeRun id)\n  (let* ((elem (document.getElementById id))\n\t (code (Element.innerText-ref elem)))\n    (let ((expr (cons \'##begin (with-input-from-string code read-all))))\n      (eval expr))\n\n    ))\n\n(##inline-host-declaration "g_sourceCodeRun = function () { alert(\'sourceCodeRun\'); };")\n\n(##inline-host-statement "\ng_sourceCodeRun = g_scm2host(@1@);\nexports.sourceCodeRun = g_sourceCodeRun;" g-sourceCodeRun)\n\n',"post-blank":0,"post-affiliated":132143},contents:[]}]}]}]},{$$data_type:"org-node",type:"headline",ref:"org5fd1efc",drawer:{},properties:{"tags-all":[],"raw-value":"Footnotes","pre-blank":1,level:1,priority:null,tags:[],"todo-keyword":null,"todo-type":null,"post-blank":0,"footnote-section-p":!0,archivedp:!1,commentedp:!1,"post-affiliated":133282,title:["Footnotes"]},contents:[{$$data_type:"org-node",type:"section",ref:"orgc56a64e",properties:{"post-blank":0,"post-affiliated":133295},contents:[{$$data_type:"org-node",type:"footnote-definition",ref:"org8e5c0a3",properties:{label:"vue","pre-blank":1,"post-blank":1,"post-affiliated":133295},contents:[{$$data_type:"org-node",type:"quote-block",ref:"org1402b24",properties:{"post-blank":0,"post-affiliated":133304},contents:[{$$data_type:"org-node",type:"paragraph",ref:"org8eaf164",properties:{"post-blank":1,"post-affiliated":133318},contents:["The Progressive JavaScript Framework\n"]},{$$data_type:"org-node",type:"paragraph",ref:"org0df2111",properties:{"post-blank":0,"post-affiliated":133356},contents:["—",{$$data_type:"org-node",type:"link",ref:"org3546759",properties:{type:"https",path:"//vuejs.org/",format:"plain","raw-link":"https://vuejs.org/",application:null,"search-option":null,"post-blank":0,"is-internal":!1,"target-ref":null,"is-inline-image":!1},contents:[]},"\n"]}]}]},{$$data_type:"org-node",type:"footnote-definition",ref:"org019e1f4",properties:{label:"g","pre-blank":1,"post-blank":1,"post-affiliated":133389},contents:[{$$data_type:"org-node",type:"quote-block",ref:"org556cdbd",properties:{"post-blank":0,"post-affiliated":133396},contents:[{$$data_type:"org-node",type:"paragraph",ref:"org79b2251",properties:{"post-blank":1,"post-affiliated":133410},contents:["Gerbil is a meta-dialect of Scheme with post-modern features\n"]},{$$data_type:"org-node",type:"paragraph",ref:"org247006b",properties:{"post-blank":0,"post-affiliated":133472},contents:["— ",{$$data_type:"org-node",type:"link",ref:"org8cf0628",properties:{type:"https",path:"//cons.io/",format:"plain","raw-link":"https://cons.io/",application:null,"search-option":null,"post-blank":0,"is-internal":!1,"target-ref":null,"is-inline-image":!1},contents:[]},"\n"]}]}]},{$$data_type:"org-node",type:"footnote-definition",ref:"org3389a9b",properties:{label:"o","pre-blank":1,"post-blank":1,"post-affiliated":133504},contents:[{$$data_type:"org-node",type:"quote-block",ref:"org9f4fe4b",properties:{"post-blank":0,"post-affiliated":133511},contents:[{$$data_type:"org-node",type:"paragraph",ref:"orge8c8fc4",properties:{"post-blank":1,"post-affiliated":133525},contents:["Org mode is for keeping notes, maintaining to-do lists, planning projects,\nauthoring documents, computational notebooks, literate programming and more — in\na fast and effective plain text system.\n"]},{$$data_type:"org-node",type:"paragraph",ref:"org2105feb",properties:{"post-blank":0,"post-affiliated":133722},contents:["—",{$$data_type:"org-node",type:"link",ref:"org73297ec",properties:{type:"https",path:"//orgmode.org/",format:"plain","raw-link":"https://orgmode.org/",application:null,"search-option":null,"post-blank":0,"is-internal":!1,"target-ref":null,"is-inline-image":!1},contents:[]},"\n"]}]}]},{$$data_type:"org-node",type:"footnote-definition",ref:"org556a642",properties:{label:"q","pre-blank":1,"post-blank":1,"post-affiliated":133757},contents:[{$$data_type:"org-node",type:"quote-block",ref:"orgbec766c",properties:{"post-blank":0,"post-affiliated":133764},contents:[{$$data_type:"org-node",type:"paragraph",ref:"orgb63b1a3",properties:{"post-blank":1,"post-affiliated":133778},contents:["Quasar (pronounced ",{$$data_type:"org-node",type:"italic",ref:"orgf2cf672",properties:{"post-blank":0},contents:["ˈkweɪ.zɑɹ"]},") is an MIT licensed open-source Vue.js based\nframework, which allows you as a web developer to quickly create responsive++\nwebsites/apps in many flavours:\n"]},{$$data_type:"org-node",type:"plain-list",ref:"org4fee8ce",properties:{type:"unordered",structure:[[133965,1,"- ",null,null,null,133991],[133991,1,"- ",null,null,null,134058],[134058,1,"- ",null,null,null,134088],[134088,1,"- ",null,null,null,134115],[134115,1,"- ",null,null,null,134177],[134177,1,"- ",null,null,null,134225]],"post-blank":1,"post-affiliated":133965},contents:[{$$data_type:"org-node",type:"item",ref:"org4782505",properties:{bullet:"- ",checkbox:null,counter:null,"pre-blank":0,"post-blank":0,"post-affiliated":133965,tag:[]},contents:[{$$data_type:"org-node",type:"paragraph",ref:"org645da16",properties:{"post-blank":0,"post-affiliated":133968},contents:["SPAs (Single Page App)\n"]}]},{$$data_type:"org-node",type:"item",ref:"org1fa6355",properties:{bullet:"- ",checkbox:null,counter:null,"pre-blank":0,"post-blank":0,"post-affiliated":133991,tag:[]},contents:[{$$data_type:"org-node",type:"paragraph",ref:"orgfd3d14c",properties:{"post-blank":0,"post-affiliated":133994},contents:["SSR (Server-side Rendered App) (+ optional PWA client takeover)\n"]}]},{$$data_type:"org-node",type:"item",ref:"org2a04a6f",properties:{bullet:"- ",checkbox:null,counter:null,"pre-blank":0,"post-blank":0,"post-affiliated":134058,tag:[]},contents:[{$$data_type:"org-node",type:"paragraph",ref:"orga9500d9",properties:{"post-blank":0,"post-affiliated":134061},contents:["PWAs (Progressive Web App)\n"]}]},{$$data_type:"org-node",type:"item",ref:"org24fac61",properties:{bullet:"- ",checkbox:null,counter:null,"pre-blank":0,"post-blank":0,"post-affiliated":134088,tag:[]},contents:[{$$data_type:"org-node",type:"paragraph",ref:"org108eed6",properties:{"post-blank":0,"post-affiliated":134091},contents:["BEX (Browser Extension)\n"]}]},{$$data_type:"org-node",type:"item",ref:"org5346a68",properties:{bullet:"- ",checkbox:null,counter:null,"pre-blank":0,"post-blank":0,"post-affiliated":134115,tag:[]},contents:[{$$data_type:"org-node",type:"paragraph",ref:"org0f29cf3",properties:{"post-blank":0,"post-affiliated":134118},contents:["Mobile Apps (Android, iOS, …) through Cordova or Capacitor\n"]}]},{$$data_type:"org-node",type:"item",ref:"orgd092d0a",properties:{bullet:"- ",checkbox:null,counter:null,"pre-blank":0,"post-blank":0,"post-affiliated":134177,tag:[]},contents:[{$$data_type:"org-node",type:"paragraph",ref:"org9a13008",properties:{"post-blank":0,"post-affiliated":134180},contents:["Multi-platform Desktop Apps (using Electron)\n"]}]}]},{$$data_type:"org-node",type:"paragraph",ref:"org2857ccb",properties:{"post-blank":1,"post-affiliated":134226},contents:["Quasar’s motto is: write code once and simultaneously deploy it as a website, a\nMobile App and/or an Electron App. Yes, one codebase for all of them, helping\nyou develop an app in record time by using a state-of-the-art CLI and backed by\nbest-practice, blazing fast Quasar web components.\n"]},{$$data_type:"org-node",type:"paragraph",ref:"org5e5697e",properties:{"post-blank":1,"post-affiliated":134516},contents:["When using Quasar, you won’t need additional heavy libraries like Hammer.js,\nMoment.js or Bootstrap. It’s got those needs covered internally, and all with a\nsmall footprint!\n"]},{$$data_type:"org-node",type:"paragraph",ref:"org4332493",properties:{"post-blank":0,"post-affiliated":134691},contents:["—",{$$data_type:"org-node",type:"link",ref:"orgca37ce9",properties:{type:"https",path:"//quasar.dev/introduction-to-quasar",format:"plain","raw-link":"https://quasar.dev/introduction-to-quasar",application:null,"search-option":null,"post-blank":0,"is-internal":!1,"target-ref":null,"is-inline-image":!1},contents:[]},"\n"]}]}]},{$$data_type:"org-node",type:"footnote-definition",ref:"orge4d5a89",properties:{label:"wd","pre-blank":1,"post-blank":1,"post-affiliated":134747},contents:[{$$data_type:"org-node",type:"quote-block",ref:"org97593b8",properties:{"post-blank":0,"post-affiliated":134755},contents:[{$$data_type:"org-node",type:"paragraph",ref:"org90fa45a",properties:{"post-blank":1,"post-affiliated":134769},contents:["Linux\nUse AltGr- (en dash) or AltGr⇧ Shift- (em dash).\nIf you have a compose key:\n"]},{$$data_type:"org-node",type:"paragraph",ref:"orgdbd628c",properties:{"post-blank":0,"post-affiliated":134852},contents:["Use Compose--. (en dash) or Compose--- (em dash).\n—",{$$data_type:"org-node",type:"link",ref:"org0d536ee",properties:{type:"https",path:"//en.wikipedia.org/wiki/Wikipedia:How_to_make_dashes",format:"plain","raw-link":"https://en.wikipedia.org/wiki/Wikipedia:How_to_make_dashes",application:null,"search-option":null,"post-blank":0,"is-internal":!1,"target-ref":null,"is-inline-image":!1},contents:[]},"\n"]}]}]},{$$data_type:"org-node",type:"footnote-definition",ref:"orgd62fc6e",properties:{label:"emd","pre-blank":1,"post-blank":1,"post-affiliated":134975},contents:[{$$data_type:"org-node",type:"quote-block",ref:"org26ba39c",properties:{"post-blank":0,"post-affiliated":134984},contents:[{$$data_type:"org-node",type:"paragraph",ref:"orgbb5d393",properties:{"post-blank":1,"post-affiliated":134998},contents:["Use an em dash when attributing a quote.\n"]},{$$data_type:"org-node",type:"paragraph",ref:"orgd423c4d",properties:{"post-blank":1,"post-affiliated":135040},contents:['"You can never be overdressed or overeducated." —Oscar Wilde\n']},{$$data_type:"org-node",type:"paragraph",ref:"org05859a3",properties:{"post-blank":0,"post-affiliated":135102},contents:["—",{$$data_type:"org-node",type:"link",ref:"orge6fdb87",properties:{type:"https",path:"//communications.uoregon.edu/brand/punctuation#dashes",format:"plain","raw-link":"https://communications.uoregon.edu/brand/punctuation#dashes",application:null,"search-option":null,"post-blank":0,"is-internal":!1,"target-ref":null,"is-inline-image":!1},contents:[]},"\n"]}]}]},{$$data_type:"org-node",type:"footnote-definition",ref:"orga743e9f",properties:{label:"mfc","pre-blank":0,"post-blank":1,"post-affiliated":135176},contents:[{$$data_type:"org-node",type:"paragraph",ref:"org9e4a405",properties:{"post-blank":0,"post-affiliated":135185},contents:["Mozilla! ",{$$data_type:"org-node",type:"link",ref:"org8809196",properties:{type:"https",path:"//developer.mozilla.org/en-US/docs/Web/HTML/Element/figcaption",format:"plain","raw-link":"https://developer.mozilla.org/en-US/docs/Web/HTML/Element/figcaption",application:null,"search-option":null,"post-blank":0,"is-internal":!1,"target-ref":null,"is-inline-image":!1},contents:[]},"\n"]}]},{$$data_type:"org-node",type:"footnote-definition",ref:"orgc0a3c13",properties:{label:"vac","pre-blank":1,"post-blank":1,"post-affiliated":135264},contents:[{$$data_type:"org-node",type:"quote-block",ref:"org33ec1c7",properties:{"post-blank":0,"post-affiliated":135273},contents:[{$$data_type:"org-node",type:"paragraph",ref:"org9d22d65",properties:{"post-blank":1,"post-affiliated":135287},contents:["In large applications, we may need to divide the app into smaller chunks and\nonly load a component from the server when it’s needed. To make that easier, Vue\nallows you to define your component as a factory function that asynchronously\nresolves your component definition. Vue will only trigger the factory function\nwhen the component needs to be rendered and will cache the result for future\nre-renders. For example:\n"]},{$$data_type:"org-node",type:"src-block",ref:"orgbeeaa38",properties:{language:"javascript",switches:null,parameters:null,"number-lines":null,"preserve-indent":!1,"retain-labels":!0,"use-labels":!0,"label-fmt":null,value:"Vue.component('async-example', function (resolve, reject) {\n  setTimeout(function () {\n    // Pass the component definition to the resolve callback\n    resolve({\n      template: '<div>I am async!</div>'\n    })\n  }, 1000)\n})\n","post-blank":1,"post-affiliated":135705},contents:[]},{$$data_type:"org-node",type:"paragraph",ref:"orga4bfbf2",properties:{"post-blank":1,"post-affiliated":135963},contents:["As you can see, the factory function receives a resolve callback, which should be called when you have retrieved your component definition from the server. You can also call reject(reason) to indicate the load has failed.\n"]},{$$data_type:"org-node",type:"paragraph",ref:"org954cd32",properties:{"post-blank":0,"post-affiliated":136186},contents:["--",{$$data_type:"org-node",type:"link",ref:"orgaadf51f",properties:{type:"https",path:"//vuejs.org/v2/guide/components-dynamic-async.html#Async-Components",format:"bracket","raw-link":"https://vuejs.org/v2/guide/components-dynamic-async.html#Async-Components",application:null,"search-option":null,"post-blank":0,"is-internal":!1,"target-ref":null,"is-inline-image":!1},contents:["Vue.js Async Components"]},"\n"]}]}]},{$$data_type:"org-node",type:"footnote-definition",ref:"org587c892",properties:{label:"42","pre-blank":0,"post-blank":1,"post-affiliated":136305},contents:[{$$data_type:"org-node",type:"paragraph",ref:"orga7457aa",properties:{"post-blank":0,"post-affiliated":136313},contents:["Can it actually reference another footnote here?",{$$data_type:"org-node",type:"footnote-reference",ref:"org8f2b8ac",properties:{label:"oxjson",type:"standard","post-blank":0},contents:[]},".\n"]}]},{$$data_type:"org-node",type:"footnote-definition",ref:"org970f2d4",properties:{label:"vdom","pre-blank":0,"post-blank":1,"post-affiliated":136375},contents:[{$$data_type:"org-node",type:"paragraph",ref:"orgd8a8d96",properties:{"post-blank":0,"post-affiliated":136385},contents:[{$$data_type:"org-node",type:"link",ref:"org08e42eb",properties:{type:"https",path:"//vuejs.org/v2/guide/render-function.html#The-Virtual-DOM",format:"plain","raw-link":"https://vuejs.org/v2/guide/render-function.html#The-Virtual-DOM",application:null,"search-option":null,"post-blank":0,"is-internal":!1,"target-ref":null,"is-inline-image":!1},contents:[]},"\n"]}]},{$$data_type:"org-node",type:"footnote-definition",ref:"org1a50100",properties:{label:"prism","pre-blank":0,"post-blank":1,"post-affiliated":136450},contents:[{$$data_type:"org-node",type:"paragraph",ref:"org9fad22e",properties:{"post-blank":0,"post-affiliated":136461},contents:[{$$data_type:"org-node",type:"link",ref:"orgb3f0cb1",properties:{type:"https",path:"//prismjs.com/",format:"plain","raw-link":"https://prismjs.com/",application:null,"search-option":null,"post-blank":0,"is-internal":!1,"target-ref":null,"is-inline-image":!1},contents:[]},"\n"]}]},{$$data_type:"org-node",type:"footnote-definition",ref:"org452e3b2",properties:{label:"lwf","pre-blank":0,"post-blank":1,"post-affiliated":136483},contents:[{$$data_type:"org-node",type:"paragraph",ref:"org53a943f",properties:{"post-blank":0,"post-affiliated":136492},contents:[{$$data_type:"org-node",type:"link",ref:"orgb7f21ba",properties:{type:"https",path:"//en.wikipedia.org/wiki/Literate_programming#Workflow",format:"plain","raw-link":"https://en.wikipedia.org/wiki/Literate_programming#Workflow",application:null,"search-option":null,"post-blank":0,"is-internal":!1,"target-ref":null,"is-inline-image":!1},contents:[]},"\n"]}]},{$$data_type:"org-node",type:"footnote-definition",ref:"org53c2392",properties:{label:"vuerf","pre-blank":0,"post-blank":1,"post-affiliated":136553},contents:[{$$data_type:"org-node",type:"paragraph",ref:"org3d314c6",properties:{"post-blank":0,"post-affiliated":136564},contents:[{$$data_type:"org-node",type:"link",ref:"orgc5a6c82",properties:{type:"https",path:"//vuejs.org/v2/guide/render-function.html#Functional-Components",format:"plain","raw-link":"https://vuejs.org/v2/guide/render-function.html#Functional-Components",application:null,"search-option":null,"post-blank":0,"is-internal":!1,"target-ref":null,"is-inline-image":!1},contents:[]},"\n"]}]},{$$data_type:"org-node",type:"footnote-definition",ref:"org8e42937",properties:{label:"oxjson","pre-blank":0,"post-blank":1,"post-affiliated":136635},contents:[{$$data_type:"org-node",type:"paragraph",ref:"org3a950ae",properties:{"post-blank":0,"post-affiliated":136647},contents:[{$$data_type:"org-node",type:"link",ref:"org168e3ac",properties:{type:"https",path:"//github.com/jlumpe/ox-json",format:"plain","raw-link":"https://github.com/jlumpe/ox-json",application:null,"search-option":null,"post-blank":0,"is-internal":!1,"target-ref":null,"is-inline-image":!1},contents:[]},"\n"]}]},{$$data_type:"org-node",type:"footnote-definition",ref:"orgc2ac116",properties:{label:"rwe","pre-blank":0,"post-blank":0,"post-affiliated":136682},contents:[{$$data_type:"org-node",type:"paragraph",ref:"org4e98145",properties:{"post-blank":1,"post-affiliated":136691},contents:['Currently the royal "we".\n']}]}]}]}]};